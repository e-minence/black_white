
//======================================================================
//                pokecen_scr.ev
//
//    スクリプトファイル：pokecen_scr用
//
//======================================================================

  .text

  .include  "scr_seq_def.h"
  .include  "../../message/dst/script/msg_common_scr.h"
  //.include  "../../message/dst/script/msg_pokecen_scr.h"
  //.include  "pokecen_scr.h"

  .include  "../../../prog/include/system/timezone.h" //時間帯定義
//--------------------------------------------------------------
//               スクリプト本体
//--------------------------------------------------------------

//--------------------------------------------------------------
//               スクリプトテーブル
//--------------------------------------------------------------
_EVENT_DATA    ev_heal_p01
_EVENT_DATA_END


{
DEFINE_LOCAL  LWK_POKERUS_STATUS
DEFINE_LOCAL  LWK_TRAINER_CARD_STATUS
DEFINE_LOCAL  LWK_RECOVER_YESNO

/**************************************************************/
/*                                                            */
/*                                                            */
/*        ポケモンセンター　ジョーイさん                      */
/*                                                            */
/*                                                            */
/**************************************************************/
EVENT_START   ev_heal_p01

  _TALK_OBJ_START()

  _GET_TRAINER_CARD_RANK( LWK_TRAINER_CARD_STATUS )

  IF $LWK_TRAINER_CARD_STATUS < 4 THEN
  //普通のトレーナーカードの場合
    _CALL sub_heal_greeting   //時間帯で挨拶分岐

  ELSIF FLAG_OFF(FE_PC_GOLD) THEN
  //上位のトレーナーカードランクで、初来店の場合
    _CALL sub_heal_gyoe                          //！表示、そ、そのカードは！〜

    _FLAG_SET( FE_PC_GOLD )
  ELSE
  //上位のトレーナーカードランクで、来店済みの場合
    _PLAYER_NAME( 0 )
    _BALLOONWIN_TALKOBJ_OPEN( msg_common_pc_heal_09 ) //〜さん　おつかれさまです！

  ENDIF

  _YES_NO_WIN( LWK_RECOVER_YESNO )
  _BALLOONWIN_CLOSE()

  IF $LWK_RECOVER_YESNO == 0 THEN
    //預ける場合

    _BALLOONWIN_TALKOBJ_OPEN( msg_common_pc_heal_04 ) //それでは　おあずかりします
    
    _CALL sub_heal_kaifuku_anime                      //回復アニメ呼び出し
    _TEMOTI_POKEMON_KAIFUKU()                         //手持ちポケモン回復処理

    _BALLOONWIN_CLOSE()

    _CHECK_TEMOTI_POKERUS( LWK_POKERUS_STATUS )
    IF $LWK_POKERUS_STATUS == TRUE && FLAG_OFF( FE_PC_POKERUS )  THEN
    //ポケルス状態ポケモンがいて、その状態で初めての来店だったら
      _FLAG_SET( FE_PC_POKERUS )
      _BALLOONWIN_TALKOBJ_OPEN( msg_common_pc_heal_10 )
      _LAST_KEYWAIT()
      _BALLOONWIN_CLOSE()
    ELSE
      _CALL sub_heal_goodbye    //またのご利用を
    ENDIF

  ELSE
    //預けるのを断った場合

    _CALL sub_heal_goodbye    //またのご利用を
  ENDIF

EVENT_END
}

/**************************************************************/
//サブルーチン：最初の挨拶
/**************************************************************/
sub_heal_greeting:
{
  DEFINE_LOCAL  LWK_TIMEZONE  //時間帯取得用

  _GET_TIMEZONE( LWK_TIMEZONE )
  SWITCH $LWK_TIMEZONE
  CASE  TIMEZONE_MORNING THEN
    _BALLOONWIN_TALKOBJ_OPEN( msg_common_pc_heal_02 ) //おはようございます
  CASE  TIMEZONE_NOON THEN
    _BALLOONWIN_TALKOBJ_OPEN( msg_common_pc_heal_03 ) //こんにちは
  CASE  TIMEZONE_EVENING, TIMEZONE_NIGHT, TIMEZONE_MIDNIGHT THEN
    _BALLOONWIN_TALKOBJ_OPEN( msg_common_pc_heal_01 ) //おつかれさまです
  ENDSWITCH
}
_RET

/**************************************************************/
//サブルーチン：〆のメッセージ
/**************************************************************/
sub_heal_goodbye:
  _OBJ_ANIME( SCWK_TARGET_OBJID, anm_heal_p01_bow ) //お辞儀アニメ
  _OBJ_ANIME_WAIT()
  _BALLOONWIN_TALKOBJ_OPEN( msg_common_pc_heal_06 ) //またのご利用を
  _LAST_KEYWAIT()
  _BALLOONWIN_CLOSE()
_RET

//--------------------------------------------------------------------
//おじぎ
//--------------------------------------------------------------------
_ANIME_LABEL	anm_heal_p01_bow
//【仮】  ジョーイさんお辞儀アニメが未対応
	//_ANIME_DATA	AC_PC_BOW,1
	//_ANIME_DATA	AC_WAIT_4F,1
	_ANIME_DATA	AC_DIR_L,1
	_ANIME_DATA	AC_WAIT_4F,1
	_ANIME_DATA	AC_DIR_U,1
	_ANIME_DATA	AC_WAIT_4F,1
	_ANIME_DATA	AC_DIR_R,1
	_ANIME_DATA	AC_WAIT_4F,1
	_ANIME_DATA	AC_DIR_D,1
	_ANIME_DATA	AC_WAIT_4F,1
	_ANIME_DATA	ACMD_END,0

/**************************************************************/
//サブルーチン：トレーナーカードランク高い！
/**************************************************************/
sub_heal_gyoe:
  _BALLOONWIN_TALKOBJ_OPEN( msg_common_pc_heal_07 ) //おつかれさまです
  _OBJ_ANIME( SCWK_TARGET_OBJID, anm_heal_p01_gyoe )  //！マーク表示
  _OBJ_ANIME_WAIT()
  _BALLOONWIN_CLOSE()

  _PLAYER_NAME( 0 )
  _BALLOONWIN_TALKOBJ_OPEN( msg_common_pc_heal_08 ) //そ　そのカードは！？
_RET

//--------------------------------------------------------------------
//  びっくりマーク表示
//--------------------------------------------------------------------
_ANIME_LABEL	anm_heal_p01_gyoe
  _ANIME_DATA AC_MARK_GYOE,1
  _ANIME_DATA ACMD_END, 0

/**************************************************************/
//サブルーチン：回復アニメ
/**************************************************************/
sub_heal_kaifuku_anime:
{
  DEFINE_LOCAL  POKEMON_COUNT

  _OBJ_ANIME( SCWK_TARGET_OBJID, anm_heal_p01_turn_up )
  _OBJ_ANIME_WAIT()

  //_GET_POKE_COUNT( POKEMON_COUNT )
  $POKEMON_COUNT = 3  //【仮】  ポケモン数取得関数が仮なので無理やり値を入れている
  _POKECEN_RECOVER_ANIME( POKEMON_COUNT )

  _OBJ_ANIME( SCWK_TARGET_OBJID, anm_heal_p01_turn_down )
  _OBJ_ANIME_WAIT()
_RET
}

//--------------------------------------------------------------------
//  左を向く
//--------------------------------------------------------------------
_ANIME_LABEL	anm_heal_p01_turn_up
	_ANIME_DATA	AC_DIR_U,1
	_ANIME_DATA	ACMD_END,0

//--------------------------------------------------------------------
//  下を向く
//--------------------------------------------------------------------
_ANIME_LABEL	anm_heal_p01_turn_down
	_ANIME_DATA	AC_DIR_D,1
	_ANIME_DATA	ACMD_END,0



