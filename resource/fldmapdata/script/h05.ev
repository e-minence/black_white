
//======================================================================
//                h05.ev
//
//    スクリプトファイル：h05用
//
//======================================================================

  .text

  .include  "scr_seq_def.h"
  .include  "msg_h05.h"
  .include  "h05.h"

//--------------------------------------------------------------
//               スクリプト本体
//--------------------------------------------------------------

//--------------------------------------------------------------
//               スクリプトテーブル
//--------------------------------------------------------------
_EVENT_DATA    ev_pos_h05_ninja_01
_EVENT_DATA    ev_pos_h05_wandergirl
_EVENT_DATA    ev_h05_man3_01
_EVENT_DATA    ev_h05_middleman1_01
_EVENT_DATA    ev_zone_h05
_EVENT_DATA_END


/************************************************************/
/*					ZONE_CHANGE_SCRIPT						*/
/************************************************************/
INIT_EVENT_START	ev_zone_h05
	//20％の確率で
	_GET_RND( SCWK_ANSWER, 100 )
	_DEBUG_PRINT_WK( SCWK_ANSWER )
	IF $SCWK_ANSWER < 20 THEN
		//消える少女を表示
		_FLAG_RESET( FV_H05_WANDERGIRL )
		//POSイベントを有効
		$WK_SCENE_H05_GIRL = 1
	ENDIF
INIT_EVENT_END

/************************************************************/
/*					ワンダーブリッジ						*/
/************************************************************/
EVENT_START	ev_pos_h05_ninja_01
{
DEFINE_LOCAL	lwk_pos_x
DEFINE_LOCAL	lwk_pos_z
DEFINE_LOCAL	lwk_dir
	
	_FLAG_RESET( FV_H05_NINJA_01 )
	
	//自機の座標取得
	_PLAYER_POS_GET( lwk_pos_x, lwk_pos_z )
	_PLAYER_DIR_GET( lwk_dir )
	
	_OBJ_ANIME( MMDL_ID_PLAYER, anm_mark_gyoe )
	_OBJ_ANIME_WAIT()
	
	//その１の出現位置を設定（自機の正面）
	$SCWK_TEMP0 = $lwk_pos_x
	IF $lwk_dir == DIR_RIGHT THEN
		$SCWK_TEMP0 += 2
		$SCWK_TEMP1 = DIR_LEFT
	ELSIF $lwk_dir == DIR_LEFT THEN
		$SCWK_TEMP0 -= 2
		$SCWK_TEMP1 = DIR_RIGHT
	ENDIF
	
	//その１を追加
	_OBJ_ADD( H05_NINJA_01 )
	_OBJ_POS_CHANGE( H05_NINJA_01, SCWK_TEMP0, 0, lwk_pos_z, SCWK_TEMP1 )
	_OBJ_ANIME( H05_NINJA_01, anm_ninja_appear_01 )
	_OBJ_ANIME_WAIT()
	
//	_TIME_WAIT( 2 )
	
	//その２の出現位置を設定（自機の後ろ）
	$SCWK_TEMP0 = $lwk_pos_x
	IF $lwk_dir == DIR_RIGHT THEN
		$SCWK_TEMP0 -= 2
		$SCWK_TEMP1 = DIR_RIGHT
	ELSIF $lwk_dir == DIR_LEFT THEN
		$SCWK_TEMP0 += 2
		$SCWK_TEMP1 = DIR_LEFT
	ENDIF
	
	//その２を追加
	_OBJ_ADD( H05_NINJA_02 )
	_OBJ_POS_CHANGE( H05_NINJA_02, SCWK_TEMP0, 0, lwk_pos_z, SCWK_TEMP1 )
	_OBJ_ANIME( H05_NINJA_02, anm_ninja_appear_01 )
	_OBJ_ANIME_WAIT()
	
//	_TIME_WAIT( 2 )
	
	//その３の出現位置を設定（自機の上）※道路一番上の時だけ自機の下に出現
	$SCWK_TEMP0 = $lwk_pos_z
	IF $lwk_pos_z <= 32 THEN
		$SCWK_TEMP0 += 2
		$SCWK_TEMP1 = DIR_UP
	ELSE
		$SCWK_TEMP0 -= 2
		$SCWK_TEMP1 = DIR_DOWN
	ENDIF
	
//-	_TIME_WAIT( 2 )
	
	//その３を追加
	_OBJ_ADD( H05_NINJA_03 )
	_OBJ_POS_CHANGE( H05_NINJA_03, lwk_pos_x, 0, SCWK_TEMP0, SCWK_TEMP1 )
	_OBJ_ANIME( H05_NINJA_03, anm_ninja_appear_01 )
	_OBJ_ANIME_WAIT()
	
	_TIME_WAIT( 16 )
	
	//……おまえか
	_BALLOONWIN_OBJMSG_POS( msg_h05_ninja1_01, H05_NINJA_01, POS_DEFAULT )
	_MSGWIN_CLOSE()
	
	//ゲーチス様はいない
	_BALLOONWIN_OBJMSG_POS( msg_h05_ninja2_01, H05_NINJA_02, POS_DEFAULT )
	_MSGWIN_CLOSE()
	
	//われわれは ゲーチス様に
	_BALLOONWIN_OBJMSG_POS( msg_h05_ninja3_01, H05_NINJA_03, POS_DEFAULT )
	_MSGWIN_CLOSE()
	
	
	//これを渡せと
	_BALLOONWIN_OBJMSG_POS( msg_h05_ninja1_02, H05_NINJA_01, POS_DEFAULT )
	_MSGWIN_CLOSE()
	
	//その１：自機に隣接
	IF $lwk_dir == DIR_RIGHT THEN
		_OBJ_ANIME( H05_NINJA_01, anm_ninja_move_l )
	ELSE
		_OBJ_ANIME( H05_NINJA_01, anm_ninja_move_r )
	ENDIF
	_OBJ_ANIME_WAIT()
	
	//こんごうだま入手
	_ITEM_EVENT_KEYWAIT( ITEM_KONGOUDAMA, 1 )
	
	//私からはこれを
	_BALLOONWIN_OBJMSG_POS( msg_h05_ninja2_02, H05_NINJA_02, POS_DEFAULT )
	_MSGWIN_CLOSE()
	
	//その２：自機に隣接
	IF $lwk_dir == DIR_RIGHT THEN
		_OBJ_ANIME( H05_NINJA_02, anm_ninja_move_r )
		_OBJ_ANIME_WAIT()
		_OBJ_ANIME( MMDL_ID_PLAYER, anm_stay_walk_l )
	ELSE
		_OBJ_ANIME( H05_NINJA_02, anm_ninja_move_l )
		_OBJ_ANIME_WAIT()
		_OBJ_ANIME( MMDL_ID_PLAYER, anm_stay_walk_r )
	ENDIF
	_OBJ_ANIME_WAIT()
	
	//しらたま入手
	_ITEM_EVENT_KEYWAIT( ITEM_SIRATAMA, 1 )
	
	//そしてこれも
	_BALLOONWIN_OBJMSG_POS( msg_h05_ninja3_02, H05_NINJA_03, POS_DEFAULT )
	_MSGWIN_CLOSE()
	
	//その３：自機に隣接
	IF $lwk_pos_z <= 32 THEN
		_OBJ_ANIME( H05_NINJA_03, anm_ninja_move_u )
		_OBJ_ANIME_WAIT()
		_OBJ_ANIME( MMDL_ID_PLAYER, anm_stay_walk_d )
	ELSE
		_OBJ_ANIME( H05_NINJA_03, anm_ninja_move_d )
		_OBJ_ANIME_WAIT()
		_OBJ_ANIME( MMDL_ID_PLAYER, anm_stay_walk_u )
	ENDIF
	_OBJ_ANIME_WAIT()
	
	//はっきんだま入手
	_ITEM_EVENT_KEYWAIT( ITEM_HAKKINDAMA, 1 )
	
	
	//……ゲーチスさまが
	_BALLOONWIN_OBJMSG_POS( msg_h05_ninja1_03, H05_NINJA_01, POS_DEFAULT )
	_MSGWIN_CLOSE()
	
	//われらダークトリニティは
	_BALLOONWIN_OBJMSG_POS( msg_h05_ninja2_03, H05_NINJA_02, POS_DEFAULT )
	_MSGWIN_CLOSE()
	
	//……おまえとは
	_BALLOONWIN_OBJMSG_POS( msg_h05_ninja3_03, H05_NINJA_03, POS_DEFAULT )
	_MSGWIN_CLOSE()
	
	//その１その２：一歩下がる
	IF $lwk_dir == DIR_RIGHT THEN
		_OBJ_ANIME( H05_NINJA_01, anm_ninja_back_r )
		_OBJ_ANIME( H05_NINJA_02, anm_ninja_back_l )
	ELSE
		_OBJ_ANIME( H05_NINJA_01, anm_ninja_back_l )
		_OBJ_ANIME( H05_NINJA_02, anm_ninja_back_r )
	ENDIF
	
	//その３：一歩下がる
	IF $lwk_pos_z <= 32 THEN
		_OBJ_ANIME( H05_NINJA_03, anm_ninja_back_d )
	ELSE
		_OBJ_ANIME( H05_NINJA_03, anm_ninja_back_u )
	ENDIF
	_OBJ_ANIME_WAIT()
	
	//ダークトリニティ：退場
	_OBJ_ANIME( H05_NINJA_01, anm_ninja_leave_01 )
//	_TIME_WAIT( 2 )
	_OBJ_ANIME( H05_NINJA_02, anm_ninja_leave_01 )
//	_TIME_WAIT( 2 )
	_OBJ_ANIME( H05_NINJA_03, anm_ninja_leave_01 )
	_OBJ_ANIME_WAIT()
	
	//ダークトリニティ：削除
	_OBJ_DEL( H05_NINJA_01 )
	_OBJ_DEL( H05_NINJA_02 )
	_OBJ_DEL( H05_NINJA_03 )
	
	//========================================//
	//POS無効
	$WK_SCENE_H05 = 1
	
	//ダークトリニティ非表示
	_FLAG_SET( FV_H05_NINJA_01 )
	
	//========================================//
	
}
EVENT_END

//--------------------------------------------------------------------
//！マーク
//--------------------------------------------------------------------
_ANIME_LABEL	anm_mark_gyoe
	_ANIME_DATA	AC_MARK_GYOE,1
	_ANIME_DATA	ACMD_END,0

//--------------------------------------------------------------------
//その場歩き
//--------------------------------------------------------------------
_ANIME_LABEL	anm_stay_walk_u
	_ANIME_DATA	AC_STAY_WALK_U_8F,1
	_ANIME_DATA	ACMD_END,0

_ANIME_LABEL	anm_stay_walk_d
	_ANIME_DATA	AC_STAY_WALK_D_8F,1
	_ANIME_DATA	ACMD_END,0

_ANIME_LABEL	anm_stay_walk_l
	_ANIME_DATA	AC_STAY_WALK_L_8F,1
	_ANIME_DATA	ACMD_END,0

_ANIME_LABEL	anm_stay_walk_r
	_ANIME_DATA	AC_STAY_WALK_R_8F,1
	_ANIME_DATA	ACMD_END,0

//--------------------------------------------------------------------
//ダークトリニティ：自機に隣接
//--------------------------------------------------------------------
_ANIME_LABEL	anm_ninja_move_u
	_ANIME_DATA	AC_WALK_U_8F,1
	_ANIME_DATA	ACMD_END,0

_ANIME_LABEL	anm_ninja_move_d
	_ANIME_DATA	AC_WALK_D_8F,1
	_ANIME_DATA	ACMD_END,0

_ANIME_LABEL	anm_ninja_move_l
	_ANIME_DATA	AC_WALK_L_8F,1
	_ANIME_DATA	ACMD_END,0

_ANIME_LABEL	anm_ninja_move_r
	_ANIME_DATA	AC_WALK_R_8F,1
	_ANIME_DATA	ACMD_END,0

//--------------------------------------------------------------------
//ダークトリニティ：一歩下がる
//--------------------------------------------------------------------
_ANIME_LABEL	anm_ninja_back_u
	_ANIME_DATA	AC_DIR_D,1
	_ANIME_DATA	AC_DIR_PAUSE_ON,1
	_ANIME_DATA	AC_WALK_U_12F,1
	_ANIME_DATA	AC_DIR_PAUSE_OFF,1
	_ANIME_DATA	ACMD_END,0

_ANIME_LABEL	anm_ninja_back_d
	_ANIME_DATA	AC_DIR_U,1
	_ANIME_DATA	AC_DIR_PAUSE_ON,1
	_ANIME_DATA	AC_WALK_D_12F,1
	_ANIME_DATA	AC_DIR_PAUSE_OFF,1
	_ANIME_DATA	ACMD_END,0

_ANIME_LABEL	anm_ninja_back_l
	_ANIME_DATA	AC_DIR_R,1
	_ANIME_DATA	AC_DIR_PAUSE_ON,1
	_ANIME_DATA	AC_WALK_L_12F,1
	_ANIME_DATA	AC_DIR_PAUSE_OFF,1
	_ANIME_DATA	ACMD_END,0

_ANIME_LABEL	anm_ninja_back_r
	_ANIME_DATA	AC_DIR_L,1
	_ANIME_DATA	AC_DIR_PAUSE_ON,1
	_ANIME_DATA	AC_WALK_R_12F,1
	_ANIME_DATA	AC_DIR_PAUSE_OFF,1
	_ANIME_DATA	ACMD_END,0

//--------------------------------------------------------------------
//ダークトリニティ：出現
//--------------------------------------------------------------------
_ANIME_LABEL	anm_ninja_appear_01
	_ANIME_DATA	AC_NINJA_ACT0,1
	_ANIME_DATA	ACMD_END,0

//--------------------------------------------------------------------
//ダークトリニティ：退場
//--------------------------------------------------------------------
_ANIME_LABEL	anm_ninja_leave_01
	_ANIME_DATA	AC_NINJA_ACT1,1
	_ANIME_DATA	ACMD_END,0


/************************************************************/
/*						消える少女							*/
/************************************************************/
EVENT_START	ev_pos_h05_wandergirl
	//少女：消える
	_OBJ_ANIME( H05_GIRL2_01, anm_girl_vanish )
	_OBJ_ANIME_WAIT()
	
	//少女を削除
	_OBJ_DEL( H05_GIRL2_01 )
	
	//ふとっちょ：！マーク
	_OBJ_ANIME( H05_MAN3_01, anm_man3_look )
	_OBJ_ANIME_WAIT()
	
	//はわわわ
	_BALLOONWIN_OBJMSG_POS( msg_h05_oldwoman1_02, H05_MAN3_01, POS_DEFAULT )
	_LAST_KEYWAIT()
	_MSGWIN_CLOSE()
	
	//========================================//
	//POS無効
	$WK_SCENE_H05_GIRL = 2
	
	//消える少女の表示フラグをセット
	_FLAG_SET( FV_H05_WANDERGIRL )
	
	//消える少女を見た
	_FLAG_SET( FE_H05_LOOK_WANDERGIRL )
	//========================================//
	
EVENT_END

//--------------------------------------------------------------------
//少女：消える
//--------------------------------------------------------------------
_ANIME_LABEL	anm_girl_vanish
	_ANIME_DATA	AC_VANISH_ON,1
	_ANIME_DATA	AC_WAIT_1F,1
	_ANIME_DATA	AC_VANISH_OFF,1
	_ANIME_DATA	AC_VANISH_ON,1
	_ANIME_DATA	AC_WAIT_1F,1
	_ANIME_DATA	AC_VANISH_OFF,1
	_ANIME_DATA	AC_VANISH_ON,1
	_ANIME_DATA	AC_WAIT_1F,1
	_ANIME_DATA	AC_VANISH_OFF,1
	_ANIME_DATA	AC_VANISH_ON,1
	_ANIME_DATA	AC_WAIT_1F,1
	_ANIME_DATA	AC_VANISH_OFF,1
	_ANIME_DATA	AC_VANISH_ON,1
	_ANIME_DATA	AC_WAIT_1F,1
	_ANIME_DATA	AC_VANISH_OFF,1
	_ANIME_DATA	AC_VANISH_ON,1
	_ANIME_DATA	AC_WAIT_1F,1
	_ANIME_DATA	AC_VANISH_OFF,1
	_ANIME_DATA	AC_VANISH_ON,1
	_ANIME_DATA	AC_WAIT_1F,1
	_ANIME_DATA	AC_VANISH_OFF,1
	_ANIME_DATA	AC_VANISH_ON,1
	_ANIME_DATA	AC_WAIT_1F,1
	_ANIME_DATA	AC_VANISH_OFF,1
	_ANIME_DATA	AC_VANISH_ON,1
	_ANIME_DATA	ACMD_END,0

//--------------------------------------------------------------------
//ふとっちょ：！マーク
//--------------------------------------------------------------------
_ANIME_LABEL	anm_man3_look
	_ANIME_DATA	AC_DIR_R,1
	_ANIME_DATA	AC_MARK_GYOE,1
	_ANIME_DATA	ACMD_END,0


/************************************************************/
/*						ふとっちょ							*/
/************************************************************/
EVENT_START	ev_h05_man3_01
	_TALK_OBJ_START()
	
	IF FLAG_ON( FE_H05_LOOK_WANDERGIRL ) THEN
	//消える少女を見た後
		//はわわわ
		_BALLOONWIN_TALKOBJ_MSG( msg_h05_oldwoman1_02 )
	ELSE
		//はあ…ぜっけいだすなあ
		_BALLOONWIN_TALKOBJ_MSG( msg_h05_oldwoman1_01 )
	ENDIF
	_LAST_KEYWAIT()
	_MSGWIN_CLOSE()

EVENT_END


/************************************************************/
/*					コイキング購入							*/
/************************************************************/
EVENT_START   ev_h05_middleman1_01
	//購入済みかチェック
	IF FLAG_OFF( FE_H05_BUY_POKE ) THEN
	//ポケモン購入処理へジャンプ
		_CALL ev_buy_poke
	//購入済み
	ELSE
		_EASY_BALLOONWIN_TALKOBJ_MSG(msg_h05_middleman_08)
	ENDIF
EVENT_END


//ポケモン購入処理
ev_buy_poke:
	_TALK_OBJ_START()
	
	//男性だった場合
	_BALLOONWIN_OBJMSG_MF( msg_h05_middleman_01, msg_h05_middleman_02, H05_MIDDLEMAN1_01, POS_DEFAULT )
	
	//所持金の表示
	_GOLD_WIN_OPEN( MENU_X1, MENU_Y1 )
	
	//ポケモン購入しない？
	DEFINE_LOCAL SCWK_ANSWER01
	_YES_NO_WIN( SCWK_ANSWER01 )
	
	//回答により分岐
	IF $SCWK_ANSWER01 == SCR_YES THEN
	
		//手持ちポケモンをカウント&所持金をチェックして回答を分岐する
		{
		
		//手持ちポケモンのカウント
		DEFINE_LOCAL LWK_POKE_COUNT
		_GET_PARTY_POKE_COUNT (LWK_POKE_COUNT,POKECOUNT_MODE_TOTAL)
		
		//所持金のチェック
		DEFINE_LOCAL LWK_GOLD_CHK
		_CHECK_GOLD( LWK_GOLD_CHK, 500  )
		
		//所持金が足りない
		IF $LWK_GOLD_CHK == 0 THEN
			_BALLOONWIN_OBJMSG(msg_h05_middleman_05,H05_MIDDLEMAN1_01)
			_LAST_KEYWAIT()
			_BALLOONWIN_CLOSE()
			
			_GOLD_WIN_CLOSE()
		
		//手持ちがいっぱいなら
		ELSIF $LWK_POKE_COUNT == 6 THEN
			_BALLOONWIN_OBJMSG(msg_h05_middleman_06,H05_MIDDLEMAN1_01)
			_LAST_KEYWAIT()
			_BALLOONWIN_CLOSE()
			
			_GOLD_WIN_CLOSE()
		
		//500円があって手持ちに空きがあれば持ちタイプに合わせてポケモンを渡す	
		ELSE
			//購入可能であれば先に表示していたウインドウを閉じる
			_BALLOONWIN_CLOSE()
			
			//プレイヤーネームを格納
			_PLAYER_NAME(0)
			
			//ME再生
			_ME_PLAY( SEQ_ME_POKEGET )
			
			//所持金を減らして表示ウィンドウから減算
			_SUBTRACT_GOLD( 500 )
			_GOLD_WIN_UPDATE()
			//プレイヤー名はコイキングを買った！
			_SYSWIN_MSG( msg_h05_middleman_03, POS_DEFAULT )
			
			//ウィンドウを閉じる
			_ME_WAIT()
			_AB_KEYWAIT_MARK()
			_MSGWIN_CLOSE()
			
			//コイキングを入手
			_ADD_POKEMON_TO_PARTY( SCWK_ANSWER, MONSNO_129, 0, 5 )
			
			//コイキングの素早さの個体値をMAXに操作
			_SET_PARTY_POKE_PARAM( LWK_POKE_COUNT , SCR_POKEPARA_AGI_RND , 31)
			
			//名前をつけますか？
			_SYSWIN_MSG(msg_h05_middleman_04, POS_DEFAULT )
			DEFINE_LOCAL NAME_YESNO01
			_YES_NO_WIN( NAME_YESNO01 )
			_SYSWIN_CLOSE()
			
			//名づけるか分岐
			IF $NAME_YESNO01 == 0 THEN
				//はい
				
				//名前入力結果が格納されるローカル変数を定義
				DEFINE_LOCAL SCWK_NAMEINPUT
				
				//名前入力画面呼び出し
				_PARTY_POKE_NAME_INPUT(SCWK_NAMEINPUT,LWK_POKE_COUNT,TRUE)
				
			ELSE
				//いいえの場合はスキップ
			ENDIF
		
			//会話終了
			_BALLOONWIN_OBJMSG(msg_h05_middleman_08,H05_MIDDLEMAN1_01)
			_LAST_KEYWAIT()
			_BALLOONWIN_CLOSE()
			
			//======================================//
			
			//コイキング購入イベント終了
			_FLAG_SET( FE_H05_BUY_POKE )
			
			//======================================//
			
		ENDIF
		}

	//いらない場合
	ELSE
		_BALLOONWIN_OBJMSG(msg_h05_middleman_07,H05_MIDDLEMAN1_01)
		_LAST_KEYWAIT()
		_BALLOONWIN_CLOSE()
	
	ENDIF
	
	_GOLD_WIN_CLOSE()

_RET



