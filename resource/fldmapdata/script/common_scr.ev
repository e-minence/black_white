//====================================================================
//            common_scr
//            共通・データ
//====================================================================

  .text
  .include  "scr_seq_def.h"

  .include  "../../message/dst/script/msg_common_scr.h"
  
//--------------------------------------------------------------------
//               スクリプト本体
//--------------------------------------------------------------------
_EVENT_DATA   ev_dummy
_EVENT_DATA   ev_heal_p01_dummy
_EVENT_DATA   ev_gameover_recover_home
_EVENT_DATA   ev_gameover_recover_pokecen
_EVENT_DATA   ev_report_event_call_wireless
_EVENT_DATA   ev_report_event_call
_EVENT_DATA   ev_field_comm_exit_event_call
_EVENT_DATA_END //終了

//--------------------------------------------------------------------
//  共通スクリプト  
//--------------------------------------------------------------------
//====================================================================
//====================================================================
EVENT_START ev_dummy
  //なにもしない//
EVENT_END

//====================================================================
//  ジョーイ
//  ※pokecen_scr.evに移動しました。
//====================================================================
EVENT_START   ev_heal_p01_dummy
  _TALK_START_SE_PLAY()
  _BALLOONWIN_TALKOBJ_MSG( msg_common_pc_heal_01 )
  _LAST_KEYWAIT()
  _BALLOONWIN_CLOSE()
EVENT_END

//////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////
EVENT_START   ev_gameover_recover_home
  _ME_PLAY( SEQ_ME_ASA )
  _ME_WAIT()
  _BLACK_IN()
  _DISP_FADE_END_CHECK()
  //_EASY_MSG( msg_common_pc_heal_01 )  //仮

  //_BLACK_OUT()
  //_DISP_FADE_END_CHECK()
  //_ME_PLAY( SEQ_ME_ASA )
  //_ME_WAIT()
  //_BLACK_IN()
  //_DISP_FADE_END_CHECK()

  _TEMOTI_POKEMON_KAIFUKU()                         //手持ちポケモン回復処理

  //_EASY_MSG( msg_common_pc_heal_02 )  //仮
EVENT_END

//====================================================================
//====================================================================
EVENT_START   ev_gameover_recover_pokecen
  _ME_PLAY( SEQ_ME_ASA )
  _ME_WAIT()
  _WHITE_IN()
  _DISP_FADE_END_CHECK()
  _TEMOTI_POKEMON_KAIFUKU()                         //手持ちポケモン回復処理
  //_EASY_MSG( msg_common_pc_heal_01 )
EVENT_END

//====================================================================
//====================================================================
//--------------------------------------------------------------
//  SCWK_PARAM0   セーブ結果を返すscript_def.h参照
//--------------------------------------------------------------
ev_report_event_call_wireless:
{
  DEFINE_LOCAL savemode

  // ワイヤレスセーブモード取得
  _GET_WIRELESS_SAVEMODE( savemode )

  SWITCH $savemode
  CASE WIRELESS_SAVEMODE_ON  THEN _CALL ev_report_event_call    // レポート処理へ
  CASE WIRELESS_SAVEMODE_OFF THEN $SCWK_PARAM0 = SCR_REPORT_OK  // レポート書いたとみなす
                                  _CHG_LOCAL_SCR                // ローカルスクリプトに切り替え
  ENDSWITCH
}
_END 
ev_report_event_call:
{ 
  // 変数を初期化
  $SCWK_PARAM1 = FALSE    // セーブするかどうか
  $SCWK_PARAM2 = FALSE    // セーブデータが存在するかどうか
  $SCWK_PARAM3 = FALSE    // プレイ中のデータが新規データかどうか
  $SCWK_PARAM4 = FALSE    // セーブデータ量
  $SCWK_PARAM5 = 0        // temp

  // セーブデータの状態を取得
  _REPORT_CHECK( SCWK_PARAM2, SCWK_PARAM3, SCWK_PARAM4 )
  // test
  $SCWK_PARAM2 = TRUE
  $SCWK_PARAM3 = FALSE
  $SCWK_PARAM4 = 1  

  //「かいても いいですか？」
  _SYSWIN_MSG_DOWN( msg_common_report_01 )
  _YES_NO_WIN( SCWK_PARAM5 )
  IF $SCWK_PARAM5 == 0 THEN //『はい』
    $SCWK_PARAM1 = TRUE
  ENDIF
  _SYSWIN_CLOSE()

  //「すでに べつの レポートが…」
  IF ($SCWK_PARAM1 == TRUE) && ($SCWK_PARAM2 == TRUE) && ($SCWK_PARAM3 == TRUE) THEN
      _SYSWIN_MSG_DOWN( msg_common_report_08 )
    _AB_KEYWAIT()
    _SYSWIN_CLOSE()
    $SCWK_PARAM1 = FALSE
  ENDIF

  //「うえから かいても いいですか？」
  IF ($SCWK_PARAM1 == TRUE) && ($SCWK_PARAM2 == TRUE) && ($SCWK_PARAM3 != TRUE) THEN
      _SYSWIN_MSG_DOWN( msg_common_report_02 )
    _YES_NO_WIN( SCWK_PARAM5 )
    _SYSWIN_CLOSE()
    IF $SCWK_PARAM5 == 1 THEN //『いいえ』
     $SCWK_PARAM1 = FALSE
    ENDIF
  ENDIF

  // セーブ
  IF $SCWK_PARAM1 == TRUE THEN
    //「かきこんでいます」
    SWITCH $SCWK_PARAM4 
    CASE 0 THEN 
      _SYSWIN_MSG_DOWN( msg_common_report_10 )
    CASE 1 THEN
      _SYSWIN_MSG_DOWN( msg_common_report_11 )
    CASE 2 THEN
      _SYSWIN_MSG_DOWN( msg_common_report_12 )
    ENDSWITCH
    _REPORT_CALL( SCWK_PARAM5 ) // 実セーブ処理
    _SYSWIN_CLOSE()
    // 書き込みに成功
    IF $SCWK_PARAM5 == TRUE THEN
      _SE_PLAY( SEQ_SE_SAVE )
      //「しっかり かきのこした！」
      _PLAYER_NAME(0)
          _SYSWIN_MSG_DOWN( msg_common_report_04 )
      _AB_KEYWAIT()
      _SYSWIN_CLOSE()
      $SCWK_PARAM0 = SCR_REPORT_OK
    // 書き込みに失敗
    ELSE
      //「かけませんでした」
          _SYSWIN_MSG_DOWN( msg_common_report_06 )
      _AB_KEYWAIT()
      _SYSWIN_CLOSE() 
      $SCWK_PARAM0 = SCR_REPORT_CANCEL  // 結果を返す
    ENDIF
  ENDIF

  // セーブしなかった場合
  IF $SCWK_PARAM1 != TRUE THEN
    $SCWK_PARAM0 = SCR_REPORT_CANCEL  // 結果を返す
  ENDIF

  _CHG_LOCAL_SCR                          //ローカルスクリプトに切り替え
  _END
}

//====================================================================
/*
  フィールド通信切断処理コモン
  @retval  SCWK_PARAM0  切断処理正常終了：SCR_FIELD_COMM_EXIT_OK
  @retval  SCWK_PARAM0  切断処理中にエラー発生：SCR_FIELD_COMM_EXIT_NG
*/
//====================================================================
ev_field_comm_exit_event_call:
{
  _CALL sub_field_comm_exit_main
  _CHG_LOCAL_SCR                          //ローカルスクリプトに切り替え
}
_END

sub_field_comm_exit_main:
{
  DEFINE_LOCAL  i_comm_no
  DEFINE_LOCAL  i_ret
  
  _GET_FIELD_COMM_NO( i_comm_no )

  IF $i_comm_no == GAME_COMM_NO_NULL THEN
    $SCWK_PARAM0 = SCR_FIELD_COMM_EXIT_OK
    _RET
  ENDIF

  IF $i_comm_no == GAME_COMM_NO_INVASION THEN
    //パレス時は同意を得るまで切断しない
    _SYSWIN_MSG_DOWN( msg_common_fldcomm_exit_01)
    _YES_NO_WIN( i_ret )

    IF $i_ret == SCR_NO THEN
      $SCWK_PARAM0 = SCR_FIELD_COMM_EXIT_CANCEL
      _RET
    ENDIF
    _SYSWIN_MSG_DOWN( msg_common_fldcomm_exit_02)
    _FIELD_COMM_EXIT( i_ret )
    _SYSWIN_CLOSE()
  ELSE
    _FIELD_COMM_EXIT( i_ret )
  ENDIF
  
  $SCWK_PARAM0 = $i_ret
}
_RET


