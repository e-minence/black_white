//======================================================================
//                c04r0111.ev
//    スクリプトファイル：c04r0111用
//  ギアステーションホーム　バトルサブウェイ　終点ホーム
//======================================================================
  
  .text
  .include "scr_seq_def.h"
  .include "msg_c04r0111.h"
  .include "c04r0111.h"
  .include "bsubway_scr_def.h"
  .include "../../../prog/src/field/bsubway_scr_def.h"

//--------------------------------------------------------------
//  スクリプトテーブル
//--------------------------------------------------------------
_EVENT_DATA ev_init_c04r0111_home     //初期化
_EVENT_DATA ev_recover_c04r0111_home  //復帰
_EVENT_DATA ev_c04r0111_receipt_talk  //受付話し掛け
_EVENT_DATA ev_c04r0111_partner_talk  //パートナー話し掛け
_EVENT_DATA ev_c04r0111_npc_talk      //NPC話し掛け
_EVENT_DATA ev_c04r0111_home          //ゲームクリア後のホーム
_EVENT_DATA_END

//======================================================================
//  バトルサブウェイ　ホーム　初期化、復帰
//======================================================================
//--------------------------------------------------------------
//  ホーム　初期化
//--------------------------------------------------------------
INIT_EVENT_START ev_init_c04r0111_home
{
  DEFINE_LOCAL play_mode
  
  _BSUBWAY_TOOL( BSWTOOL_GET_DATA_PLAY_MODE, BSW_NULL, BSW_NULL, play_mode )
  
  //受付座標を変更
  _OBJ_POS_CHANGE( C04R0111_RECEIPT1, 17, 0, 13, DIR_RIGHT )
  _OBJ_POS_CHANGE( C04R0111_RECEIPT2, 76, 0, 14, DIR_LEFT )
  
  //ゲームクリア直後
  IF $WK_OTHER_BSUBWAY_HOME == BSWAY_SCENE_HOME_GAME_CLEAR THEN
    //電車セット
    _BSUBWAY_TOOL( BSWTOOL_SET_TRAIN, play_mode, BTRAIN_POS_HOME, BSW_NULL )
    
    //周回に合わせてNPC追加
    _BSUBWAY_TOOL( BSWSUB_SET_HOME_OBJ, BSW_NULL, BSW_NULL, BSW_NULL )
  ENDIF
}
INIT_EVENT_END

//--------------------------------------------------------------
//  ホーム　復帰
//--------------------------------------------------------------
INIT_EVENT_START ev_recover_c04r0111_home
{
  DEFINE_LOCAL play_mode
  
  _BSUBWAY_TOOL( BSWTOOL_GET_DATA_PLAY_MODE, BSW_NULL, BSW_NULL, play_mode )
  
  _CHECK_CONTINUE_RECOVER( SCWK_ANSWER )
  
  //コンテニュー復帰　ワーク作成
  IF $SCWK_ANSWER == TRUE THEN
    IF $WK_OTHER_BSUBWAY_HOME != BSWAY_SCENE_HOME_NON THEN
      _BSUBWAY_WORK_CREATE( BSWAY_PLAY_CONTINUE, play_mode )
      
      //通信マルチの場合は終点にする
      IF $play_mode == BSWAY_MODE_COMM_MULTI || $play_mode == BSWAY_MODE_S_COMM_MULTI THEN
        $WK_OTHER_BSUBWAY_HOME = BSWAY_SCENE_HOME_TERMINUS
      ENDIF
    ENDIF
  ENDIF
  
  //電車セット
  _BSUBWAY_TOOL( BSWTOOL_SET_TRAIN, play_mode, BTRAIN_POS_HOME, BSW_NULL )
  
  //途中駅ならば電車非表示
  IF $WK_OTHER_BSUBWAY_HOME == BSWAY_SCENE_HOME_STOPOVER THEN
    _BSUBWAY_TOOL( BSWTOOL_SET_TRAIN_VANISH, TRUE, BSW_NULL, BSW_NULL )
  ENDIF
}
INIT_EVENT_END

//======================================================================
//  バトルサブウェイ　ホーム　受付話し掛け
//======================================================================
//--------------------------------------------------------------
//  バトルサブウェイ　ホーム　受付話し掛け
//--------------------------------------------------------------
EVENT_START ev_c04r0111_receipt_talk
{
  _TALK_OBJ_START()
  
  IF $WK_OTHER_BSUBWAY_HOME == BSWAY_SCENE_HOME_STOPOVER THEN //途中駅
    _SYSWIN_MSG( msg_c04r0111_15 , WIN_DOWN )   //どうしますか
    _BMPMENU_INIT_EX( 1, 1, 0, 1, SCWK_ANSWER )
    _BMPMENU_MAKE_LIST( msg_c04r0111_16, 0 )    //続ける
    _BMPMENU_MAKE_LIST( msg_c04r0111_17, 1 )    //ライモン
    _BMPMENU_MAKE_LIST( msg_c04r0111_18, 2 )    //まだここにいる
    _BMPMENU_START()
    _SYSWIN_CLOSE()
    
    SWITCH $SCWK_ANSWER
    CASE 0 THEN //続けて挑戦
      _CALL sub_challenge_continue_mode
    CASE 1 THEN //ライモン戻り
      _CALL sub_mapchg_receipt
    ENDSWITCH
  ELSE //終点
    _CALL sub_mapchg_receipt
  ENDIF
}
EVENT_END

//--------------------------------------------------------------
//  受付話し掛け　続けて挑戦　モード別処理へ  
//--------------------------------------------------------------
sub_challenge_continue_mode:
{
  DEFINE_LOCAL play_mode
  
  _BSUBWAY_TOOL( BSWTOOL_GET_DATA_PLAY_MODE, BSW_NULL, BSW_NULL, play_mode )
  
  SWITCH $play_mode
  CASE BSWAY_MODE_SINGLE THEN
    _CALL sub_challenge_continue
  CASE BSWAY_MODE_S_SINGLE THEN
    _CALL sub_challenge_continue
  CASE BSWAY_MODE_DOUBLE THEN
    _CALL sub_challenge_continue
  CASE BSWAY_MODE_S_DOUBLE THEN
    _CALL sub_challenge_continue
  CASE BSWAY_MODE_MULTI THEN
    _CALL sub_challenge_continue
  CASE BSWAY_MODE_S_MULTI THEN
    _CALL sub_challenge_continue
  CASE BSWAY_MODE_COMM_MULTI THEN
    _CALL sub_challenge_continue_comm_multi
  CASE BSWAY_MODE_S_COMM_MULTI THEN
    _CALL sub_challenge_continue_comm_multi
  ENDSWITCH
}
_RET

//--------------------------------------------------------------
//  バトルサブウェイ　ホーム　受付話し掛け  続けてチャレンジ
//  シングル、ダブル、AIマルチ
//--------------------------------------------------------------
sub_challenge_continue:
{
  DEFINE_LOCAL play_mode
   
  _SYSWIN_MSG( msg_c04r0111_02 , WIN_DOWN ) //ご案内する前にレポート
  _AB_KEYWAIT()
  
  //受付をエラー状態に
  $WK_OTHER_BSUBWAY_RECEIPT = BSWAY_SCENE_RECEIPT_ERROR
  
  //車内を乗車状態に
  $WK_OTHER_BSUBWAY_TRAIN = BSWAY_SCENE_TRAIN_FIRST
  
  //プレイモード取得
  _BSUBWAY_TOOL( BSWSUB_GET_PLAY_MODE, BSW_NULL, BSW_NULL, play_mode )
  
  //戻り場所を受付に
  _BSUBWAY_TOOL( BSWSUB_SET_PLAY_MODE_LOCATION, BSW_NULL, BSW_NULL, BSW_NULL )
  //トレーナー抽選
  _BSUBWAY_TOOL( BSWSUB_BTL_TRAINER_SET, BSW_NULL, BSW_NULL, BSW_NULL )
  
  //ポケモンメンバーロード
  _BSUBWAY_TOOL( BSWSUB_LOAD_POKEMON_MEMBER, BSW_NULL, BSW_NULL, BSW_NULL)
  
  //レポート
  _REPORT_CALL( SCWK_ANSWER )
  _SYSWIN_CLOSE()
  
  //電車発車デモ
  _CALL sub_demo_train_starting
  
  //ホーム制御　無しに
  $WK_OTHER_BSUBWAY_HOME = BSWAY_SCENE_HOME_NON
  
  //マップ移動
  _MAP_CHANGE_NO_FADE( ZONE_ID_C04R0110, 7, 0, 4, DIR_UP )
}
_RET

//--------------------------------------------------------------
//  受付　続けてチャレンジ　commマルチ
//--------------------------------------------------------------
sub_challenge_continue_comm_multi:
{
  DEFINE_LOCAL ret
  DEFINE_LOCAL play_mode

  _SYSWIN_MSG( msg_c04r0111_02 , WIN_DOWN ) //ご案内する前にレポート
  _AB_KEYWAIT()
  
  //受付をエラー状態に
  $WK_OTHER_BSUBWAY_RECEIPT = BSWAY_SCENE_RECEIPT_ERROR
  
  //車内を乗車状態に
  $WK_OTHER_BSUBWAY_TRAIN = BSWAY_SCENE_TRAIN_FIRST
  
  //プレイモード取得
  _BSUBWAY_TOOL( BSWTOOL_GET_DATA_PLAY_MODE, BSW_NULL, BSW_NULL, play_mode )
  
  //戻り場所を受付に
  _BSUBWAY_TOOL( BSWSUB_SET_PLAY_MODE_LOCATION, BSW_NULL, BSW_NULL, BSW_NULL )

  //トレーナーセット開始
  _BSUBWAY_TOOL( BSWSUB_COMM_TIMSYNC, BSW_COMM_MULTI_BTL_TRAINER_SET, BSW_NULL, BSW_NULL )
  
  //親機なら対戦トレーナー抽選
  _BSUBWAY_TOOL( BSWSUB_COMM_GET_CURRENT_ID, BSW_NULL, BSW_NULL, ret )

  IF $ret == 0 THEN //親機なら対戦トレーナーセット
    //トレーナー抽選
    _BSUBWAY_TOOL( BSWSUB_BTL_TRAINER_SET, BSW_NULL, BSW_NULL, BSW_NULL )
    //受信バッファクリア
    _BSUBWAY_TOOL( BSWSUB_RECV_BUF_CLEAR, BSW_NULL, BSW_NULL, BSW_NULL )
    //子機に選んだデータを送信
    _BSUBWAY_TOOL( BSWSUB_COMM_SEND_BUF, BSWAY_COMM_TR_DATA, BSW_NULL, ret )
  ELSE //子機は親からデータを受け取る
    _BSUBWAY_TOOL( BSWSUB_COMM_RECV_BUF, BSWAY_COMM_TR_DATA, BSW_NULL, LOCALWORK0 ) 
  ENDIF
  
  //ポケモンメンバーロード
  _BSUBWAY_TOOL( BSWSUB_LOAD_POKEMON_MEMBER, BSW_NULL, BSW_NULL, BSW_NULL)
  
  //レポート
  _REPORT_CALL( SCWK_ANSWER )
  _SYSWIN_CLOSE()
  
  //通信同期待ち
  _BSUBWAY_TOOL( BSWSUB_COMM_TIMSYNC, BSW_COMM_MULTI_AUTO_SAVE, BSW_NULL, BSW_NULL )
  
  //電車発車デモ
  _CALL sub_demo_train_starting
  
  //ホーム制御　無しに
  $WK_OTHER_BSUBWAY_HOME = BSWAY_SCENE_HOME_NON

  //マップ移動
  _MAP_CHANGE_NO_FADE( ZONE_ID_C04R0110, 7, 0, 4, DIR_UP )
}
_RET

//--------------------------------------------------------------
//  バトルサブウェイ　ホーム　受付話し掛け  ライモンシティに戻る
//--------------------------------------------------------------
sub_mapchg_receipt:
{
  DEFINE_LOCAL play_mode
  DEFINE_LOCAL comm_flag
  
  //ライモンシティに戻るか
  _SYSWIN_MSG( msg_c04r0111_13, WIN_DOWN )
  _YES_NO_WIN( SCWK_ANSWER )
  
  IF $SCWK_ANSWER == 0 THEN
    //戻ります
    _SYSWIN_MSG( msg_c04r0111_14, WIN_DOWN )
    _LAST_KEYWAIT()
    
    //プレイモード取得
    _BSUBWAY_TOOL( BSWSUB_GET_PLAY_MODE, BSW_NULL, BSW_NULL, play_mode )
    
    //通信中であれば終了を伝える
    _BSUBWAY_TOOL( BSWSUB_GET_COMM_FLAG, BSW_NULL, BSW_NULL, comm_flag )
    
    IF $comm_flag == TRUE THEN
      _SYSWIN_MSG( msg_c04r0111_19, WIN_DOWN )
      
       //選択待ち通信同期
      _BSUBWAY_TOOL( BSWSUB_COMM_TIMSYNC, BSW_COMM_MULTI_RETIRE_WAIT, BSW_NULL, BSW_NULL )
      
      $LOCALWORK0 = 1 //リタイア
      
      //受信バッファクリア
      _BSUBWAY_TOOL( BSWSUB_RECV_BUF_CLEAR, BSW_NULL, BSW_NULL, BSW_NULL )

      //選択結果送信
      _BSUBWAY_TOOL( BSWSUB_COMM_SEND_BUF, BSWAY_COMM_RETIRE_SELECT, LOCALWORK0, BSW_NULL )
      //選択結果受信
      _BSUBWAY_TOOL( BSWSUB_COMM_RECV_BUF, BSWAY_COMM_RETIRE_SELECT, BSW_NULL, LOCALWORK0 )
      
      //戻ります
      _SYSWIN_MSG( msg_c04r0111_20 , WIN_DOWN )
      _TIME_WAIT( 30 )
      
      //通信切断
      _BSUBWAY_TOOL( BSWSUB_COMM_TIMSYNC, BSW_COMM_MULTI_SIO_END, BSW_NULL, BSW_NULL )
      _BSUBWAY_TOOL( BSWSUB_COMM_END, BSW_NULL, BSW_NULL, BSW_NULL )
      _BSUBWAY_TOOL( BSWSUB_SET_COMM_FLAG, FALSE, BSW_NULL, BSW_NULL )
    ENDIF
    
    //ウィンドウクローズ
    _SYSWIN_CLOSE()
    
    //受付対応　ゲーム後へ
    $WK_OTHER_BSUBWAY_RECEIPT = BSWAY_SCENE_RECEIPT_AFTER
    
    //電車発車デモ
    _CALL sub_demo_train_starting
    
    //ワーク開放
    _BSUBWAY_WORK_RELEASE()
    
    //ホーム制御　無しに
    $WK_OTHER_BSUBWAY_HOME = BSWAY_SCENE_HOME_NON
    
    //受付へと戻る
    _CHG_COMMON_SCR SCRID_BSW_RETMAP_RECEIPT
  ELSE
    _SYSWIN_CLOSE()
  ENDIF
}
_RET

//======================================================================
//  バトルサブウェイ　ホーム　パートナー話し掛け
//======================================================================
//--------------------------------------------------------------
//  バトルサブウェイ　ホーム　パートナー話し掛け
//--------------------------------------------------------------
EVENT_START ev_c04r0111_partner_talk
{
}
EVENT_END

//======================================================================
//  バトルサブウェイ　ホーム　NPC話し掛け
//======================================================================
//--------------------------------------------------------------
//  バトルサブウェイ　ホーム　NPC話し掛け
//--------------------------------------------------------------
EVENT_START ev_c04r0111_npc_talk
{
  DEFINE_LOCAL msg_id
  
  //HOME NPC用メッセージID取得
  _BSUBWAY_TOOL( BSWTOOL_GET_HOME_NPC_MSGID, SCWK_TARGET_OBJID, BSW_NULL, msg_id )
  _EASY_BALLOONWIN_TALKOBJ_MSG( msg_id )
}
EVENT_END

//======================================================================
//  バトルサブウェイ　ホーム　対戦終了後の戻り
//======================================================================
//--------------------------------------------------------------
//  ホーム　対戦終了後の戻り
//--------------------------------------------------------------
EVENT_START ev_c04r0111_home
{
  DEFINE_LOCAL ret
  DEFINE_LOCAL boss_f
  DEFINE_LOCAL play_mode
  
  //プレイモード取得
  _BSUBWAY_TOOL( BSWSUB_GET_PLAY_MODE, BSW_NULL, BSW_NULL, play_mode )

  //ボスを倒したか
  _BSUBWAY_TOOL( BSWSUB_GET_PLAY_BOSS_CLEAR, BSW_NULL, BSW_NULL, boss_f )
  
  //途中駅状態に
  $WK_OTHER_BSUBWAY_HOME = BSWAY_SCENE_HOME_STOPOVER
  
  //終点チェック
  SWITCH $play_mode
  CASE BSWAY_MODE_SINGLE THEN
    IF $boss_f == TRUE THEN
      $WK_OTHER_BSUBWAY_HOME = BSWAY_SCENE_HOME_TERMINUS
    ENDIF
  CASE BSWAY_MODE_S_SINGLE THEN
    _NOP
  CASE BSWAY_MODE_DOUBLE THEN
    IF $boss_f == TRUE THEN
      $WK_OTHER_BSUBWAY_HOME = BSWAY_SCENE_HOME_TERMINUS
    ENDIF
  CASE BSWAY_MODE_S_DOUBLE THEN
    _NOP
  CASE BSWAY_MODE_MULTI THEN
    IF $boss_f == TRUE THEN
      $WK_OTHER_BSUBWAY_HOME = BSWAY_SCENE_HOME_TERMINUS
    ENDIF
  CASE BSWAY_MODE_S_MULTI THEN
    _NOP
  CASE BSWAY_MODE_COMM_MULTI THEN
    IF $boss_f == TRUE THEN
      $WK_OTHER_BSUBWAY_HOME = BSWAY_SCENE_HOME_TERMINUS
    ENDIF
  CASE BSWAY_MODE_S_COMM_MULTI THEN
    _NOP
  CASE BSWAY_MODE_WIFI THEN
    $WK_OTHER_BSUBWAY_HOME = BSWAY_SCENE_HOME_TERMINUS
  ENDSWITCH
  
  //電車到着デモ
  _CALL sub_demo_train_arrival
  
  //戻り先を無効に
  _BSUBWAY_TOOL( BSWTOOL_POP_NOW_LOCATION, BSW_NULL, BSW_NULL,BSW_NULL )
  
  //ボスを倒したか？
  IF $boss_f == 1 THEN //倒した
    _BSUBWAY_TOOL( BSWSUB_CHK_S_MODE, BSW_NULL, BSW_NULL, SCWK_ANSWER )
    
    IF $SCWK_ANSWER == TRUE THEN //スーパーボスである
      _SYSWIN_MSG( msg_c04r0111_04 , WIN_DOWN ) //おめでとうございます
      _AB_KEYWAIT()
      
      _PLAYER_NAME( 0 )
      _NUMBER( 1, 50, 2 )
      _SYSWIN_MSG( msg_c04r0111_00 , WIN_DOWN ) //BPを手に入れた
      _ME_PLAY( SEQ_ME_ITEM )             //ファンファーレ
      _ME_WAIT()

      _BSUBWAY_TOOL( BSWTOOL_GET_S_BOSS_CLEAR_FLAG, play_mode, BSW_NULL, SCWK_ANSWER )
      
       IF $SCWK_ANSWER == 0 THEN //初めて倒した
        _SYSWIN_MSG( msg_c04r0111_08 , WIN_DOWN ) //トロフィを差し上げます
        _AB_KEYWAIT()
        _BSUBWAY_TOOL( BSWTOOL_SET_S_BOSS_CLEAR_FLAG, play_mode, BSW_NULL, BSW_NULL )
      ENDIF
    ELSE  //ノーマルボスである
      _SYSWIN_MSG( msg_c04r0111_04 , WIN_DOWN ) //おめでとうございます
      _AB_KEYWAIT()
      
      _PLAYER_NAME( 0 )
      _NUMBER( 1, 50, 2 )
      _SYSWIN_MSG( msg_c04r0111_00 , WIN_DOWN ) //BPを手に入れた
      _ME_PLAY( SEQ_ME_ITEM )             //ファンファーレ
      _ME_WAIT()
   
      _BSUBWAY_TOOL( BSWTOOL_GET_BOSS_CLEAR_FLAG, play_mode, BSW_NULL, SCWK_ANSWER )
    
      IF $SCWK_ANSWER == 0 THEN //初めて倒した
        _SYSWIN_MSG( msg_c04r0111_05 , WIN_DOWN ) //スーパーに挑戦出来ます
        _AB_KEYWAIT()
        _BSUBWAY_TOOL( BSWTOOL_SET_BOSS_CLEAR_FLAG, play_mode, BSW_NULL, BSW_NULL )
      ENDIF
    ENDIF
  ELSE //ボス倒していない
    _SYSWIN_MSG( msg_c04r0111_03 , WIN_DOWN ) //おめでとうございます
    _AB_KEYWAIT()
  
    _PLAYER_NAME( 0 )
    _NUMBER( 1, 50, 2 )
    _SYSWIN_MSG( msg_c04r0111_00 , WIN_DOWN ) //BPを手に入れた
    _ME_PLAY( SEQ_ME_ITEM )             //ファンファーレ
    _ME_WAIT()
  ENDIF
  
  //wifiランク処理
  IF $play_mode == BSWAY_MODE_WIFI THEN
    _BSUBWAY_TOOL( BSWTOOL_WIFI_CHK_SEL_DL_BTL, BSW_NULL, BSW_NULL, ret )
    
    IF $ret == TRUE THEN //ダウンロードによる新規プレイである
      //ランクアップ処理
      _BSUBWAY_TOOL( BSWTOOL_UP_WIFI_RANK, BSW_NULL, BSW_NULL, ret )
      
      IF $ret != 0 THEN //ランクアップした
        //ランク？になりました
        _SYSWIN_MSG( msg_c04r0111_21, WIN_DOWN )
      
        //今回の成績をWifiに送るか？
        _SYSWIN_MSG( msg_c04r0111_22, WIN_DOWN )
        _YES_NO_WIN( SCWK_ANSWER )
        _SYSWIN_CLOSE()

        IF $SCWK_ANSWER == SCR_YES THEN //送る
          _BSUBWAY_TOOL( BSWTOOL_WIFI_UPLOAD_SCORE, BSW_NULL, BSW_NULL, BSW_NULL )
          _BSUBWAY_TOOL( BSWTOOL_WIFI_SET_UPLOAD_FLAG, 0, BSW_NULL, ret )
        ELSE //送らない
          //未ダウンロードフラグセット
          _BSUBWAY_TOOL( BSWTOOL_WIFI_SET_UPLOAD_FLAG, 1, BSW_NULL, ret )
        ENDIF
      ENDIF
    ENDIF
  ENDIF
  
  //レポート
  _SYSWIN_MSG( msg_c04r0111_01 , WIN_DOWN )
  _REPORT_CALL( SCWK_ANSWER )
  
  IF $WK_OTHER_BSUBWAY_HOME == BSWAY_SCENE_HOME_STOPOVER THEN
    //途中駅　また話し掛けてくれ
    _SYSWIN_MSG( msg_c04r0111_09 , WIN_DOWN )
  ELSE
    //終点　終点メッセージ
    SWITCH $play_mode
    CASE BSWAY_MODE_SINGLE THEN
     _SYSWIN_MSG( msg_c04r0111_10, WIN_DOWN )
    CASE BSWAY_MODE_DOUBLE THEN
     _SYSWIN_MSG( msg_c04r0111_11, WIN_DOWN )
    CASE BSWAY_MODE_MULTI THEN
      _SYSWIN_MSG( msg_c04r0111_12, WIN_DOWN )
    ENDSWITCH
  ENDIF
  
  _LAST_KEYWAIT()
  _SYSWIN_CLOSE()
  
  //ホーム到着用ワークセット
  _BSUBWAY_TOOL( BSWSUB_SET_HOME_WORK, BSW_NULL, BSW_NULL, BSW_NULL )
}
EVENT_END

//======================================================================
//  デモ
//======================================================================
//--------------------------------------------------------------
//  電車到着デモ
//--------------------------------------------------------------
sub_demo_train_arrival:
{
  DEFINE_LOCAL play_mode
  DEFINE_LOCAL ai_multi
  
  //プレイモード取得
  _BSUBWAY_TOOL( BSWSUB_GET_PLAY_MODE, BSW_NULL, BSW_NULL, play_mode )
  
  IF $play_mode == BSWAY_MODE_MULTI || $play_mode == BSWAY_MODE_S_MULTI THEN
    $ai_multi = TRUE
  ELSE
    $ai_multi = FALSE
  ENDIF
  
  //自機初期設定
  _OBJ_POS_CHANGE( MMDL_ID_PLAYER, 75, 0, 12, DIR_DOWN )
  _BSUBWAY_TOOL( BSWTOOL_OBJ_VANISH, MMDL_ID_PLAYER, TRUE, BSW_NULL )
  _BSUBWAY_TOOL( BSWTOOL_OBJ_HEIGHT_OFF, MMDL_ID_PLAYER, 0, BSW_NULL )
  
  //マルチならパートナー追加
  IF $ai_multi == TRUE THEN
     $OBJCHRWORK0 = SUPPORT
    _FLAG_RESET( FV_C04R0111_PARTNER )
    _OBJ_ADD( C04R0111_PARTNER )
    _BSUBWAY_TOOL( BSWTOOL_OBJ_HEIGHT_OFF, C04R0111_PARTNER, 0, BSW_NULL )
    _BSUBWAY_TOOL( BSWTOOL_OBJ_VANISH, C04R0111_PARTNER, TRUE, BSW_NULL )
    _OBJ_POS_CHANGE( C04R0111_PARTNER, 75, 0, 12, DIR_DOWN )
  ENDIF
  
  //到着アニメ
  _BSUBWAY_TOOL( BSWTOOL_SET_TRAIN_ANM, 2, BTRAIN_POS_RECEIPT, BSW_NULL )
  
  //マップフェードイン
  _MAP_FADE_BLACK_IN()
  _MAP_FADE_END_CHECK()
  
  _TIME_WAIT( 50 ) //アニメを待つ
  
  //自機登場アニメ
  _OBJ_ANIME( MMDL_ID_PLAYER, anm_demo_train_arrival_jiki )
  
  //パートナーアニメ
  IF $ai_multi == TRUE THEN
    _OBJ_ANIME( C04R0111_PARTNER, anm_demo_train_arrival_partner )
  ENDIF
  
  //OBJアニメ待ち
  _OBJ_ANIME_WAIT()
  
  //自機高さを戻す
  _BSUBWAY_TOOL( BSWTOOL_OBJ_HEIGHT_ON, MMDL_ID_PLAYER, 0, BSW_NULL )

  //パートナー高さ戻す
  IF $ai_multi == TRUE THEN
    _BSUBWAY_TOOL( BSWTOOL_OBJ_HEIGHT_ON, C04R0111_PARTNER, 0, BSW_NULL )
  ENDIF
  
  //途中駅なら電車去る
  IF $WK_OTHER_BSUBWAY_HOME == BSWAY_SCENE_HOME_STOPOVER THEN
    _TIME_WAIT( 20 ) //ちょっと待つ
    _BSUBWAY_TOOL( BSWTOOL_SET_TRAIN_ANM, 0, BTRAIN_POS_RECEIPT, BSW_NULL )
    _TIME_WAIT( 30 ) //ちょっと待つ
    
    //ブラックアウト
    _BLACK_OUT()
    _DISP_FADE_END_CHECK()
    
    //電車消す
    _BSUBWAY_TOOL( BSWTOOL_SET_TRAIN_VANISH, TRUE, BSW_NULL, BSW_NULL )
    
    //フェードイン
    _BLACK_IN()
    _DISP_FADE_END_CHECK()
  ENDIF
}
_RET

//アニメデータ　電車到着デモ　自機下車
_ANIME_LABEL anm_demo_train_arrival_jiki
  _ANIME_DATA AC_VANISH_OFF,1
  _ANIME_DATA AC_WAIT_1F,4
  _ANIME_DATA AC_WALK_D_8F,2
  _ANIME_DATA AC_STAY_WALK_R_8F,1
  _ANIME_DATA ACMD_END,0

//アニメデータ　電車到着デモ　パートナー下車
_ANIME_LABEL anm_demo_train_arrival_partner
  _ANIME_DATA AC_WAIT_1F,14
  _ANIME_DATA AC_VANISH_OFF,1
  _ANIME_DATA AC_WAIT_1F,4
  _ANIME_DATA AC_WALK_D_8F,1
  _ANIME_DATA AC_STAY_WALK_R_8F,1
  _ANIME_DATA ACMD_END,0

//--------------------------------------------------------------
//  電車出発デモ
//--------------------------------------------------------------
sub_demo_train_starting:
{
  DEFINE_LOCAL play_mode
  DEFINE_LOCAL ai_multi
  
  //マップフェードアウト
  _BLACK_OUT()
  _DISP_FADE_END_CHECK()

  //プレイモード取得
  _BSUBWAY_TOOL( BSWSUB_GET_PLAY_MODE, BSW_NULL, BSW_NULL, play_mode )
  
  IF $play_mode == BSWAY_MODE_MULTI || $play_mode == BSWAY_MODE_S_MULTI THEN
    $ai_multi = TRUE
  ELSE
    $ai_multi = FALSE
  ENDIF
  
  //自機初期設定
  _OBJ_POS_CHANGE( MMDL_ID_PLAYER, 18, 0, 13, DIR_LEFT )
  _BSUBWAY_TOOL( BSWTOOL_OBJ_HEIGHT_OFF, MMDL_ID_PLAYER, 0, BSW_NULL )
  
  //マルチならパートナー設定
  IF $ai_multi == TRUE THEN
    _OBJ_POS_CHANGE( C04R0111_PARTNER, 19, 0, 13, DIR_LEFT )
    _BSUBWAY_TOOL( BSWTOOL_OBJ_HEIGHT_OFF, C04R0111_PARTNER, 0, BSW_NULL )
  ENDIF
  
  //マップフェードイン開始
  _BLACK_IN()
  
  //途中駅ならば電車到着アニメ
  IF $WK_OTHER_BSUBWAY_HOME == BSWAY_SCENE_HOME_STOPOVER THEN
    _BSUBWAY_TOOL( BSWTOOL_SET_TRAIN_ANM, 2, BTRAIN_POS_HOME, BSW_NULL )
    _BSUBWAY_TOOL( BSWTOOL_SET_TRAIN_VANISH, FALSE, BSW_NULL, BSW_NULL )
    _TIME_WAIT( 100 ) //アニメを待つ
  ENDIF
  
  //フェードインチェック
  _DISP_FADE_END_CHECK()
  
  //自機乗車アニメ
  _OBJ_ANIME( MMDL_ID_PLAYER, anm_demo_train_starting_jiki )
  
  //パートナーアニメ
  IF $ai_multi == TRUE THEN
    _OBJ_ANIME( C04R0111_PARTNER, anm_demo_train_starting_partner )
  ENDIF
  
  //アニメ終了待ち
  _OBJ_ANIME_WAIT()
  
  //電車発車
  _BSUBWAY_TOOL( BSWTOOL_SET_TRAIN_ANM, 3, BTRAIN_POS_HOME, BSW_NULL )
  _TIME_WAIT( 30 ) //アニメを少し見せる
  
  //マップフェードアウト
  _MAP_FADE_BLACK_OUT()
  _MAP_FADE_END_CHECK()
}
_RET

//アニメデータ　電車発車デモ　自機乗車
_ANIME_LABEL anm_demo_train_starting_jiki
  _ANIME_DATA AC_STAY_WALK_U_8F,1
  _ANIME_DATA AC_WALK_U_8F,1
  _ANIME_DATA AC_WAIT_1F,8
  _ANIME_DATA AC_VANISH_ON,1
  _ANIME_DATA ACMD_END,0

//アニメデータ　電車発車デモ　パートナー乗車
_ANIME_LABEL anm_demo_train_starting_partner
  _ANIME_DATA AC_WAIT_1F,32
  _ANIME_DATA AC_WALK_L_8F,1
  _ANIME_DATA AC_WALK_U_8F,1
  _ANIME_DATA AC_WAIT_1F,8
  _ANIME_DATA AC_VANISH_ON,1
  _ANIME_DATA ACMD_END,0
