//======================================================================
//                wifi_club_scr.ev
//
//    スクリプトファイル：wifi_club_scr用
//
//======================================================================

  .text

  .include  "scr_seq_def.h"
  .include  "msg_wifi_club_scr.h"
  //.include  "wifi_club_scr.h"
  .include  "wifi_club_scr_local.h"

  .include  "../../../prog/include/system/timezone.h" //時間帯定義

//--------------------------------------------------------------
//               スクリプト本体
//--------------------------------------------------------------
//--------------------------------------------------------------
//               スクリプトテーブル
//--------------------------------------------------------------
_EVENT_DATA    ev_wifi_club_counter
_EVENT_DATA_END

DEFINE_LOCAL  reg_return

{ //WIFI_CLUB_COUNTER

DEFINE_LOCAL  LWK_POKERUS_STATUS
DEFINE_LOCAL  LWK_TRAINER_CARD_STATUS
DEFINE_LOCAL  LWK_RECOVER_YESNO
DEFINE_LOCAL  lwk_return 
DEFINE_LOCAL  LWK_STATE_SELECT
DEFINE_LOCAL  LWK_FRIEND_NUM
DEFINE_LOCAL  LWK_ID_STATE

//==============================================================
/// 
///
///       ポケモンセンター　WI-FIクラブ受付                   
///
///
//==============================================================
EVENT_START   ev_wifi_club_counter
{
  _TALK_OBJ_START()
    
  _BALLOONWIN_TALKOBJ_OPEN( msg_wifi_club_01_01 ) //Wi-Fiクラブへようこそ
  _BALLOONWIN_CLOSE()
/*

  $i_seq = SEQ_CONNECT

  WHILE $i_loop == TRUE
    SWITCH  $i_seq

    CASE SEQ_CGEAR_CHECK  //C-Gearチェック
      $i_seq = SEQ_DAMETAMA_CHECK
    
    CASE SEQ_DAMETAMA_CHECK //ダメタマゴチェック
      $i_seq = SEQ_MENU

    CASE SEQ_MENU   //メニュー表示
      _CALL sub_club_counter_menu
      $i_seq = $lwk_return

    CASE SEQ_CLUB_EXP
      _BALLOONWIN_TALKOBJ_OPEN( msg_wifi_club_01_07 ) //Wi-Fiクラブでは…
      $i_seq = SEQ_MENU

    CASE SEQ_CONNECT

    CASE SEQ_CANCEL
      _BALLOONWIN_TALKOBJ_OPEN( msg_wifi_club_01_02 ) //それではまたお越しください
      $i_loop = FALSE
    ENDSWITCH
  ENDWHILE

  //登録人数チェック
  _LDVAL( LWK_FRIEND_NUM, 1 )

  IF $LWK_FRIEND_NUM == 0 THEN
    _LDVAL( LWK_ID_STATE, 0 ) 
    IF $LWK_ID_STATE == 0 THEN
      //仮ID
    ELSE
      //本ID
    ENDIF
  ENDIF

  _BALLOONWIN_TALKOBJ_OPEN( msg_wifi_club_01_01 ) //Wi-Fiクラブへようこそ

  _YES_NO_WIN( LWK_RECOVER_YESNO )
  _BALLOONWIN_CLOSE()

  IF $LWK_RECOVER_YESNO == 0 THEN
    //預ける場合

    _BALLOONWIN_TALKOBJ_OPEN( msg_pc_heal_04 ) //それでは　おあずかりします
    
    _CALL sub_heal_kaifuku_anime                      //回復アニメ呼び出し
    _TEMOTI_POKEMON_KAIFUKU()                         //手持ちポケモン回復処理

    _BALLOONWIN_CLOSE()

    _CHECK_TEMOTI_POKERUS( LWK_POKERUS_STATUS )
    IF $LWK_POKERUS_STATUS == TRUE && FLAG_OFF( FE_PC_POKERUS )  THEN
    //ポケルス状態ポケモンがいて、その状態で初めての来店だったら
      _FLAG_SET( FE_PC_POKERUS )
      _BALLOONWIN_TALKOBJ_OPEN( msg_pc_heal_10 )
      _LAST_KEYWAIT()
      _BALLOONWIN_CLOSE()
    ELSE
      _CALL sub_club_counter_goodbye    //またのご利用を
    ENDIF

  ELSE
    //預けるのを断った場合

    _CALL sub_club_counter_goodbye    //またのご利用を
  ENDIF
*/
  }
EVENT_END


//==============================================================
//サブルーチン：受付メイン
//==============================================================
sub_club_counter_main:
{
  DEFINE_LOCAL  i_ret
  DEFINE_LOCAL  i_seq
  DEFINE_LOCAL  i_loop

  //C-Gear取得チェック
  $i_ret = TRUE

  IF $i_ret != TRUE THEN
    _BALLOONWIN_TALKOBJ_OPEN( msg_wifi_club_01_err01 ) //また後でお越しください
    _BALLOONWIN_CLOSE()
    _RET
  ENDIF
 
  //ダメタマチェック
  $i_ret = TRUE
  IF $i_ret != TRUE THEN
    _BALLOONWIN_TALKOBJ_OPEN( msg_wifi_club_01_err02 ) //手持ちに連れて行けないポケモンがいます
    _BALLOONWIN_CLOSE()
    _RET
  ENDIF
 
  $i_seq = SEQ_MENU
  $i_loop = TRUE

  WHILE $i_loop == TRUE
    SWITCH  $i_seq
    CASE SEQ_MENU THEN //メニュー表示
      _CALL sub_club_counter_menu
      $i_seq = $lwk_return

    CASE SEQ_CLUB_EXP THEN
      _BALLOONWIN_TALKOBJ_OPEN( msg_wifi_club_01_07 ) //Wi-Fiクラブでは…
      $i_seq = SEQ_MENU

    CASE SEQ_CONNECT THEN

    CASE SEQ_CANCEL THEN
      _BALLOONWIN_TALKOBJ_OPEN( msg_wifi_club_01_02 ) //それではまたお越しください
      _BALLOONWIN_CLOSE()
      $i_loop = FALSE
    ENDSWITCH
  ENDWHILE

  //分岐・Wi-Fiクラブへいく・せつめいをきく・やめる
	_BMPMENU_INIT_EX( 1, 1, 0, 1, lwk_return )
		
	_BMPMENU_MAKE_LIST( msg_wifi_club_01_win01, SEQ_CONNECT )	//Wi-Fiクラブへ行く
	_BMPMENU_MAKE_LIST( msg_wifi_club_01_win02, SEQ_CLUB_EXP )	//説明を聞く
	_BMPMENU_MAKE_LIST( msg_wifi_club_01_win03, SEQ_CANCEL )	//やめる
		
	//メニュー表示
	_BMPMENU_START()
}
_RET

//==============================================================
//サブルーチン：メニュー表示
//==============================================================
sub_club_counter_menu:
{
  //分岐・Wi-Fiクラブへいく・せつめいをきく・やめる
	_BMPMENU_INIT_EX( 1, 1, 0, 1, lwk_return )
		
	_BMPMENU_MAKE_LIST( msg_wifi_club_01_win01, SEQ_CONNECT )	//Wi-Fiクラブへ行く
	_BMPMENU_MAKE_LIST( msg_wifi_club_01_win02, SEQ_CLUB_EXP )	//説明を聞く
	_BMPMENU_MAKE_LIST( msg_wifi_club_01_win03, SEQ_CANCEL )	//やめる
		
	//メニュー表示
	_BMPMENU_START()
}
_RET

} //WIFI_CLUB_COUNTER_END

//==============================================================
//サブルーチン：〆のメッセージ
//==============================================================
sub_club_counter_goodbye:
  _OBJ_ANIME( SCWK_TARGET_OBJID, anm_wifi_club_p01_bow ) //お辞儀アニメ
  _OBJ_ANIME_WAIT()
  _BALLOONWIN_TALKOBJ_OPEN( msg_wifi_club_01_02 ) //それではまたお越しください
  _LAST_KEYWAIT()
  _BALLOONWIN_CLOSE()
_RET

//--------------------------------------------------------------------
//おじぎ
//--------------------------------------------------------------------
_ANIME_LABEL	anm_wifi_club_p01_bow
//【仮】  ジョーイさんお辞儀アニメが未対応
	//_ANIME_DATA	AC_PC_BOW,1
	//_ANIME_DATA	AC_WAIT_4F,1
	_ANIME_DATA	AC_DIR_L,1
	_ANIME_DATA	AC_WAIT_4F,1
	_ANIME_DATA	AC_DIR_U,1
	_ANIME_DATA	AC_WAIT_4F,1
	_ANIME_DATA	AC_DIR_R,1
	_ANIME_DATA	AC_WAIT_4F,1
	_ANIME_DATA	AC_DIR_D,1
	_ANIME_DATA	AC_WAIT_4F,1
	_ANIME_DATA	ACMD_END,0

//--------------------------------------------------------------------
//  びっくりマーク表示
//--------------------------------------------------------------------
_ANIME_LABEL	anm_wifi_club_p01_gyoe
  _ANIME_DATA AC_MARK_GYOE,1
  _ANIME_DATA ACMD_END, 0

/**************************************************************/
//サブルーチン：回復アニメ
/**************************************************************/
sub_heal_kaifuku_anime:
{
  DEFINE_LOCAL  POKEMON_COUNT

  _OBJ_ANIME( SCWK_TARGET_OBJID, anm_wifi_club_p01_turn_up )
  _OBJ_ANIME_WAIT()

  _GET_PARTY_POKE_COUNT( POKEMON_COUNT, POKECOUNT_MODE_TOTAL )
  _POKECEN_RECOVER_ANIME( POKEMON_COUNT )

  _OBJ_ANIME( SCWK_TARGET_OBJID, anm_wifi_club_p01_turn_down )
  _OBJ_ANIME_WAIT()
_RET
}

//--------------------------------------------------------------------
//  左を向く
//--------------------------------------------------------------------
_ANIME_LABEL	anm_wifi_club_p01_turn_up
	_ANIME_DATA	AC_DIR_U,1
	_ANIME_DATA	ACMD_END,0

//--------------------------------------------------------------------
//  下を向く
//--------------------------------------------------------------------
_ANIME_LABEL	anm_wifi_club_p01_turn_down
	_ANIME_DATA	AC_DIR_D,1
	_ANIME_DATA	ACMD_END,0







/**************************************************************/
/*                                                            */
/*                                                            */
/*        ポケモンセンター　ユニオン受付                      */
/*                                                            */
/*                                                            */
/**************************************************************/
/*

EVENT_START ev_union
{
  DEFINE_LOCAL have_cgear // C-gearを持っているかどうか
  DEFINE_LOCAL room_in    // ユニオンルームに入るかどうか
  DEFINE_LOCAL explain    // 説明を受けるかどうか
  DEFINE_LOCAL ret

  // ローカル変数の初期化
  _FLAG_SET( FE_CGEAR_GET )
  _FLAG_CHECK( FE_CGEAR_GET, have_cgear )
  $room_in    = FALSE
  $explain    = FALSE


  // C-gear持ってる場合
  IF $have_cgear == TRUE THEN 
    //「ユニオンルームにようこそ」
    _TALK_OBJ_START()
    _BALLOONWIN_TALKOBJ_OPEN( msg_pc_union_01 ) 
    // メニュー表示
    _BMPMENU_INIT_EX( 1, 8, 0, 1, ret )
    _BMPMENU_MAKE_LIST( msg_pc_union_menu_yes, msg_pc_union_menu_yes )
    _BMPMENU_MAKE_LIST( msg_pc_union_menu_no, msg_pc_union_menu_no )
    _BMPMENU_MAKE_LIST( msg_pc_union_menu_explain, msg_pc_union_menu_explain )
    _BMPMENU_START() 
    // 選択したら吹出しを閉じる
    _BALLOONWIN_CLOSE() 
    // 選択結果で分岐
    SWITCH $ret 
    CASE msg_pc_union_menu_yes THEN //-------『はい』
     $room_in = TRUE
    CASE msg_pc_union_menu_no THEN //--------『いいえ』
      $room_in = FALSE
    CASE msg_pc_union_menu_explain THEN //---『せつめいをきく』
      $explain = TRUE 
    ENDSWITCH
  ENDIF

  // C-gear持ってない場合
  IF $have_cgear != TRUE THEN 
    //「ただいま じゅんびちゅう です！」
    _BALLOONWIN_TALKOBJ_OPEN( msg_pc_union_06 ) 
    _AB_KEYWAIT()
    _BALLOONWIN_CLOSE()
  ENDIF 

  // 説明を聞く場合
  IF $explain == TRUE THEN
    //「へやにはいりますか？」
    _BALLOONWIN_TALKOBJ_OPEN( msg_pc_union_02 )
    _YES_NO_WIN( ret )
    _BALLOONWIN_CLOSE()
    //『はい』
    IF $ret == 0 THEN
      $room_in = TRUE
    ENDIF
  ENDIF

  // ユニオンルームに入る場合
  IF $room_in == TRUE THEN
    //「ワイヤレスつうしんをかいしします」
    _BALLOONWIN_TALKOBJ_OPEN( msg_pc_union_03 )
    _YES_NO_WIN( ret )
    _BALLOONWIN_CLOSE()
    //『いいえ』
    IF $ret == 1 THEN
      $room_in = FALSE
    ENDIF
  ENDIF

  // レポート処理
  IF $room_in == TRUE THEN
    // レポートを書く
    _REPORT_EVENT_CALL( ret )
    // 書き込みに失敗
    IF $ret != SCR_REPORT_OK THEN
      $room_in = FALSE
    ENDIF
  ENDIF

  // 入場
  IF $room_in == TRUE THEN
    //「おたのしみ ください」
    _BALLOONWIN_TALKOBJ_OPEN( msg_pc_union_04 )
    _AB_KEYWAIT()
    _BALLOONWIN_CLOSE()
    // @todo 移動アニメ
    // @todo マップチェンジ
  ENDIF

  // キャンセルした場合
  IF $room_in != TRUE THEN
    //「また おこしください」
    _BALLOONWIN_TALKOBJ_OPEN( msg_pc_union_05 )
    _AB_KEYWAIT()
    _BALLOONWIN_CLOSE()
  ENDIF
}
EVENT_END

*/
