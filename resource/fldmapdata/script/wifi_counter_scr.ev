//======================================================================
//                wifi_counter_scr.ev
//
//    スクリプトファイル：wifi_counter_scr用
//
//======================================================================

  .text

  .include  "scr_seq_def.h"
  .include  "msg_wifi_counter_scr.h"
  //.include  "wifi_counter_scr.h"
  .include  "wifi_counter_scr_local.h"

  .include  "../../../prog/include/system/timezone.h" //時間帯定義

//--------------------------------------------------------------
//               スクリプト本体
//--------------------------------------------------------------
//--------------------------------------------------------------
//               スクリプトテーブル
//--------------------------------------------------------------
_EVENT_DATA    ev_wifi_counter

_EVENT_DATA_END

DEFINE_LOCAL  reg_return

{ //WIFI_COUNTER
DEFINE_LOCAL  lwk_return 

//==============================================================
/// 
///
///       ポケモンセンター　WI-FI受付                   
///
///
//==============================================================
EVENT_START   ev_wifi_counter
{
  _TALK_OBJ_START()
  _CALL sub_wifi_counter_main
}
EVENT_END


//==============================================================
//サブルーチン：受付メイン
//==============================================================
sub_wifi_counter_main:
{
  DEFINE_LOCAL  i_ret
  DEFINE_LOCAL  i_seq
  DEFINE_LOCAL  i_loop

  //C-Gear取得チェック
  IF FLAG_OFF( FE_CGEAR_GET ) THEN
    _SYSWIN_MSG_DOWN( msg_wifi_counter_01_err01 ) //また後でお越しください
    _LAST_KEYWAIT()
    _SYSWIN_CLOSE()
    _RET
  ENDIF
 
  //ダメタマチェック
  _GET_PARTY_POKE_COUNT( i_ret, POKECOUNT_MODE_ONLY_DAME_EGG)
  IF $i_ret != 0 THEN
    _SYSWIN_MSG_DOWN( msg_wifi_counter_01_err02 ) //手持ちに連れて行けないポケモンがいます
    _LAST_KEYWAIT()
    _SYSWIN_CLOSE()
    _RET
  ENDIF

  _SYSWIN_MSG_DOWN( msg_wifi_counter_01_00 ) //Wi-Fiコネクションへようこそ
  $i_seq = SEQ_MAIN_MENU

  $i_loop = TRUE
  WHILE $i_loop == TRUE
    SWITCH  $i_seq
    CASE SEQ_MAIN_MENU THEN //メニュー表示
      _CALL sub_wifi_counter_main_menu
      $i_seq = $reg_return

    CASE SEQ_COUNTER_EXP THEN
      _SYSWIN_MSG_DOWN( msg_wifi_counter_01_07 ) //Wi-Fiコネクションでは…
      $i_seq = SEQ_MAIN_MENU

    CASE SEQ_RANDOM_MATCH THEN
      _CALL sub_wifi_random_match //ランダムマッチ
      $i_seq = $reg_return

    CASE SEQ_GLOBAL_TERMINAL THEN
      _CALL sub_wifi_global_terminal  //グローバルターミナル
      $i_seq = $reg_return
    
    CASE SEQ_GEO_NET THEN
      _CALL sub_wifi_geo_net  //ジオネット
      $i_seq = $reg_return  

    CASE SEQ_CONNECT THEN
      _CALL sub_wifi_counter_connect
      $i_seq = $reg_return

    CASE SEQ_GOODBYE THEN
      _SYSWIN_MSG_DOWN( msg_wifi_counter_01_02 ) //それではまたお越しください
      $i_seq = SEQ_EXIT
   
    CASE SEQ_RETRY THEN
      _SYSWIN_MSG_DOWN( msg_wifi_counter_01_err03 ) //もう一度最初からやり直してください
      $i_seq = SEQ_EXIT

    CASE SEQ_EXIT THEN
      _LAST_KEYWAIT()
      _SYSWIN_CLOSE()
      $i_loop = FALSE
    ENDSWITCH
  ENDWHILE
}
_RET

//==============================================================
//サブルーチン：メニュー表示
//==============================================================
sub_wifi_counter_main_menu:
{
  DEFINE_LOCAL  i_ret

  _SYSWIN_MSG_DOWN( msg_wifi_counter_01_01)

  //分岐・ランダムマッチ/GTS/ジオネット/説明を聞く/やめる
	_BMPMENU_INIT_EX( 1, 1, 0, 1, i_ret )
		
	_BMPMENU_MAKE_LIST( msg_wifi_counter_01_win01, SEQ_RANDOM_MATCH )	    //ランダムマッチ
	_BMPMENU_MAKE_LIST( msg_wifi_counter_01_win02, SEQ_GLOBAL_TERMINAL )	//グローバルターミナル
	_BMPMENU_MAKE_LIST( msg_wifi_counter_01_win03, SEQ_GOODBYE )	        //ジオネット
	_BMPMENU_MAKE_LIST( msg_wifi_counter_01_win04, SEQ_COUNTER_EXP )	    //説明を聞く
	_BMPMENU_MAKE_LIST( msg_wifi_counter_01_win05, SEQ_GOODBYE )        	//やめる
		
	//メニュー表示
	_BMPMENU_START()

  IF $i_ret == EV_WIN_B_CANCEL THEN
    $reg_return = SEQ_GOODBYE
  ELSE
    $reg_return = $i_ret
  ENDIF
}
_RET

//==============================================================
//サブルーチン：Wi-Fiコネクトチェック
//==============================================================
sub_wifi_counter_check_connect:
{
  DEFINE_LOCAL  i_ret
  DEFINE_LOCAL  i_friend_num
  DEFINE_LOCAL  i_id_state

  //IDの状態チェック

  _WIFI_CHECK_MY_GSID( i_id_state )
 // $i_id_state = 0

  //登録人数チェック
  _WIFI_GET_FRIEND_NUM( i_friend_num )
//  $i_friend_num = 1

  IF $i_id_state == TRUE THEN
    IF $i_friend_num == 0 THEN
      _SYSWIN_MSG_DOWN( msg_wifi_counter_01_06 ) //友だちを登録していないと利用できません
      _AB_KEYWAIT()
      _SYSWIN_CLOSE()
      $reg_return = SEQ_GOODBYE
    ELSE
      $reg_return = SEQ_CONNECT
    ENDIF
    _RET
  ENDIF

  //仮IDを取得しますか？
  _SYSWIN_MSG_DOWN( msg_wifi_counter_01_05 ) //自分のコードだけでも受け取りますか？
  _YES_NO_WIN( i_ret )
  
  //『はい』
  IF $i_ret == SCR_YES THEN
    $reg_return = SEQ_CONNECT
  ELSE
    $reg_return = SEQ_GOODBYE
  ENDIF
}
_RET

//==============================================================
//サブルーチン：Wi-Fiコネクト
//==============================================================
sub_wifi_counter_connect:
{
  DEFINE_LOCAL  i_ret
  DEFINE_LOCAL  i_friend_num
  DEFINE_LOCAL  i_id_state

  //Wi-Fi接続を開始しますか？
  _SYSWIN_MSG_DOWN( msg_wifi_counter_01_03 )
  _YES_NO_WIN( i_ret )
  _SYSWIN_CLOSE()

  IF $i_ret == SCR_NO THEN
    $reg_return = SEQ_GOODBYE
    _RET
  ENDIF

  // レポートを書く
  _REPORT_EVENT_CALL( i_ret )
  // 書き込みに失敗
  IF $i_ret != SCR_REPORT_OK THEN
    $reg_return = SEQ_GOODBYE
    _RET
  ENDIF
 
  //フィールド通信切断
  _FIELD_COMM_EXIT_EVENT_CALL( i_ret )

  IF $i_ret == SCR_FIELD_COMM_EXIT_CANCEL THEN
    $reg_return = SEQ_GOODBYE
    _RET
  ELSIF $i_ret == SCR_FIELD_COMM_EXIT_ERROR THEN
    $reg_return = SEQ_RETRY
    _RET
  ENDIF

  //接続　それではご案内します
  _SYSWIN_MSG_DOWN( msg_wifi_counter_01_04 )
  _AB_KEYWAIT()
  _SYSWIN_CLOSE()

  //引率アニメ再生
  _OBJ_ANIME( MMDL_ID_PLAYER, anm_wifi_counter_p01 )
  _OBJ_ANIME( SCWK_TARGET_OBJID, anm_wifi_counter_p01 )
  _OBJ_ANIME_WAIT()

  //エレベータアニメ再生


  //クラブイベント呼び出し
  _BLACK_OUT( )
	_DISP_FADE_END_CHECK()
  _WIFI_CLUB_EVENT_CALL()
	_BLACK_IN( )
	_DISP_FADE_END_CHECK()

  $reg_return = SEQ_GOODBYE
}
_RET


//==============================================================
//サブルーチン：ランダムマッチメイン
//==============================================================
sub_wifi_random_match:
{
  DEFINE_LOCAL  i_ret
  DEFINE_LOCAL  i_friend_num
  DEFINE_LOCAL  i_id_state

  //Wi-Fi接続を開始しますか？
  _SYSWIN_MSG_DOWN( msg_wifi_counter_01_03 )
  _YES_NO_WIN( i_ret )
  _SYSWIN_CLOSE()

  IF $i_ret == SCR_NO THEN
    $reg_return = SEQ_GOODBYE
    _RET
  ENDIF

  // レポートを書く
  _REPORT_EVENT_CALL( i_ret )
  // 書き込みに失敗
  IF $i_ret != SCR_REPORT_OK THEN
    $reg_return = SEQ_GOODBYE
    _RET
  ENDIF
 
  //フィールド通信切断
  _FIELD_COMM_EXIT_EVENT_CALL( i_ret )

  IF $i_ret == SCR_FIELD_COMM_EXIT_CANCEL THEN
    $reg_return = SEQ_GOODBYE
    _RET
  ELSIF $i_ret == SCR_FIELD_COMM_EXIT_ERROR THEN
    $reg_return = SEQ_RETRY
    _RET
  ENDIF

  //接続　それではご案内します
  _SYSWIN_MSG_DOWN( msg_wifi_counter_01_04 )
  _AB_KEYWAIT()
  _SYSWIN_CLOSE()

  //引率アニメ再生
  _OBJ_ANIME( MMDL_ID_PLAYER, anm_wifi_counter_p01 )
  _OBJ_ANIME( SCWK_TARGET_OBJID, anm_wifi_counter_p01 )
  _OBJ_ANIME_WAIT()

  //エレベータアニメ再生


  //クラブイベント呼び出し
  _BLACK_OUT( )
	_DISP_FADE_END_CHECK()
  _WIFI_CLUB_EVENT_CALL()
	_BLACK_IN( )
	_DISP_FADE_END_CHECK()

  $reg_return = SEQ_GOODBYE
}
_RET

//==============================================================
//サブルーチン：グローバルターミナル
//==============================================================
sub_wifi_global_terminal:
{
  DEFINE_LOCAL  i_ret
  DEFINE_LOCAL  i_seq
  DEFINE_LOCAL  i_loop

  $i_seq = SEQ_SUB_GTERMINAL_MENU
  $i_loop = TRUE

  WHILE $i_loop == TRUE
    SWITCH  $i_seq
    CASE SEQ_SUB_GTERMINAL_MENU THEN
      _CALL sub_gterminal_menu  //メニュー表示
      $i_seq = $reg_return
    
    CASE SEQ_SUB_GTERMINAL_EXP THEN
      _SYSWIN_MSG_DOWN( msg_gterminal_exp01 ) //説明を聞く
      $i_seq = SEQ_SUB_GTERMINAL_MENU
 
    CASE SEQ_SUB_GTERMINAL_GTS THEN
      _CALL sub_gterminal_gts  //GTS
      $i_seq = $reg_return
 
    CASE SEQ_SUB_GTERMINAL_BTL_VIDEO THEN
      _CALL sub_gterminal_btl_video  //バトルビデオ
      $i_seq = $reg_return
 
    CASE SEQ_SUB_GTERMINAL_MUSICAL THEN
      _CALL sub_gterminal_musical  //ミュージカル
      $i_seq = $reg_return
 
    CASE SEQ_SUB_GTERMINAL_RETURN THEN
      $i_loop = FALSE
    ENDSWITCH
  ENDWHILE
  $reg_return = SEQ_MAIN_MENU
}
_RET

//--------------------------------------------------------------
//グローバルターミナル：メニュー表示
//--------------------------------------------------------------
sub_gterminal_menu:
{
  DEFINE_LOCAL  i_ret

  //分岐・GTS/バトルビデオ/ミュージカルショット/説明を聞く/やめる
	_BMPMENU_INIT_EX( 1, 1, 0, 1, i_ret )
		
	_BMPMENU_MAKE_LIST( msg_gterminal_win01, SEQ_SUB_GTERMINAL_GTS)	        //GTS
	_BMPMENU_MAKE_LIST( msg_gterminal_win02, SEQ_SUB_GTERMINAL_BTL_VIDEO )	//バトルビデオ
	_BMPMENU_MAKE_LIST( msg_gterminal_win03, SEQ_SUB_GTERMINAL_MUSICAL )    //ミュージカルショット
	_BMPMENU_MAKE_LIST( msg_gterminal_win04, SEQ_SUB_GTERMINAL_EXP )	      //説明を聞く
	_BMPMENU_MAKE_LIST( msg_gterminal_win05, SEQ_SUB_GTERMINAL_RETURN )     //もどる
		
	//メニュー表示
	_BMPMENU_START()

  IF $i_ret == EV_WIN_B_CANCEL THEN
    $reg_return = SEQ_SUB_GTERMINAL_RETURN
  ELSE
    $reg_return = $i_ret
  ENDIF
}
_RET

//--------------------------------------------------------------
//グローバルターミナル：GTS
//--------------------------------------------------------------
sub_gterminal_gts:
{
  $reg_return = SEQ_SUB_GTERMINAL_MENU
}
_RET

//--------------------------------------------------------------
//グローバルターミナル：バトルビデオ
//--------------------------------------------------------------
sub_gterminal_btl_video:
{
  
  $reg_return = SEQ_SUB_GTERMINAL_MENU
}
_RET

//--------------------------------------------------------------
//グローバルターミナル：ミュージカルショット
//--------------------------------------------------------------
sub_gterminal_musical:
{
  $reg_return = SEQ_SUB_GTERMINAL_MENU
}
_RET

//==============================================================
//サブルーチン：ジオネット
//==============================================================
sub_wifi_geo_net:
{
  DEFINE_LOCAL  i_ret

  $reg_return = SEQ_GOODBYE
}
_RET


} //WIFI_COUNTER_END

//==============================================================
//サブルーチン：〆のメッセージ
//==============================================================
sub_wifi_counter_goodbye:
  _OBJ_ANIME( SCWK_TARGET_OBJID, anm_wifi_counter_p01 ) //お辞儀アニメ
  _OBJ_ANIME_WAIT()
  _SYSWIN_MSG_DOWN( msg_wifi_counter_01_02 ) //それではまたお越しください
  _LAST_KEYWAIT()
  _SYSWIN_CLOSE()
_RET

//--------------------------------------------------------------------
//通信部屋へ誘導
//--------------------------------------------------------------------
_ANIME_LABEL	anm_wifi_counter_p01
//【仮】  ジョーイさんお辞儀アニメが未対応
	//_ANIME_DATA	AC_PC_BOW,1
	//_ANIME_DATA	AC_WAIT_4F,1
	_ANIME_DATA	AC_DIR_L,1
	_ANIME_DATA	AC_WAIT_4F,1
	_ANIME_DATA	AC_DIR_U,1
	_ANIME_DATA	AC_WAIT_4F,1
	_ANIME_DATA	AC_DIR_R,1
	_ANIME_DATA	AC_WAIT_4F,1
	_ANIME_DATA	AC_DIR_D,1
	_ANIME_DATA	AC_WAIT_4F,1
	_ANIME_DATA	ACMD_END,0

