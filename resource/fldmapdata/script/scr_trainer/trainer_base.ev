//******************************************************************
//  会話からのトレーナー戦闘
//  SCWK_TEMP0  トレーナーID
//  SCWK_TEMP3  退避トレーナーID
//******************************************************************
EVENT_START ev_trainer_talk_battle
  _TALK_OBJ_START()
  
  //トレーナーID取得
  _TRAINER_ID_GET( SCWK_TEMP0 )
  
  /* //wb null
  //かくれみのアニメチェック
  //戻り値取得ワーク、話しかけ対象OBJID
  _MOVE_CODE_GET(   SCWK_PARAM1,SCWK_TARGET_OBJID )
  _IFVAL_CALL SCWK_PARAM1,EQ,MV_HIDE_SNOW,ev_trainer_talk_battle_hide_pulloff
  _IFVAL_CALL SCWK_PARAM1,EQ,MV_HIDE_SAND,ev_trainer_talk_battle_hide_pulloff
  _IFVAL_CALL SCWK_PARAM1,EQ,MV_HIDE_GRND,ev_trainer_talk_battle_hide_pulloff
  _IFVAL_CALL SCWK_PARAM1,EQ,MV_HIDE_KUSA,ev_trainer_talk_battle_hide_pulloff
  */
  
  //すでに勝利しているトレーナーかチェックして、戦闘勝利後の会話へ
  _IF_TR_FLAGON_JUMP SCWK_TEMP0,ev_trainer_talk_after
  
  //トレーナータイプ取得(シングル、ダブル、タッグ)
  _TRAINER_TYPE_GET( SCWK_ANSWER )

  IF $SCWK_ANSWER != SCR_EYE_TR_TYPE_DOUBLE THEN
    _CALL ev_trainer_common_10 //シングル
  ELSE
    //ダブルだったらチェックする！
    //ここで手持ちが2匹かチェックしないと、戦闘に進んでしまうのでダメ！
    _2VS2_BATTLE_CHECK SCWK_ANSWER
    
    IF $SCWK_ANSWER == 0 THEN
      _CALL ev_trainer_talk_battle_poke_one
    ELSE
      _CALL ev_trainer_common_10
    ENDIF
  ENDIF
EVENT_END

ev_trainer_common_10:
  _TRAINER_BGM_SET( SCWK_TEMP0 ) //視線曲セット
  _TRAINER_TALK_TYPE_GET( SCWK_PARAM0,SCWK_PARAM1,SCWK_PARAM2 )
  _TRAINER_MSG_SET( SCWK_TEMP0,SCWK_PARAM0 )
  _CALL ev_trainer_common_11
  _RET
  
ev_trainer_common_11:
  _AB_KEYWAIT()
  _BALLOONWIN_CLOSE()
  
  /*
  //通常、再戦トレーナーにかかわらず、
  //戦闘後に表示方向固定の動作コードをセットするように変更(06.07.10)
  //話しかけのみしか使えないコマンドなので注意！
  _BTL_SEARCHER_DIR_MV_SET
  */
  
  //戦闘呼び出し
  _TRAINER_BTL_SET( SCWK_TEMP0,0 )
  _TRAINER_LOSE_CHECK(  SCWK_ANSWER )

  IF $SCWK_ANSWER == SCR_BATTLE_RESULT_WIN THEN
    _TRAINER_WIN()
  ELSE
    _TRAINER_LOSE()
  ENDIF

  //これを外さないと、再戦トレーナーIDが書き換わってしまう！
  //トレーナーID取得(一応)
  //_TRAINER_ID_GET  SCWK_TEMP0
  
  //トレーナーフラグセット
  _TRAINER_FLAG_SET( SCWK_TEMP0 )
  _RET

//--------------------------------------------------------------------
//  戦闘勝利後の会話
//--------------------------------------------------------------------
ev_trainer_talk_after:
  /*
  //話しかけたトレーナーが再戦可能かチェック
  _REVENGE_TRAINER_SEARCH SCWK_TEMP0,SCWK_ANSWER
  _IFVAL_JUMP        SCWK_ANSWER,NE,0,ev_trainer_revenge
  */
  _JUMP        ev_trainer_talk_after_normal
EVENT_END

EVENT_START   ev_trainer_talk_after_normal
  _TALK_START_SE_PLAY()
  
  //メッセージを取得
  _TRAINER_TALK_TYPE_GET(  SCWK_PARAM0,SCWK_PARAM1,SCWK_PARAM2 )
  _TRAINER_MSG_SET(  SCWK_TEMP0,SCWK_PARAM1 )
  _AB_KEYWAIT()
  _BALLOONWIN_CLOSE()
  
EVENT_END

//--------------------------------------------------------------------
//  再戦
//--------------------------------------------------------------------
ev_trainer_revenge:
/*
  $SCWK_TEMP3 = $SCWK_ANSWER    //再戦トレーナーIDを退避

  //トレーナータイプ取得(シングル、ダブル、タッグ)
  _TRAINER_TYPE_GET SCWK_ANSWER
  _IFVAL_JUMP    SCWK_ANSWER,NE,SCR_EYE_TR_TYPE_DOUBLE,ev_trainer_revenge_common  //ダブルでない時

  //ダブルだったらチェックする！
  //ここで手持ちが2匹かチェックしないと、戦闘に進んでしまうのでダメ！
  _2VS2_BATTLE_CHECK  SCWK_ANSWER
  _IFVAL_JUMP      SCWK_ANSWER,EQ,0,ev_trainer_talk_battle_poke_one

  //再戦用の戦闘後会話はないので、再戦状態の時は必ず戦闘へ進む
  //すでに勝利しているトレーナーかチェックして、戦闘勝利後の会話へ
  //_IF_TR_FLAGON_JUMP  SCWK_TEMP0,ev_trainer_talk_after_normal

  //再戦トレーナーと戦闘
  _JUMP        ev_trainer_revenge_common
*/
EVENT_END

ev_trainer_revenge_common:
/*
  _TRAINER_BGM_SET  SCWK_TEMP0                    //視線曲セット
  _REVENGE_TRAINER_TALK_TYPE_GET  SCWK_PARAM0,SCWK_PARAM1,SCWK_PARAM2  //メッセージを取得
  _TRAINER_MSG_SET  SCWK_TEMP0,SCWK_PARAM0
  $SCWK_TEMP0 = $SCWK_TEMP3    //退避していた再戦トレーナーIDをセットする
  _JUMP   ev_trainer_common_11
*/
EVENT_END

//--------------------------------------------------------------------
//  敗北
//--------------------------------------------------------------------
ev_trainer_battle_lose:
/*
  _TRAINER_LOSE
  _TALK_OBJ_END
*/
EVENT_END

//--------------------------------------------------------------------
//  手持ちが1匹
//--------------------------------------------------------------------
ev_trainer_talk_battle_poke_one:
  //会話トレーナーID取得
  _TRAINER_ID_GET( SCWK_TEMP0 )
  
  //メッセージを取得
  _TRAINER_TALK_TYPE_GET(  SCWK_PARAM0,SCWK_PARAM1,SCWK_PARAM2 )
  _TRAINER_MSG_SET(  SCWK_TEMP0,SCWK_PARAM2 )
  _AB_KEYWAIT()
  _BALLOONWIN_CLOSE()
  _RET

//--------------------------------------------------------------------
//かくれみのアニメ
//--------------------------------------------------------------------
ev_trainer_talk_battle_hide_pulloff:
/*
  _OBJ_ANIME      SCWK_TARGET_OBJID,anm_trainer_talk_battle_hide_pulloff
  _OBJ_ANIME_WAIT()

  //動作コードを書き換えないと、再度、土の中から出てくるアニメが入ってしまう！
  _PLAYER_DIR_GET    SCWK_PARAM0
  _IFVAL_CALL      SCWK_PARAM0,EQ,DIR_UP,ev_trainer_talk_battle_hide_pulloff_dir_up
  _IFVAL_CALL      SCWK_PARAM0,EQ,DIR_DOWN,ev_trainer_talk_battle_hide_pulloff_dir_down
  _IFVAL_CALL      SCWK_PARAM0,EQ,DIR_LEFT,ev_trainer_talk_battle_hide_pulloff_dir_left
  _IFVAL_CALL      SCWK_PARAM0,EQ,DIR_RIGHT,ev_trainer_talk_battle_hide_pulloff_dir_right
  _RET

ev_trainer_talk_battle_hide_pulloff_dir_up:
  _MOVE_CODE_CHANGE  SCWK_TARGET_OBJID,MV_DOWN
  _RET

ev_trainer_talk_battle_hide_pulloff_dir_down:
  _MOVE_CODE_CHANGE  SCWK_TARGET_OBJID,MV_UP
  _RET

ev_trainer_talk_battle_hide_pulloff_dir_left:
  _MOVE_CODE_CHANGE  SCWK_TARGET_OBJID,MV_RIGHT
  _RET

ev_trainer_talk_battle_hide_pulloff_dir_right:
  _MOVE_CODE_CHANGE  SCWK_TARGET_OBJID,MV_LEFT
*/
  _RET

_ANIME_LABEL  anm_trainer_talk_battle_hide_pulloff
  _ANIME_DATA  AC_HIDE_PULLOFF,1
  _ANIME_DATA  ACMD_END,0


//******************************************************************
//          視線からのトレーナー戦闘            
//
//  SCWK_TEMP0  トレーナーID_0
//  SCWK_TEMP1  トレーナーID_1
//******************************************************************
EVENT_START ev_trainer_move_battle
  //視線移動スクリプトコマンドの中で
  //対象のOBJの動作ポーズを解除するようにしている！
  //_PROGRAM      TR_BGM_SET
  
  //トレーナータイプ取得(シングル、ダブル、タッグ)
  _EYE_TRAINER_TYPE_GET( SCWK_ANSWER )

  IF $SCWK_ANSWER == SCR_EYE_TR_TYPE_SINGLE THEN 
    _CALL ev_trainer_type_single
  ELSIF $SCWK_ANSWER == SCR_EYE_TR_TYPE_DOUBLE THEN
    _CALL ev_trainer_type_double
  ELSIF $SCWK_ANSWER == SCR_EYE_TR_TYPE_TAG THEN
    _CALL ev_trainer_type_tag
  ENDIF
EVENT_END

//--------------------------------------------------------------------
//シングル
//--------------------------------------------------------------------
ev_trainer_type_single:
  //視線曲セット
  _EYE_TRAINER_ID_GET SCR_EYE_TR_0,SCWK_ANSWER
  $SCWK_TEMP0 = $SCWK_ANSWER
  _TRAINER_BGM_SET(  SCWK_TEMP0 )
  
  _EYE_TRAINER_MOVE_SET SCR_EYE_TR_0        //トレーナー移動処理呼び出し
  _CALL ev_trainer_type_single_move_end_check

  //移動終了後、会話へ
  _EYE_TRAINER_ID_GET  SCR_EYE_TR_0,SCWK_ANSWER
  $SCWK_TEMP0 = $SCWK_ANSWER
  _TRAINER_MSG_SET(  SCWK_TEMP0,TRMSG_FIGHT_START )
  _AB_KEYWAIT()
  _BALLOONWIN_CLOSE()
  
  _TRAINER_BTL_SET(  SCWK_TEMP0,0 )
  _TRAINER_LOSE_CHECK(  SCWK_ANSWER )

  IF $SCWK_ANSWER == SCR_BATTLE_RESULT_WIN THEN
    _TRAINER_WIN()
  ELSE
    _TRAINER_LOSE()
  ENDIF
  //_IFVAL_JUMP SCWK_ANSWER,EQ,0,ev_trainer_battle_lose
  
  //トレーナーフラグセット
  _EYE_TRAINER_ID_GET  SCR_EYE_TR_0,SCWK_ANSWER
  $SCWK_TEMP0 = $SCWK_ANSWER
  _TRAINER_FLAG_SET(  SCWK_TEMP0 )
  _RET

//移動終了待ち
ev_trainer_type_single_move_end_check:
  _EYE_TRAINER_MOVE_SINGLE SCR_EYE_TR_0
  _RET

//--------------------------------------------------------------------
//ダブル
//--------------------------------------------------------------------
ev_trainer_type_double:
  //視線曲セット
  _EYE_TRAINER_ID_GET SCR_EYE_TR_0,SCWK_ANSWER
  $SCWK_TEMP0 = $SCWK_ANSWER
  _TRAINER_BGM_SET( SCWK_TEMP0 )
  
  _EYE_TRAINER_MOVE_SET SCR_EYE_TR_0        //トレーナー移動処理呼び出し
  _EYE_TRAINER_MOVE_SET SCR_EYE_TR_1        //トレーナー移動処理呼び出し
  _CALL ev_trainer_type_double_move_end_check

  //移動終了後、会話へ
  _EYE_TRAINER_ID_GET  SCR_EYE_TR_0,SCWK_ANSWER
  $SCWK_TEMP0 = $SCWK_ANSWER
  _TRAINER_MSG_SET(  SCWK_TEMP0,TRMSG_FIGHT_START_1 )
//  _AB_KEYWAIT()
  _BALLOONWIN_CLOSE()
  
  //移動終了後、会話へ
  _EYE_TRAINER_ID_GET SCR_EYE_TR_1,SCWK_ANSWER
  $SCWK_TEMP1 = $SCWK_ANSWER
  _TRAINER_MSG_SET(  SCWK_TEMP1,TRMSG_FIGHT_START_2 )
//  _AB_KEYWAIT()
  _BALLOONWIN_CLOSE()
  
//  _TRAINER_BTL_SET( SCWK_TEMP0, SCWK_TEMP1 ) 現状不具合あり シングルで対応
  _TRAINER_BTL_SET( SCWK_TEMP0, 0 )

  _TRAINER_LOSE_CHECK( SCWK_ANSWER )

  IF $SCWK_ANSWER == SCR_BATTLE_RESULT_WIN THEN
    _TRAINER_WIN()
  ELSE
    _TRAINER_LOSE()
  ENDIF
  //_IFVAL_JUMP      SCWK_ANSWER,EQ,0,ev_trainer_battle_lose

  //トレーナーフラグセット
  _EYE_TRAINER_ID_GET  SCR_EYE_TR_0,SCWK_ANSWER
  $SCWK_TEMP0 = $SCWK_ANSWER
  _TRAINER_FLAG_SET(  SCWK_TEMP0 )

  _EYE_TRAINER_ID_GET  SCR_EYE_TR_1,SCWK_ANSWER
  $SCWK_TEMP1 = $SCWK_ANSWER
  _TRAINER_FLAG_SET(  SCWK_TEMP1 )
  _RET

//移動終了待ち
ev_trainer_type_double_move_end_check:
  _EYE_TRAINER_MOVE_DOUBLE
  _RET

//--------------------------------------------------------------------
//タッグ
//--------------------------------------------------------------------
ev_trainer_type_tag:
/*
  //視線曲セット
  _EYE_TRAINER_ID_GET  SCR_EYE_TR_0,SCWK_ANSWER
  $SCWK_TEMP0 = $SCWK_ANSWER
  _TRAINER_BGM_SET  SCWK_TEMP0

  _EYE_TRAINER_MOVE_SET  SCR_EYE_TR_0        //トレーナー移動処理呼び出し
  _CALL        ev_trainer_type_tag_move_end_check_0

  //移動終了後、会話へ
  _EYE_TRAINER_ID_GET  SCR_EYE_TR_0,SCWK_ANSWER
  $SCWK_TEMP0 = $SCWK_ANSWER
  //_TRAINER_MSG_SET  SCWK_TEMP0,TRMSG_FIGHT_START_1
  _TRAINER_MSG_SET  SCWK_TEMP0,TRMSG_FIGHT_START
  //_AB_KEYWAIT()
  _BALLOONWIN_CLOSE()

  //視線曲セット
  _EYE_TRAINER_ID_GET  SCR_EYE_TR_1,SCWK_ANSWER
  $SCWK_TEMP1 = $SCWK_ANSWER
  _TRAINER_BGM_SET  SCWK_TEMP1

  _EYE_TRAINER_MOVE_SET  SCR_EYE_TR_1        //トレーナー移動処理呼び出し
  _CALL        ev_trainer_type_tag_move_end_check_1

  //移動終了後、会話へ
  _EYE_TRAINER_ID_GET  SCR_EYE_TR_1,SCWK_ANSWER
  $SCWK_TEMP1 = $SCWK_ANSWER
  //_TRAINER_MSG_SET  SCWK_TEMP1,TRMSG_FIGHT_START_2
  _TRAINER_MSG_SET  SCWK_TEMP1,TRMSG_FIGHT_START
  //_AB_KEYWAIT()
  _BALLOONWIN_CLOSE()

  _TRAINER_BTL_SET  SCWK_TEMP0,SCWK_TEMP1
  _TRAINER_LOSE_CHECK SCWK_ANSWER
  IF $SCWK_ANSWER == SCR_BATTLE_RESULT_WIN THEN
    _TRAINER_WIN()
  ELSE
    _TRAINER_LOSE()
  ENDIF
  //_IFVAL_JUMP      SCWK_ANSWER,EQ,0,ev_trainer_battle_lose

  //トレーナーフラグセット
  _EYE_TRAINER_ID_GET  SCR_EYE_TR_0,SCWK_ANSWER
  $SCWK_TEMP0 = $SCWK_ANSWER
  _TRAINER_FLAG_SET  SCWK_TEMP0

  _EYE_TRAINER_ID_GET  SCR_EYE_TR_1,SCWK_ANSWER
  $SCWK_TEMP1 = $SCWK_ANSWER
  _TRAINER_FLAG_SET  SCWK_TEMP1
*/
EVENT_END

//移動終了待ち
ev_trainer_type_tag_move_end_check_0:
/*
  _EYE_TRAINER_MOVE_CHECK  SCR_EYE_TR_0,SCWK_ANSWER
  _IFVAL_JUMP    SCWK_ANSWER,EQ,0,ev_trainer_type_tag_move_end_check_0  //終了するまでループ
*/
  _RET

//移動終了待ち
ev_trainer_type_tag_move_end_check_1:
/*
  _EYE_TRAINER_MOVE_CHECK  SCR_EYE_TR_1,SCWK_ANSWER
  _IFVAL_JUMP    SCWK_ANSWER,EQ,0,ev_trainer_type_tag_move_end_check_1  //終了するまでループ
*/
  _RET
