
//======================================================================
//                c05gym0101.ev
//
//    スクリプトファイル：c05gym0101用
//
//======================================================================

  .text

  .include  "scr_seq_def.h"
  .include  "../../message/dst/script/msg_c05gym0101.h"
  .include  "c05gym0101.h"

//--------------------------------------------------------------
//               スクリプト本体
//--------------------------------------------------------------

//--------------------------------------------------------------
//               スクリプトテーブル
//--------------------------------------------------------------
_EVENT_DATA    ev_c05gym0101_leader
_EVENT_DATA    ev_c05gym0101_lift_00u
_EVENT_DATA    ev_c05gym0101_lift_00d
_EVENT_DATA    ev_c05gym0101_lift_01u
_EVENT_DATA    ev_c05gym0101_lift_01d
_EVENT_DATA    ev_c05gym0101_lift_02u
_EVENT_DATA    ev_c05gym0101_lift_02d
_EVENT_DATA    ev_c05gym0101_lift_03u
_EVENT_DATA    ev_c05gym0101_lift_03d
_EVENT_DATA    ev_c05gym0101_lift_04u
_EVENT_DATA    ev_c05gym0101_lift_04d
_EVENT_DATA    ev_c05gym0101_lift_05u
_EVENT_DATA    ev_c05gym0101_lift_05d
_EVENT_DATA    ev_c05gym0101_workman_00
_EVENT_DATA    ev_zone_c05gym0101
_EVENT_DATA    ev_scene_c05gym0101_gymstart_01
_EVENT_DATA    ev_c05gym0101_exitlift_00u
_EVENT_DATA    ev_c05gym0101_exitlift_00d
_EVENT_DATA_END


//------------------------------注意--------------------------------//
//																	//
//	ジムギミックに FH_10〜15 まで使用ししています。					//
//	同マップ内の使用を禁止します。									//
//	各リフトの停止位置（上下）チェックに使用します。				//
//	0 = 上の停止位置にいる、1 = 下の停止位置にいる					//
//																	//
//	ジムギミックに LOCALWORK10 を使用しています。					//
//	同マップ内の使用を禁止します。									//
//	0 = シーンチェンジ起動 エントランスから降りてくるリフト演出		//
//																	//
//------------------------------------------------------------------//


/************************************************************/
/*					ゾーンチェンジスクリプト				*/
/************************************************************/
INIT_EVENT_START	ev_zone_c05gym0101


INIT_EVENT_END


/************************************************************/
/*				接続イベント エントランスから降下			*/
/************************************************************/
EVENT_START	ev_scene_c05gym0101_gymstart_01

	//ブラックイン
	_BLACK_IN()

	//エントランスからリフトが降りる演出（引数0 = 降下アニメ）
	_GYM_GROUND_EXIT_LIFT( 0 )

	_DISP_FADE_END_CHECK()


	//========================================//

	//接続イベント終了
	$LOCALWORK10 = 1

	//リフトの上下位置フラグを初期化（初期位置が下のリフトのフラグをたてておく）
	//ゾーンチェンジではローカルフラグの操作ができないためゾーン進入時に必ず発動するこのイベントで初期化
	_FLAG_SET( FH_11 )
	_FLAG_SET( FH_13 )
	_FLAG_SET( FH_14 )

	//========================================//

EVENT_END


/**************************************************************/
/*    ジムリーダー会話（仮）                                  */
/**************************************************************/
EVENT_START		ev_c05gym0101_leader
	_TALK_OBJ_START()
	
	//ジムバッジ取得チェック
	_GET_BADGE_FLAG( SCWK_TEMP0, BADGE_ID_05 )
	
	//ジムバッジを取得していない場合
	IF $SCWK_TEMP0 == 0 THEN
	
		//会話
		_BALLOONWIN_OBJMSG_OPEN( msg_c05gym0101_leader_01,C05GYM0101_LEADER_01 )
		_BALLOONWIN_CLOSE()
	
		//戦闘処理
		_TRAINER_BTL_SET( TRID_LEADER5_01, 0 )
		//結果チェック
		_TRAINER_LOSE_CHECK( SCWK_ANSWER )
		IF $SCWK_ANSWER == SCR_BATTLE_RESULT_WIN THEN
			_TRAINER_WIN()
		ELSE
			_TRAINER_LOSE()
		ENDIF
	
		//勝利後会話
		_BALLOONWIN_OBJMSG_OPEN( msg_c05gym0101_leader_02 , C05GYM0101_LEADER_01 )
		_BALLOONWIN_CLOSE()
	
		//クエイクバッジ入手処理
		_SET_BADGE_FLAG( BADGE_ID_05 )
		_TALKWIN_OPEN()
		_PLAYER_NAME( 0 )
		//ヤーコンからクエイクバッジをもらった
		_TALKMSG_ALLPUT( msg_c05gym0101_leader_03 )
		_ME_PLAY( SEQ_ME_BADGE )
		_ME_WAIT()
		_TALKWIN_CLOSE()

		//ヤーコンメッセージ
		_BALLOONWIN_OBJMSG_OPEN( msg_c05gym0101_leader_04 , C05GYM0101_LEADER_01 )
		_BALLOONWIN_CLOSE()

		//わざマシン入手
		_ITEM_EVENT_KEYWAIT( ITEM_WAZAMASIN01, 1 )

		//わざマシン中身解説
		_ITEM_NAME( 0, ITEM_WAZAMASIN01 )
		_ITEM_WAZA_NAME( 1, ITEM_WAZAMASIN01 )
		_BALLOONWIN_OBJMSG_OPEN( msg_c05gym0101_leader_05 , C05GYM0101_LEADER_01 )
		_LAST_KEYWAIT()
		_BALLOONWIN_CLOSE()
		
		//============フラグワーク操作=============//
	
		//C051のH02方面ストッパー解除
		$WK_SCENE_C05_TOBRIDGE = 1
		
		//C051のH02方面ストッパー削除
		_FLAG_SET(FV_C05_WORKMAN_02)

		//========================================//
		
	//ジムバッジ入手後
	ELSE
		_BALLOONWIN_OBJMSG_OPEN( msg_c05gym0101_leader_06 , C05GYM0101_LEADER_01 )
		_LAST_KEYWAIT()
		_BALLOONWIN_CLOSE()
	ENDIF

EVENT_END


/************************************************************/
/*					リフト0号機 上昇ボタン					*/
/************************************************************/
EVENT_START		ev_c05gym0101_lift_00u
	_PLAYER_DIR_GET( SCWK_ANSWER )	//主人公の向き情報を取得

	//スイッチの上側以外から話しかけた&リフトが下にある場合はリフト起動
	IF $SCWK_ANSWER != DIR_DOWN && FLAG_ON( FH_10 ) THEN
		//リフトを上昇させる（引数はリフトインデックス）
		_GYM_GROUND_MV_LIFT( 0 )
		_FLAG_RESET( FH_10 )
	ENDIF

EVENT_END

/************************************************************/
/*					リフト0号機 下降ボタン					*/
/************************************************************/
EVENT_START		ev_c05gym0101_lift_00d
	_PLAYER_DIR_GET( SCWK_ANSWER )	//主人公の向き情報を取得

	//スイッチの上側以外から話しかけた&リフトが上にある場合はリフト起動
	IF $SCWK_ANSWER != DIR_DOWN && FLAG_OFF( FH_10 ) THEN
		//リフトを下降させる（引数はリフトインデックス）
		_GYM_GROUND_MV_LIFT( 0 )
		_FLAG_SET( FH_10 )
	ENDIF

EVENT_END


/************************************************************/
/*					リフト1号機 上昇ボタン					*/
/************************************************************/
EVENT_START		ev_c05gym0101_lift_01u
	_PLAYER_DIR_GET( SCWK_ANSWER )	//主人公の向き情報を取得

	//スイッチの上側以外から話しかけた&リフトが下にある場合はリフト起動
	IF $SCWK_ANSWER != DIR_DOWN && FLAG_ON( FH_11 ) THEN
		//リフトを上昇させる（引数はリフトインデックス）
		_GYM_GROUND_MV_LIFT( 1 )
		_FLAG_RESET( FH_11 )
	ENDIF

EVENT_END


/************************************************************/
/*					リフト1号機 下降ボタン					*/
/************************************************************/
EVENT_START		ev_c05gym0101_lift_01d
	_PLAYER_DIR_GET( SCWK_ANSWER )	//主人公の向き情報を取得

	//スイッチの上側以外から話しかけた&リフトが上にある場合はリフト起動
	IF $SCWK_ANSWER != DIR_DOWN && FLAG_OFF( FH_11 ) THEN
		//リフトを上昇させる（引数はリフトインデックス）
		_GYM_GROUND_MV_LIFT( 1 )
		_FLAG_SET( FH_11 )
	ENDIF

EVENT_END


/************************************************************/
/*					リフト2号機 上昇ボタン					*/
/************************************************************/
EVENT_START		ev_c05gym0101_lift_02u
	_PLAYER_DIR_GET( SCWK_ANSWER )	//主人公の向き情報を取得

	//スイッチの上側以外から話しかけた&リフトが下にある場合はリフト起動
	IF $SCWK_ANSWER != DIR_DOWN && FLAG_ON( FH_12 ) THEN
		//リフトを動作させる（引数はリフトインデックス）
		_GYM_GROUND_MV_LIFT( 2 )
		_FLAG_RESET( FH_12 )
	ENDIF

EVENT_END


/************************************************************/
/*					リフト2号機 下降ボタン					*/
/************************************************************/
EVENT_START		ev_c05gym0101_lift_02d
	_PLAYER_DIR_GET( SCWK_ANSWER )	//主人公の向き情報を取得

	//スイッチの上側以外から話しかけた&リフトが上にある場合はリフト起動
	IF $SCWK_ANSWER != DIR_DOWN && FLAG_OFF( FH_12 ) THEN
		//リフトを動作させる（引数はリフトインデックス）
		_GYM_GROUND_MV_LIFT( 2 )
		_FLAG_SET( FH_12 )
	ENDIF

EVENT_END


/************************************************************/
/*					リフト3号機 上昇ボタン					*/
/************************************************************/
EVENT_START		ev_c05gym0101_lift_03u
	_PLAYER_DIR_GET( SCWK_ANSWER )	//主人公の向き情報を取得

	//スイッチの上側以外から話しかけた&リフトが下にある場合はリフト起動
	IF $SCWK_ANSWER != DIR_DOWN && FLAG_ON( FH_13 ) THEN
		//リフトを動作させる（引数はリフトインデックス）
		_GYM_GROUND_MV_LIFT( 3 )
		_FLAG_RESET( FH_13 )
	ENDIF

EVENT_END


/************************************************************/
/*					リフト3号機 下降ボタン					*/
/************************************************************/
EVENT_START		ev_c05gym0101_lift_03d
	_PLAYER_DIR_GET( SCWK_ANSWER )	//主人公の向き情報を取得

	//スイッチの上側以外から話しかけた&リフトが上にある場合はリフト起動
	IF $SCWK_ANSWER != DIR_DOWN && FLAG_OFF( FH_13 ) THEN
		//リフトを動作させる（引数はリフトインデックス）
		_GYM_GROUND_MV_LIFT( 3 )
		_FLAG_SET( FH_13 )
	ENDIF

EVENT_END


/************************************************************/
/*					リフト4号機 上昇ボタン					*/
/************************************************************/
EVENT_START		ev_c05gym0101_lift_04u
	_PLAYER_DIR_GET( SCWK_ANSWER )	//主人公の向き情報を取得

	//スイッチの上側以外から話しかけた&リフトが下にある場合はリフト起動
	IF $SCWK_ANSWER != DIR_DOWN && FLAG_ON( FH_14 ) THEN
		//リフトを動作させる（引数はリフトインデックス）
		_GYM_GROUND_MV_LIFT( 4 )
		_FLAG_RESET( FH_14 )
	ENDIF

EVENT_END


/************************************************************/
/*					リフト4号機 下降ボタン					*/
/************************************************************/
EVENT_START		ev_c05gym0101_lift_04d
	_PLAYER_DIR_GET( SCWK_ANSWER )	//主人公の向き情報を取得

	//スイッチの上側以外から話しかけた&リフトが上にある場合はリフト起動
	IF $SCWK_ANSWER != DIR_DOWN && FLAG_OFF( FH_14 ) THEN
		//リフトを動作させる（引数はリフトインデックス）
		_GYM_GROUND_MV_LIFT( 4 )
		_FLAG_SET( FH_14 )
	ENDIF

EVENT_END


/************************************************************/
/*					リフト5号機 上昇ボタン					*/
/************************************************************/
EVENT_START		ev_c05gym0101_lift_05u
	_PLAYER_DIR_GET( SCWK_ANSWER )	//主人公の向き情報を取得

	//スイッチの上側以外から話しかけた&リフトが下にある場合はリフト起動
	IF $SCWK_ANSWER != DIR_DOWN && FLAG_ON( FH_15 ) THEN
		//リフトを動作させる（引数はリフトインデックス）
		_GYM_GROUND_MV_LIFT( 5 )
		_FLAG_RESET( FH_15 )
	ENDIF

EVENT_END


/************************************************************/
/*					リフト5号機 下降ボタン					*/
/************************************************************/
EVENT_START		ev_c05gym0101_lift_05d
	_PLAYER_DIR_GET( SCWK_ANSWER )	//主人公の向き情報を取得

	//スイッチの上側以外から話しかけた&リフトが上にある場合はリフト起動
	IF $SCWK_ANSWER != DIR_DOWN && FLAG_OFF( FH_15 ) THEN
		//リフトを動作させる（引数はリフトインデックス）
		_GYM_GROUND_MV_LIFT( 5 )
		_FLAG_SET( FH_15 )
	ENDIF

EVENT_END


/************************************************************/
/*				作業員トレーナー／メインストッパー			*/
/************************************************************/
EVENT_START		ev_c05gym0101_workman_00
	_TALK_OBJ_START()
EVENT_END


/************************************************************/
/*				接続リフト 至ジムエントランス				*/
/************************************************************/
EVENT_START	ev_c05gym0101_exitlift_00u
	_PLAYER_DIR_GET( SCWK_ANSWER )	//主人公の向き情報を取得

	//スイッチの上側以外から話しかけた場合はリフト起動
	IF $SCWK_ANSWER != DIR_DOWN THEN
		//ブラックアウト
		_BLACK_OUT()

		//リフトを上昇させる（1 = エントランスに移動アニメ）
		_GYM_GROUND_EXIT_LIFT( 1 )

		_DISP_FADE_END_CHECK()

		//========================================//

		//エントランスリフトのジム戻り演出イベントを有効にする
		$WK_C05GYM_EXIT = 1

		//========================================//

		//マップチェンジ
		_MAP_CHANGE_NO_FADE( ZONE_ID_C05GYM0201, 5, 0, 4, DIR_UP )

	ENDIF

EVENT_END


/************************************************************/
/*					接続リフト 下降スイッチ					*/
/************************************************************/
EVENT_START	ev_c05gym0101_exitlift_00d
	//現状は押しても反応無し　【保留】反応が無いメッセージを表示するか
EVENT_END


