#! make -f
#----------------------------------------------------------------------------
# Project:  テクスチャセットデータ作成
# File:     Makefile
#
# Copyright 2005 GameFreak.inc  All rights reserved.
#
# 2008.12.18	WB環境へ移植
#
#----------------------------------------------------------------------------
#pkgsでは少し複雑なことをしているが、とりあえず単純に...
#上位のMakefileが、area_table.xlsから生成するべきテクスチャと元となるimdの関係を導き出す
#	imdをマージする。
#	imdをコンバートし、nsbtxを生成する
#	生成したnsbtxをまとめてnarcを生成する

#エリアコンバート共通定義ファイル
include ../area_common.def

#------------------------------------------------------------------------------
#※コンバート作業が必要なユーザーの名前を記述する
#------------------------------------------------------------------------------
USERS	=	tamada

#------------------------------------------------------------------------------
#※ここに作成するnarc名を書く
#------------------------------------------------------------------------------
TARGET_ARC	=	area_map_tex.narc

#------------------------------------------------------------------------------
#※コピー先へのパスを書く（通常はPROJECT_ARCDIRでよい）
#------------------------------------------------------------------------------
TARGETDIR	= $(PROJECT_ARCDIR)fieldmap

#------------------------------------------------------------------------------
#※サブディレクトリでもMakeしたい場合、ここにディレクトリ名を書く
#------------------------------------------------------------------------------
SUBDIRS		=

#共通ルールファイルのインクルード
include $(PROJECT_RSCDIR)\macro_define

EXCEL2TAB	= $(PROJECT_ROOT)/tools/exceltool/exceltabconv.exe


#----------------------------------------------------------------------------
#----------------------------------------------------------------------------
DQ		="
#↑subst構文で"を使うとVimのコメント自動認識に狂いがでるので定義している

#----------------------------------------------------------------------------
#
#----------------------------------------------------------------------------
#Makeで生成される*.binはmake cleanの削除対象にする
LDIRT_CLEAN	= $(subst $(DQ),,$(NSBTXFILESDIR)/*.nsbtx)

#----------------------------------------------------------------------------
#	ツールへのパス指定
#----------------------------------------------------------------------------
G3DCVTR	= $(NITROSYSTEM_ROOT)/tools/win/bin/g3dcvtr.exe
TEX_MAG = $(PROJECT_ROOT)tools/imdtools/tex_mag/tex_mag.exe

.PHONY:	do-build clean
#----------------------------------------------------------------------------
#
#	ルール定義
#
#----------------------------------------------------------------------------
do-build: $(TARGETDIR)/$(TARGET_ARC)

$(TARGETDIR)/$(TARGET_ARC): $(TARGET_ARC)
	$(COPY) $(TARGET_ARC) $(TARGETDIR)

ifeq	($(CONVERTUSER),true)	#コンバート対象者のみ、バイナリ生成

# source imd --> marged imd --> nsbtxの依存関係＆コンパイルルール定義
NSBTX_DEPEND_FILE	= $(subst $(DQ),,$(NSBTX_DEPEND_FILENAME))
-include ../$(NSBTX_DEPEND_FILE)

# NNSARC_DEPEND_FILES（nsbtx --> narcの依存関係）定義
NNSARC_DEPEND_FILE	= $(subst $(DQ),,$(NNSARC_DEPEND_FILENAME))
-include ../$(NNSARC_DEPEND_FILE)

# nnsarcで固めるデータ指定リスト
NNSARC_LIST_FILE	= ../$(subst $(DQ),,$(NNSARC_TEXLIST_FILENAME))

$(TARGET_ARC): $(NNSARC_DEPEND_FILES)
	nnsarc -i -c -l -n $(TARGET_ARC) -S $(NNSARC_LIST_FILE)  > arc_result.txt

endif

#----------------------------------------------------------------------------
#----------------------------------------------------------------------------
clean:
	@-rm $(TARGETDIR)/$(TARGET_ARC)
ifeq	($(CONVERTUSER),true)	#コンバート対象者のみ、バイナリ生成
	@-rm $(TARGET_ARC)
	@-rm $(LDIRT_CLEAN)
endif

