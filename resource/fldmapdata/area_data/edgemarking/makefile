
#! make -f
#----------------------------------------------------------------------------
# Project:  エリアデータ作成
# File:     Makefile
#
#	2009.06.16
#----------------------------------------------------------------------------


#------------------------------------------------------------------------------
#※コンバート作業が必要なユーザーの名前を記述する
#------------------------------------------------------------------------------
USERS	=	tamada fuchino

#------------------------------------------------------------------------------
#※ここに作成するnarc名を書く
#------------------------------------------------------------------------------
TARGET		=	edgemarking.narc
TARGET_HEADER = $(TARGET:.narc=.naix)

#------------------------------------------------------------------------------
#※コピー先へのパスを書く（通常はPROJECT_ARCDIRでよい）
#------------------------------------------------------------------------------
TARGETDIR	= $(PROJECT_ARCDIR)fieldmap

#------------------------------------------------------------------------------
#※サブディレクトリでもMakeしたい場合、ここにディレクトリ名を書く
#------------------------------------------------------------------------------
SUBDIRS		=	

#共通ルールファイルのインクルード
include $(PROJECT_RSCDIR)\macro_define

XLS2TAB		= ruby $(PROJECT_ROOT)/tools/exceltool/xls2xml/tab_out.rb

#----------------------------------------------------------------------------
#
#----------------------------------------------------------------------------
#Makeで生成される*.binはmake cleanの削除対象にする
CLEANFILES	= $(TARGETDIR)/$(TARGET_HEADER) $(TARGETDIR)/$(TARGET)
CLEANFILES	+=  $(TXTDATA)

#----------------------------------------------------------------------------
#	ツールへのパス指定
#----------------------------------------------------------------------------

WKDIR	=	wkdir
#----------------------------------------------------------------------------
#	リスト作成時の読み込み元ファイル
#----------------------------------------------------------------------------
SRC_XLS_FILE	= edgemarking.xls
SRC_TXT_FILE	= $(SRC_XLS_FILE:.xls=.txt)

LIST_FILE			= $(WKDIR)/edge.list

#----------------------------------------------------------------------------
#	中間ファイル
#----------------------------------------------------------------------------
#BUILD	=	build
#TEXSET	=	texset

#----------------------------------------------------------------------------
#
#	ルール定義
#
#----------------------------------------------------------------------------
.PHONY:	do-build subdir clean

#------------------------------------------------------------------------------
#	make do-build ルール
#------------------------------------------------------------------------------
do-build:	subdir $(TARGETDIR)/$(TARGET)

subdir:
	$(MAKE_SUBDIR)

$(TARGETDIR)/$(TARGET):	$(TARGET)
	$(COPY) $(TARGET) $(TARGETDIR)
	#$(COPY) $(TARGET_HEADER) $(TARGETDIR)

ifeq	($(CONVERTUSER),true)	#コンバート対象者のみ、バイナリ生成
$(SRC_TXT_FILE):	$(SRC_XLS_FILE)
	#エクセルコンバート
	$(XLS2TAB) $(SRC_XLS_FILE) > $(SRC_TXT_FILE)

$(TARGET):	$(SRC_TXT_FILE)
	ruby make_edgemark.rb $(SRC_TXT_FILE)
	nnsarc -c -l -n -i $(TARGET) -S $(LIST_FILE)
	$(NAIXCUT) $(TARGET:.narc=.naix)

endif





#----------------------------------------------------------------------------
#----------------------------------------------------------------------------
clean:
ifeq	($(CONVERTUSER),true)	#コンバート対象者のみ、バイナリ削除
	-@rm $(TARGET) $(TARGET_HEADER)
	-@rm $(SRC_TXT_FILE) $(LIST_FILE)
	-@rm $(WKDIR)/*
endif
	@$(MAKE_SUBDIR)
	-@rm $(CLEANFILES)

test:
	echo $(TEXSET_LIST)
	echo $(TEX_LIST)
