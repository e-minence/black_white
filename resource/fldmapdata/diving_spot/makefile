#============================================================================
#
#		ダイビング可能位置指定データコンバート
#
#	2010.02.21	tamada GAMEFREAK inc.
#
#============================================================================

#------------------------------------------------------------------------------
#※コンバート作業が必要なユーザーの名前を記述する
#------------------------------------------------------------------------------
USERS	=	tamada nakatsui

#----------------------------------------------------------------------------
#※ここに作成するファイル名を書く
#----------------------------------------------------------------------------

TARGETNAME	= diving_spot

CDAT_FILE	= $(TARGETNAME).cdat

SRC_XLS	= $(TARGETNAME).xls
SRC_TXT	= $(SRC_XLS:.xls=.txt)
#------------------------------------------------------------------------------
#※コピー先へのパスを書く（通常はPROJECT_ARCDIRでよい）
#------------------------------------------------------------------------------
TARGETDIR	= $(PROJECT_ARCDIR)fieldmap

DEPENDFILES	= ../zonetable/zone_id.h

#共通ルールファイルのインクルード
include $(PROJECT_RSCDIR)macro_define


#----------------------------------------------------------------------------
#----------------------------------------------------------------------------

#----------------------------------------------------------------------------
#	ツールへのパス指定
#----------------------------------------------------------------------------

CSV_RUBY	= ruby $(PROJECT_ROOT)tools/exceltool/xls2xml/tab_out_sheet.rb

#============================================================================
#
#	ルール定義
#
#============================================================================
.PHONY:	do-build clean test

#----------------------------------------------------------------------------
#	生成ルール
#----------------------------------------------------------------------------
do-build: $(CDAT_FILE)


ifeq	($(CONVERTUSER),true)	#コンバート対象者のみ動作させる

$(CDAT_FILE):	$(SRC_XLS) $(DEPENDFILES)
	$(CSV_RUBY) -comma -n 0 $(SRC_XLS) > $(SRC_TXT)
	ruby diving_spot.rb $(SRC_TXT) $(CDAT_FILE)

endif	#CONVERTUSER


#----------------------------------------------------------------------------
#	Cleanルール
#----------------------------------------------------------------------------
clean:
ifeq	($(CONVERTUSER),true)	#コンバート対象者のみ動作させる
	rm -f $(SRC_TXT)
	rm -f $(CDAT_FILE)
endif


#----------------------------------------------------------------------------
#----------------------------------------------------------------------------
test:
	ruby diving_spot.rb $(SRC_TXT) $(CDAT_FILE)

