
//============================================================================================
/**
 * @file	blockout.c
 * @brief	3D描画テスト
 * @author	sogabe
 * @date	2007.05.30
 */
//============================================================================================


#include "gflib.h"
#include "calctool.h"

#include "yt_common.h"

//------------------------------------------------------------------
/**
 * @brief		ワーク構造体
 */
//------------------------------------------------------------------

#define SHAPE_DIR_CHECK

#define	ROTATE_VALUE	(65536/4)

#define	MAP_X	(5)
#define	MAP_Y	(5)
#define	MAP_Z	(10)

#define	FALL_WAIT		(80)

typedef struct
{
	int			seq_no;
	u16			pos_x;
	u16			pos_y;
	u16			pos_z;
	u16			rotx;
	u16			roty;
	u16			rotz;
	u16			shape;
	u16			dir;
	u16			wait;
	u8			field[MAP_Z+2][MAP_X][MAP_Y];
	int			tp_flag;
}BLOCK_OUT;

#ifdef SHAPE_DIR_CHECK
static	u16	rot_x,rot_y,rot_z;
#endif

//----------------------------------------------------------------------------
/**
 *	@brief	テクスチャデータ
 */
//-----------------------------------------------------------------------------
static	const u16 tex_16plett8x8[] = {
    0x1111, 0x1111,
	0x2222, 0x2222,
    0x3333, 0x3333,
	0x4444, 0x4444,
    0x5555, 0x5555,
	0x6666, 0x6666,
    0x7777, 0x7777,
	0x8888, 0x8888,
};

static	const u16 pal_16plett[] = {
    GX_RGB( 0, 0, 0),GX_RGB( 0, 0,31),GX_RGB(31, 0,31),GX_RGB(31, 0, 0),
	GX_RGB(31,31, 0),GX_RGB( 0,31, 0),GX_RGB( 0, 0, 0),GX_RGB( 0, 0, 0),
    GX_RGB( 0, 0, 0),GX_RGB( 0, 0, 0),GX_RGB( 0, 0, 0),GX_RGB( 0, 0, 0),
	GX_RGB( 0, 0, 0),GX_RGB( 0, 0, 0),GX_RGB( 0, 0, 0),GX_RGB( 0, 0, 0),
};
//----------------------------------------------------------------------------
/**
 *	@brief	描画BLOCKデータ
 */
//-----------------------------------------------------------------------------

static	const	fx16	BlockData[]={
	GX_BEGIN_QUAD_STRIP,
	8,
	-FX16_HALF,	-FX16_HALF,	 FX16_HALF,
	-FX16_HALF,	 FX16_HALF,	 FX16_HALF,
	 FX16_HALF,	-FX16_HALF,	 FX16_HALF,
	 FX16_HALF,	 FX16_HALF,	 FX16_HALF,
	 FX16_HALF,	-FX16_HALF,	-FX16_HALF,
	 FX16_HALF,	 FX16_HALF,	-FX16_HALF,
	-FX16_HALF,	-FX16_HALF,	-FX16_HALF,
	-FX16_HALF,	 FX16_HALF,	-FX16_HALF,

	GX_BEGIN_QUAD_STRIP,
	8,
	 FX16_HALF,	-FX16_HALF,	 FX16_HALF,
	 FX16_HALF,	-FX16_HALF,	-FX16_HALF,
	-FX16_HALF,	-FX16_HALF,	 FX16_HALF,
	-FX16_HALF,	-FX16_HALF,	-FX16_HALF,
	-FX16_HALF,	 FX16_HALF,	 FX16_HALF,
	-FX16_HALF,	 FX16_HALF,	-FX16_HALF,
	 FX16_HALF,	 FX16_HALF,	 FX16_HALF,
	 FX16_HALF,	 FX16_HALF,	-FX16_HALF,

	 0xffff,
};

static	const	fx16	LBlockData[]={
	GX_BEGIN_QUAD_STRIP,
	14,
	 FX16_HALF,			 FX16_HALF+FX16_ONE,	 FX16_HALF,
	 FX16_HALF,			 FX16_HALF+FX16_ONE,	-FX16_HALF,
	 FX16_HALF,			-FX16_HALF         ,	 FX16_HALF,
	 FX16_HALF,			-FX16_HALF         ,	-FX16_HALF,
	 FX16_HALF+FX16_ONE,-FX16_HALF         ,	 FX16_HALF,
	 FX16_HALF+FX16_ONE,-FX16_HALF         ,	-FX16_HALF,
	 FX16_HALF+FX16_ONE,-FX16_HALF-FX16_ONE,	 FX16_HALF,
	 FX16_HALF+FX16_ONE,-FX16_HALF-FX16_ONE,	-FX16_HALF,
	-FX16_HALF,			-FX16_HALF-FX16_ONE,	 FX16_HALF,
	-FX16_HALF,			-FX16_HALF-FX16_ONE,	-FX16_HALF,
	-FX16_HALF,			 FX16_HALF+FX16_ONE,	 FX16_HALF,
	-FX16_HALF,			 FX16_HALF+FX16_ONE,	-FX16_HALF,
	 FX16_HALF,			 FX16_HALF+FX16_ONE,	 FX16_HALF,
	 FX16_HALF,			 FX16_HALF+FX16_ONE,	-FX16_HALF,

	 -1,
};

static	const	fx16	SBlockData[]={
	GX_BEGIN_QUAD_STRIP,
	18,
	 FX16_HALF,			 FX16_HALF+FX16_ONE,	 FX16_HALF,
	 FX16_HALF,			 FX16_HALF+FX16_ONE,	-FX16_HALF,
	 FX16_HALF,			 FX16_HALF         ,	 FX16_HALF,
	 FX16_HALF,			 FX16_HALF         ,	-FX16_HALF,
	 FX16_HALF+FX16_ONE, FX16_HALF         ,	 FX16_HALF,
	 FX16_HALF+FX16_ONE, FX16_HALF         ,	-FX16_HALF,
	 FX16_HALF+FX16_ONE,-FX16_HALF-FX16_ONE,	 FX16_HALF,
	 FX16_HALF+FX16_ONE,-FX16_HALF-FX16_ONE,	-FX16_HALF,
	 FX16_HALF,			-FX16_HALF-FX16_ONE,	 FX16_HALF,
	 FX16_HALF,			-FX16_HALF-FX16_ONE,	-FX16_HALF,
	 FX16_HALF,			-FX16_HALF         ,	 FX16_HALF,
	 FX16_HALF,			-FX16_HALF         ,	-FX16_HALF,
	-FX16_HALF,			-FX16_HALF         ,	 FX16_HALF,
	-FX16_HALF,			-FX16_HALF         ,	-FX16_HALF,
	-FX16_HALF,			 FX16_HALF+FX16_ONE,	 FX16_HALF,
	-FX16_HALF,			 FX16_HALF+FX16_ONE,	-FX16_HALF,
	 FX16_HALF,			 FX16_HALF+FX16_ONE,	 FX16_HALF,
	 FX16_HALF,			 FX16_HALF+FX16_ONE,	-FX16_HALF,

	 -1,
};

static	const	fx16	TBlockData[]={
	GX_BEGIN_QUAD_STRIP,
	18,
	 FX16_HALF,			 FX16_HALF+FX16_ONE,	 FX16_HALF,
	 FX16_HALF,			 FX16_HALF+FX16_ONE,	-FX16_HALF,
	 FX16_HALF,			 FX16_HALF         ,	 FX16_HALF,
	 FX16_HALF,			 FX16_HALF         ,	-FX16_HALF,
	 FX16_HALF+FX16_ONE, FX16_HALF         ,	 FX16_HALF,
	 FX16_HALF+FX16_ONE, FX16_HALF         ,	-FX16_HALF,
	 FX16_HALF+FX16_ONE,-FX16_HALF         ,	 FX16_HALF,
	 FX16_HALF+FX16_ONE,-FX16_HALF         ,	-FX16_HALF,
	-FX16_HALF-FX16_ONE,-FX16_HALF         ,	 FX16_HALF,
	-FX16_HALF-FX16_ONE,-FX16_HALF         ,	-FX16_HALF,
	-FX16_HALF-FX16_ONE, FX16_HALF         ,	 FX16_HALF,
	-FX16_HALF-FX16_ONE, FX16_HALF         ,	-FX16_HALF,
	-FX16_HALF,			 FX16_HALF         ,	 FX16_HALF,
	-FX16_HALF,			 FX16_HALF         ,	-FX16_HALF,
	-FX16_HALF,			 FX16_HALF+FX16_ONE,	 FX16_HALF,
	-FX16_HALF,			 FX16_HALF+FX16_ONE,	-FX16_HALF,
	 FX16_HALF,			 FX16_HALF+FX16_ONE,	 FX16_HALF,
	 FX16_HALF,			 FX16_HALF+FX16_ONE,	-FX16_HALF,

	 -1,
};

static	const	fx16	IBlockData[]={
	GX_BEGIN_QUAD_STRIP,
	10,
	 FX16_HALF,			 FX16_HALF+FX16_ONE,	 FX16_HALF,
	 FX16_HALF,			 FX16_HALF+FX16_ONE,	-FX16_HALF,
	 FX16_HALF,			-FX16_HALF-2*FX16_ONE,	 FX16_HALF,
	 FX16_HALF,			-FX16_HALF-2*FX16_ONE,	-FX16_HALF,
	-FX16_HALF,			-FX16_HALF-2*FX16_ONE,	 FX16_HALF,
	-FX16_HALF,			-FX16_HALF-2*FX16_ONE,	-FX16_HALF,
	-FX16_HALF,			 FX16_HALF+FX16_ONE,	 FX16_HALF,
	-FX16_HALF,			 FX16_HALF+FX16_ONE,	-FX16_HALF,
	 FX16_HALF,			 FX16_HALF+FX16_ONE,	 FX16_HALF,
	 FX16_HALF,			 FX16_HALF+FX16_ONE,	-FX16_HALF,

	 -1,
};

static	const	fx16	QBlockData[]={
	GX_BEGIN_QUAD_STRIP,
	10,
	 FX16_HALF,			 FX16_HALF+FX16_ONE,	 FX16_HALF,
	 FX16_HALF,			 FX16_HALF+FX16_ONE,	-FX16_HALF,
	 FX16_HALF,			-FX16_HALF         ,	 FX16_HALF,
	 FX16_HALF,			-FX16_HALF         ,	-FX16_HALF,
	-FX16_HALF-FX16_ONE,-FX16_HALF         ,	 FX16_HALF,
	-FX16_HALF-FX16_ONE,-FX16_HALF         ,	-FX16_HALF,
	-FX16_HALF-FX16_ONE, FX16_HALF+FX16_ONE,	 FX16_HALF,
	-FX16_HALF-FX16_ONE, FX16_HALF+FX16_ONE,	-FX16_HALF,
	 FX16_HALF,			 FX16_HALF+FX16_ONE,	 FX16_HALF,
	 FX16_HALF,			 FX16_HALF+FX16_ONE,	-FX16_HALF,

	 -1,
};

//形状データ
typedef struct
{
	u16	rot_x;		//形状のＸ回転角度
	u16	rot_y;		//形状のＹ回転角度
	u16	rot_z;		//形状のＺ回転角度
	s8	push_a;		//Ａを押したときの形状ナンバー
	s8	push_y;		//Ｙを押したときの形状ナンバー
	s8	push_x;		//Ｘを押したときの形状ナンバー
	s8	push_b;		//Ｂを押したときの形状ナンバー
	s8	push_l;		//Ｌを押したときの形状ナンバー
	s8	push_r;		//Ｒを押したときの形状ナンバー
}BLOCK_SHAPE;

#define	ROTATE(num)	((65536/4)*num)

static	const	BLOCK_SHAPE	BlockShape[]={
	//0
	{
		ROTATE(0),		//形状のＸ回転角度
		ROTATE(0),		//形状のＹ回転角度
		ROTATE(0),		//形状のＺ回転角度
		 0,				//Ａを押したときの形状ナンバー
		 0,				//Ｙを押したときの形状ナンバー
		 0,				//Ｘを押したときの形状ナンバー
		 0,				//Ｂを押したときの形状ナンバー
		 0,				//Ｌを押したときの形状ナンバー
		 0,				//Ｒを押したときの形状ナンバー
	},
};

static	const	BLOCK_SHAPE	LBlockShape[]={
	//0
	{
		ROTATE(0),		//形状のＸ回転角度
		ROTATE(0),		//形状のＹ回転角度
		ROTATE(0),		//形状のＺ回転角度
		 1,				//Ａを押したときの形状ナンバー
		 2,				//Ｙを押したときの形状ナンバー
		 3,				//Ｘを押したときの形状ナンバー
		 4,				//Ｂを押したときの形状ナンバー
		 5,				//Ｌを押したときの形状ナンバー
		 6,				//Ｒを押したときの形状ナンバー
	},
	//1
	{
		ROTATE(0),		//形状のＸ回転角度
		ROTATE(1),		//形状のＹ回転角度
		ROTATE(0),		//形状のＺ回転角度
		 7,				//Ａを押したときの形状ナンバー
		 0,				//Ｙを押したときの形状ナンバー
		 8,				//Ｘを押したときの形状ナンバー
		 9,				//Ｂを押したときの形状ナンバー
		10,				//Ｌを押したときの形状ナンバー
		11,				//Ｒを押したときの形状ナンバー
	},
	//2
	{
		ROTATE(0),		//形状のＸ回転角度
		ROTATE(3),		//形状のＹ回転角度
		ROTATE(0),		//形状のＺ回転角度
		 0,				//Ａを押したときの形状ナンバー
		 7,				//Ｙを押したときの形状ナンバー
		12,				//Ｘを押したときの形状ナンバー
		13,				//Ｂを押したときの形状ナンバー
		14,				//Ｌを押したときの形状ナンバー
		15,				//Ｒを押したときの形状ナンバー
	},
	//3
	{
		ROTATE(3),		//形状のＸ回転角度
		ROTATE(0),		//形状のＹ回転角度
		ROTATE(0),		//形状のＺ回転角度
		10,				//Ａを押したときの形状ナンバー
		15,				//Ｙを押したときの形状ナンバー
		16,				//Ｘを押したときの形状ナンバー
		 0,				//Ｂを押したときの形状ナンバー
		12,				//Ｌを押したときの形状ナンバー
		 8,				//Ｒを押したときの形状ナンバー
	},
	//4
	{
		ROTATE(1),		//形状のＸ回転角度
		ROTATE(0),		//形状のＹ回転角度
		ROTATE(0),		//形状のＺ回転角度
		11,				//Ａを押したときの形状ナンバー
		14,				//Ｙを押したときの形状ナンバー
		 0,				//Ｘを押したときの形状ナンバー
		16,				//Ｂを押したときの形状ナンバー
		 9,				//Ｌを押したときの形状ナンバー
		13,				//Ｒを押したときの形状ナンバー
	},
	//5
	{
		ROTATE(0),		//形状のＸ回転角度
		ROTATE(0),		//形状のＹ回転角度
		ROTATE(1),		//形状のＺ回転角度
		 9,				//Ａを押したときの形状ナンバー
		12,				//Ｙを押したときの形状ナンバー
		10,				//Ｘを押したときの形状ナンバー
		14,				//Ｂを押したときの形状ナンバー
		17,				//Ｌを押したときの形状ナンバー
		 0,				//Ｒを押したときの形状ナンバー
	},
	//6
	{
		ROTATE(0),		//形状のＸ回転角度
		ROTATE(0),		//形状のＹ回転角度
		ROTATE(3),		//形状のＺ回転角度
		 8,				//Ａを押したときの形状ナンバー
		13,				//Ｙを押したときの形状ナンバー
		15,				//Ｘを押したときの形状ナンバー
		11,				//Ｂを押したときの形状ナンバー
		 0,				//Ｌを押したときの形状ナンバー
		17,				//Ｒを押したときの形状ナンバー
	},
	//7
	{
		ROTATE(0),		//形状のＸ回転角度
		ROTATE(2),		//形状のＹ回転角度
		ROTATE(0),		//形状のＺ回転角度
		 2,				//Ａを押したときの形状ナンバー
		 1,				//Ｙを押したときの形状ナンバー
		18,				//Ｘを押したときの形状ナンバー
		19,				//Ｂを押したときの形状ナンバー
		20,				//Ｌを押したときの形状ナンバー
		21,				//Ｒを押したときの形状ナンバー
	},
	//8
	{
		ROTATE(3),		//形状のＸ回転角度
		ROTATE(1),		//形状のＹ回転角度
		ROTATE(0),		//形状のＺ回転角度
		20,				//Ａを押したときの形状ナンバー
		 6,				//Ｙを押したときの形状ナンバー
		22,				//Ｘを押したときの形状ナンバー
		 1,				//Ｂを押したときの形状ナンバー
		 3,				//Ｌを押したときの形状ナンバー
		18,				//Ｒを押したときの形状ナンバー
	},
	//9
	{
		ROTATE(1),		//形状のＸ回転角度
		ROTATE(1),		//形状のＹ回転角度
		ROTATE(0),		//形状のＺ回転角度
		21,				//Ａを押したときの形状ナンバー
		 5,				//Ｙを押したときの形状ナンバー
		 1,				//Ｘを押したときの形状ナンバー
		22,				//Ｂを押したときの形状ナンバー
		19,				//Ｌを押したときの形状ナンバー
		 4,				//Ｒを押したときの形状ナンバー
	},
	//10
	{
		ROTATE(3),		//形状のＸ回転角度
		ROTATE(0),		//形状のＹ回転角度
		ROTATE(1),		//形状のＺ回転角度
		19,				//Ａを押したときの形状ナンバー
		 3,				//Ｙを押したときの形状ナンバー
		20,				//Ｘを押したときの形状ナンバー
		23,				//Ｂを押したときの形状ナンバー
		24,				//Ｌを押したときの形状ナンバー
		 1,				//Ｒを押したときの形状ナンバー
	},
	//11
	{
		ROTATE(1),		//形状のＸ回転角度
		ROTATE(0),		//形状のＹ回転角度
		ROTATE(3),		//形状のＺ回転角度
		18,				//Ａを押したときの形状ナンバー
		 4,				//Ｙを押したときの形状ナンバー
		 6,				//Ｘを押したときの形状ナンバー
		21,				//Ｂを押したときの形状ナンバー
		 1,				//Ｌを押したときの形状ナンバー
		24,				//Ｒを押したときの形状ナンバー
	},
	//12
	{
		ROTATE(3),		//形状のＸ回転角度
		ROTATE(3),		//形状のＹ回転角度
		ROTATE(0),		//形状のＺ回転角度
		23,				//Ａを押したときの形状ナンバー
		21,				//Ｙを押したときの形状ナンバー
		24,				//Ｘを押したときの形状ナンバー
		 2,				//Ｂを押したときの形状ナンバー
		18,				//Ｌを押したときの形状ナンバー
		 3,				//Ｒを押したときの形状ナンバー
	},
	//13
	{
		ROTATE(1),		//形状のＸ回転角度
		ROTATE(3),		//形状のＹ回転角度
		ROTATE(0),		//形状のＺ回転角度
		 6,				//Ａを押したときの形状ナンバー
		20,				//Ｙを押したときの形状ナンバー
		 2,				//Ｘを押したときの形状ナンバー
		24,				//Ｂを押したときの形状ナンバー
		 4,				//Ｌを押したときの形状ナンバー
		19,				//Ｒを押したときの形状ナンバー
	},
	//14
	{
		ROTATE(1),		//形状のＸ回転角度
		ROTATE(0),		//形状のＹ回転角度
		ROTATE(1),		//形状のＺ回転角度
		 4,				//Ａを押したときの形状ナンバー
		18,				//Ｙを押したときの形状ナンバー
		23,				//Ｘを押したときの形状ナンバー
		20,				//Ｂを押したときの形状ナンバー
		22,				//Ｌを押したときの形状ナンバー
		 2,				//Ｒを押したときの形状ナンバー
	},
	//15
	{
		ROTATE(3),		//形状のＸ回転角度
		ROTATE(0),		//形状のＹ回転角度
		ROTATE(3),		//形状のＺ回転角度
		 3,				//Ａを押したときの形状ナンバー
		19,				//Ｙを押したときの形状ナンバー
		21,				//Ｘを押したときの形状ナンバー
		 6,				//Ｂを押したときの形状ナンバー
		 2,				//Ｌを押したときの形状ナンバー
		22,				//Ｒを押したときの形状ナンバー
	},
	//16
	{
		ROTATE(0),		//形状のＸ回転角度
		ROTATE(2),		//形状のＹ回転角度
		ROTATE(2),		//形状のＺ回転角度
		24,				//Ａを押したときの形状ナンバー
		22,				//Ｙを押したときの形状ナンバー
		 4,				//Ｘを押したときの形状ナンバー
		 3,				//Ｂを押したときの形状ナンバー
		21,				//Ｌを押したときの形状ナンバー
		20,				//Ｒを押したときの形状ナンバー
	},
	//17
	{
		ROTATE(0),		//形状のＸ回転角度
		ROTATE(0),		//形状のＹ回転角度
		ROTATE(2),		//形状のＺ回転角度
		22,				//Ａを押したときの形状ナンバー
		24,				//Ｙを押したときの形状ナンバー
		19,				//Ｘを押したときの形状ナンバー
		18,				//Ｂを押したときの形状ナンバー
		 6,				//Ｌを押したときの形状ナンバー
		23,				//Ｒを押したときの形状ナンバー
	},
	//18
	{
		ROTATE(3),		//形状のＸ回転角度
		ROTATE(2),		//形状のＹ回転角度
		ROTATE(0),		//形状のＺ回転角度
		14,				//Ａを押したときの形状ナンバー
		11,				//Ｙを押したときの形状ナンバー
		17,				//Ｘを押したときの形状ナンバー
		 7,				//Ｂを押したときの形状ナンバー
		 8,				//Ｌを押したときの形状ナンバー
		12,				//Ｒを押したときの形状ナンバー
	},
	//19
	{
		ROTATE(1),		//形状のＸ回転角度
		ROTATE(2),		//形状のＹ回転角度
		ROTATE(0),		//形状のＺ回転角度
		15,				//Ａを押したときの形状ナンバー
		10,				//Ｙを押したときの形状ナンバー
		 7,				//Ｘを押したときの形状ナンバー
		17,				//Ｂを押したときの形状ナンバー
		13,				//Ｌを押したときの形状ナンバー
		 9,				//Ｒを押したときの形状ナンバー
	},
	//20
	{
		ROTATE(2),		//形状のＸ回転角度
		ROTATE(0),		//形状のＹ回転角度
		ROTATE(1),		//形状のＺ回転角度
		13,				//Ａを押したときの形状ナンバー
		 8,				//Ｙを押したときの形状ナンバー
		14,				//Ｘを押したときの形状ナンバー
		10,				//Ｂを押したときの形状ナンバー
		16,				//Ｌを押したときの形状ナンバー
		 7,				//Ｒを押したときの形状ナンバー
	},
	//21
	{
		ROTATE(2),		//形状のＸ回転角度
		ROTATE(0),		//形状のＹ回転角度
		ROTATE(3),		//形状のＺ回転角度
		12,				//Ａを押したときの形状ナンバー
		 9,				//Ｙを押したときの形状ナンバー
		11,				//Ｘを押したときの形状ナンバー
		15,				//Ｂを押したときの形状ナンバー
		 7,				//Ｌを押したときの形状ナンバー
		16,				//Ｒを押したときの形状ナンバー
	},
	//22
	{
		ROTATE(0),		//形状のＸ回転角度
		ROTATE(1),		//形状のＹ回転角度
		ROTATE(2),		//形状のＺ回転角度
		16,				//Ａを押したときの形状ナンバー
		17,				//Ｙを押したときの形状ナンバー
		 9,				//Ｘを押したときの形状ナンバー
		 8,				//Ｂを押したときの形状ナンバー
		15,				//Ｌを押したときの形状ナンバー
		14,				//Ｒを押したときの形状ナンバー
	},
	//23
	{
		ROTATE(0),		//形状のＸ回転角度
		ROTATE(0),		//形状のＹ回転角度
		ROTATE(1),		//形状のＺ回転角度
		 9,				//Ａを押したときの形状ナンバー
		12,				//Ｙを押したときの形状ナンバー
		10,				//Ｘを押したときの形状ナンバー
		14,				//Ｂを押したときの形状ナンバー
		17,				//Ｌを押したときの形状ナンバー
		 0,				//Ｒを押したときの形状ナンバー
	},
	//24
	{
		ROTATE(2),		//形状のＸ回転角度
		ROTATE(3),		//形状のＹ回転角度
		ROTATE(0),		//形状のＺ回転角度
		17,				//Ａを押したときの形状ナンバー
		16,				//Ｙを押したときの形状ナンバー
		13,				//Ｘを押したときの形状ナンバー
		12,				//Ｂを押したときの形状ナンバー
		11,				//Ｌを押したときの形状ナンバー
		10,				//Ｒを押したときの形状ナンバー
	},
};

static	const	BLOCK_SHAPE	SBlockShape[]={
	//0
	{
		ROTATE(0),		//形状のＸ回転角度
		ROTATE(0),		//形状のＹ回転角度
		ROTATE(0),		//形状のＺ回転角度
		 1,				//Ａを押したときの形状ナンバー
		 2,				//Ｙを押したときの形状ナンバー
		 3,				//Ｘを押したときの形状ナンバー
		 4,				//Ｂを押したときの形状ナンバー
		 5,				//Ｌを押したときの形状ナンバー
		 6,				//Ｒを押したときの形状ナンバー
	},
	//1
	{
		ROTATE(0),		//形状のＸ回転角度
		ROTATE(1),		//形状のＹ回転角度
		ROTATE(0),		//形状のＺ回転角度
		 7,				//Ａを押したときの形状ナンバー
		 0,				//Ｙを押したときの形状ナンバー
		 8,				//Ｘを押したときの形状ナンバー
		 9,				//Ｂを押したときの形状ナンバー
		10,				//Ｌを押したときの形状ナンバー
		11,				//Ｒを押したときの形状ナンバー
	},
	//2
	{
		ROTATE(0),		//形状のＸ回転角度
		ROTATE(3),		//形状のＹ回転角度
		ROTATE(0),		//形状のＺ回転角度
		 0,				//Ａを押したときの形状ナンバー
		 7,				//Ｙを押したときの形状ナンバー
		12,				//Ｘを押したときの形状ナンバー
		13,				//Ｂを押したときの形状ナンバー
		14,				//Ｌを押したときの形状ナンバー
		15,				//Ｒを押したときの形状ナンバー
	},
	//3
	{
		ROTATE(3),		//形状のＸ回転角度
		ROTATE(0),		//形状のＹ回転角度
		ROTATE(0),		//形状のＺ回転角度
		11,				//Ａを押したときの形状ナンバー
		15,				//Ｙを押したときの形状ナンバー
		16,				//Ｘを押したときの形状ナンバー
		 0,				//Ｂを押したときの形状ナンバー
		12,				//Ｌを押したときの形状ナンバー
		 8,				//Ｒを押したときの形状ナンバー
	},
	//4
	{
		ROTATE(1),		//形状のＸ回転角度
		ROTATE(0),		//形状のＹ回転角度
		ROTATE(0),		//形状のＺ回転角度
		11,				//Ａを押したときの形状ナンバー
		14,				//Ｙを押したときの形状ナンバー
		 0,				//Ｘを押したときの形状ナンバー
		16,				//Ｂを押したときの形状ナンバー
		 9,				//Ｌを押したときの形状ナンバー
		13,				//Ｒを押したときの形状ナンバー
	},
	//5
	{
		ROTATE(0),		//形状のＸ回転角度
		ROTATE(0),		//形状のＹ回転角度
		ROTATE(1),		//形状のＺ回転角度
		 9,				//Ａを押したときの形状ナンバー
		12,				//Ｙを押したときの形状ナンバー
		10,				//Ｘを押したときの形状ナンバー
		14,				//Ｂを押したときの形状ナンバー
		 7,				//Ｌを押したときの形状ナンバー
		 0,				//Ｒを押したときの形状ナンバー
	},
	//6
	{
		ROTATE(0),		//形状のＸ回転角度
		ROTATE(0),		//形状のＹ回転角度
		ROTATE(3),		//形状のＺ回転角度
		 8,				//Ａを押したときの形状ナンバー
		13,				//Ｙを押したときの形状ナンバー
		15,				//Ｘを押したときの形状ナンバー
		11,				//Ｂを押したときの形状ナンバー
		 0,				//Ｌを押したときの形状ナンバー
		17,				//Ｒを押したときの形状ナンバー
	},
	//7
	{
		ROTATE(0),		//形状のＸ回転角度
		ROTATE(2),		//形状のＹ回転角度
		ROTATE(0),		//形状のＺ回転角度
		 2,				//Ａを押したときの形状ナンバー
		 1,				//Ｙを押したときの形状ナンバー
		18,				//Ｘを押したときの形状ナンバー
		19,				//Ｂを押したときの形状ナンバー
		20,				//Ｌを押したときの形状ナンバー
		 5,				//Ｒを押したときの形状ナンバー
	},
	//8
	{
		ROTATE(3),		//形状のＸ回転角度
		ROTATE(1),		//形状のＹ回転角度
		ROTATE(0),		//形状のＺ回転角度
		20,				//Ａを押したときの形状ナンバー
		 6,				//Ｙを押したときの形状ナンバー
		23,				//Ｘを押したときの形状ナンバー
		 1,				//Ｂを押したときの形状ナンバー
		 3,				//Ｌを押したときの形状ナンバー
		18,				//Ｒを押したときの形状ナンバー
	},
	//9
	{
		ROTATE(1),		//形状のＸ回転角度
		ROTATE(1),		//形状のＹ回転角度
		ROTATE(0),		//形状のＺ回転角度
		21,				//Ａを押したときの形状ナンバー
		 5,				//Ｙを押したときの形状ナンバー
		 1,				//Ｘを押したときの形状ナンバー
		 2,				//Ｂを押したときの形状ナンバー
		19,				//Ｌを押したときの形状ナンバー
		 4,				//Ｒを押したときの形状ナンバー
	},
	//10
	{
		ROTATE(3),		//形状のＸ回転角度
		ROTATE(0),		//形状のＹ回転角度
		ROTATE(1),		//形状のＺ回転角度
		19,				//Ａを押したときの形状ナンバー
		 3,				//Ｙを押したときの形状ナンバー
		20,				//Ｘを押したときの形状ナンバー
		 5,				//Ｂを押したときの形状ナンバー
		22,				//Ｌを押したときの形状ナンバー
		 1,				//Ｒを押したときの形状ナンバー
	},
	//11
	{
		ROTATE(3),		//形状のＸ回転角度
		ROTATE(2),		//形状のＹ回転角度
		ROTATE(1),		//形状のＺ回転角度
		18,				//Ａを押したときの形状ナンバー
		 4,				//Ｙを押したときの形状ナンバー
		 6,				//Ｘを押したときの形状ナンバー
		21,				//Ｂを押したときの形状ナンバー
		 1,				//Ｌを押したときの形状ナンバー
		22,				//Ｒを押したときの形状ナンバー
	},
	//12
	{
		ROTATE(3),		//形状のＸ回転角度
		ROTATE(3),		//形状のＹ回転角度
		ROTATE(0),		//形状のＺ回転角度
		 5,				//Ａを押したときの形状ナンバー
		21,				//Ｙを押したときの形状ナンバー
		22,				//Ｘを押したときの形状ナンバー
		 2,				//Ｂを押したときの形状ナンバー
		18,				//Ｌを押したときの形状ナンバー
		 3,				//Ｒを押したときの形状ナンバー
	},
	//13
	{
		ROTATE(3),		//形状のＸ回転角度
		ROTATE(3),		//形状のＹ回転角度
		ROTATE(2),		//形状のＺ回転角度
		 6,				//Ａを押したときの形状ナンバー
		20,				//Ｙを押したときの形状ナンバー
		 2,				//Ｘを押したときの形状ナンバー
		22,				//Ｂを押したときの形状ナンバー
		 4,				//Ｌを押したときの形状ナンバー
		19,				//Ｒを押したときの形状ナンバー
	},
	//14
	{
		ROTATE(1),		//形状のＸ回転角度
		ROTATE(0),		//形状のＹ回転角度
		ROTATE(1),		//形状のＺ回転角度
		 4,				//Ａを押したときの形状ナンバー
		18,				//Ｙを押したときの形状ナンバー
		 5,				//Ｘを押したときの形状ナンバー
		20,				//Ｂを押したときの形状ナンバー
		23,				//Ｌを押したときの形状ナンバー
		 2,				//Ｒを押したときの形状ナンバー
	},
	//15
	{
		ROTATE(3),		//形状のＸ回転角度
		ROTATE(0),		//形状のＹ回転角度
		ROTATE(3),		//形状のＺ回転角度
		 3,				//Ａを押したときの形状ナンバー
		19,				//Ｙを押したときの形状ナンバー
		21,				//Ｘを押したときの形状ナンバー
		 6,				//Ｂを押したときの形状ナンバー
		 2,				//Ｌを押したときの形状ナンバー
		23,				//Ｒを押したときの形状ナンバー
	},
	//16
	{
		ROTATE(0),		//形状のＸ回転角度
		ROTATE(2),		//形状のＹ回転角度
		ROTATE(2),		//形状のＺ回転角度
		22,				//Ａを押したときの形状ナンバー
		23,				//Ｙを押したときの形状ナンバー
		 4,				//Ｘを押したときの形状ナンバー
		 3,				//Ｂを押したときの形状ナンバー
		21,				//Ｌを押したときの形状ナンバー
		20,				//Ｒを押したときの形状ナンバー
	},
	//17
	{
		ROTATE(0),		//形状のＸ回転角度
		ROTATE(0),		//形状のＹ回転角度
		ROTATE(2),		//形状のＺ回転角度
		23,				//Ａを押したときの形状ナンバー
		22,				//Ｙを押したときの形状ナンバー
		19,				//Ｘを押したときの形状ナンバー
		18,				//Ｂを押したときの形状ナンバー
		 6,				//Ｌを押したときの形状ナンバー
		 5,				//Ｒを押したときの形状ナンバー
	},
	//18
	{
		ROTATE(3),		//形状のＸ回転角度
		ROTATE(2),		//形状のＹ回転角度
		ROTATE(0),		//形状のＺ回転角度
		14,				//Ａを押したときの形状ナンバー
		11,				//Ｙを押したときの形状ナンバー
		17,				//Ｘを押したときの形状ナンバー
		 7,				//Ｂを押したときの形状ナンバー
		 8,				//Ｌを押したときの形状ナンバー
		12,				//Ｒを押したときの形状ナンバー
	},
	//19
	{
		ROTATE(1),		//形状のＸ回転角度
		ROTATE(2),		//形状のＹ回転角度
		ROTATE(0),		//形状のＺ回転角度
		15,				//Ａを押したときの形状ナンバー
		11,				//Ｙを押したときの形状ナンバー
		 7,				//Ｘを押したときの形状ナンバー
		17,				//Ｂを押したときの形状ナンバー
		13,				//Ｌを押したときの形状ナンバー
		 9,				//Ｒを押したときの形状ナンバー
	},
	//20
	{
		ROTATE(0),		//形状のＸ回転角度
		ROTATE(2),		//形状のＹ回転角度
		ROTATE(3),		//形状のＺ回転角度
		13,				//Ａを押したときの形状ナンバー
		 8,				//Ｙを押したときの形状ナンバー
		14,				//Ｘを押したときの形状ナンバー
		10,				//Ｂを押したときの形状ナンバー
		16,				//Ｌを押したときの形状ナンバー
		 7,				//Ｒを押したときの形状ナンバー
	},
	//21
	{
		ROTATE(0),		//形状のＸ回転角度
		ROTATE(2),		//形状のＹ回転角度
		ROTATE(1),		//形状のＺ回転角度
		12,				//Ａを押したときの形状ナンバー
		 9,				//Ｙを押したときの形状ナンバー
		11,				//Ｘを押したときの形状ナンバー
		15,				//Ｂを押したときの形状ナンバー
		 7,				//Ｌを押したときの形状ナンバー
		16,				//Ｒを押したときの形状ナンバー
	},
	//22
	{
		ROTATE(0),		//形状のＸ回転角度
		ROTATE(3),		//形状のＹ回転角度
		ROTATE(2),		//形状のＺ回転角度
		17,				//Ａを押したときの形状ナンバー
		16,				//Ｙを押したときの形状ナンバー
		13,				//Ｘを押したときの形状ナンバー
		12,				//Ｂを押したときの形状ナンバー
		11,				//Ｌを押したときの形状ナンバー
		10,				//Ｒを押したときの形状ナンバー
	},
	//23
	{
		ROTATE(0),		//形状のＸ回転角度
		ROTATE(1),		//形状のＹ回転角度
		ROTATE(2),		//形状のＺ回転角度
		16,				//Ａを押したときの形状ナンバー
		17,				//Ｙを押したときの形状ナンバー
		 9,				//Ｘを押したときの形状ナンバー
		 8,				//Ｂを押したときの形状ナンバー
		15,				//Ｌを押したときの形状ナンバー
		14,				//Ｒを押したときの形状ナンバー
	},
};

static	const	BLOCK_SHAPE	TBlockShape[]={
	//0
	{
		ROTATE(0),		//形状のＸ回転角度
		ROTATE(0),		//形状のＹ回転角度
		ROTATE(0),		//形状のＺ回転角度
		 1,				//Ａを押したときの形状ナンバー
		 1,				//Ｙを押したときの形状ナンバー
		 2,				//Ｘを押したときの形状ナンバー
		 3,				//Ｂを押したときの形状ナンバー
		 4,				//Ｌを押したときの形状ナンバー
		 5,				//Ｒを押したときの形状ナンバー
	},
	//1
	{
		ROTATE(0),		//形状のＸ回転角度
		ROTATE(1),		//形状のＹ回転角度
		ROTATE(0),		//形状のＺ回転角度
		 0,				//Ａを押したときの形状ナンバー
		 0,				//Ｙを押したときの形状ナンバー
		 6,				//Ｘを押したときの形状ナンバー
		 7,				//Ｂを押したときの形状ナンバー
		 8,				//Ｌを押したときの形状ナンバー
		 9,				//Ｒを押したときの形状ナンバー
	},
	//2
	{
		ROTATE(3),		//形状のＸ回転角度
		ROTATE(0),		//形状のＹ回転角度
		ROTATE(0),		//形状のＺ回転角度
		 8,				//Ａを押したときの形状ナンバー
		 9,				//Ｙを押したときの形状ナンバー
		10,				//Ｘを押したときの形状ナンバー
		 0,				//Ｂを押したときの形状ナンバー
		 6,				//Ｌを押したときの形状ナンバー
		 6,				//Ｒを押したときの形状ナンバー
	},
	//3
	{
		ROTATE(1),		//形状のＸ回転角度
		ROTATE(0),		//形状のＹ回転角度
		ROTATE(0),		//形状のＺ回転角度
		 9,				//Ａを押したときの形状ナンバー
		 8,				//Ｙを押したときの形状ナンバー
		 0,				//Ｘを押したときの形状ナンバー
		10,				//Ｂを押したときの形状ナンバー
		 7,				//Ｌを押したときの形状ナンバー
		 7,				//Ｒを押したときの形状ナンバー
	},
	//4
	{
		ROTATE(0),		//形状のＸ回転角度
		ROTATE(0),		//形状のＹ回転角度
		ROTATE(1),		//形状のＺ回転角度
		 7,				//Ａを押したときの形状ナンバー
		 6,				//Ｙを押したときの形状ナンバー
		 8,				//Ｘを押したときの形状ナンバー
		 8,				//Ｂを押したときの形状ナンバー
		10,				//Ｌを押したときの形状ナンバー
		 0,				//Ｒを押したときの形状ナンバー
	},
	//5
	{
		ROTATE(0),		//形状のＸ回転角度
		ROTATE(0),		//形状のＹ回転角度
		ROTATE(3),		//形状のＺ回転角度
		 6,				//Ａを押したときの形状ナンバー
		 7,				//Ｙを押したときの形状ナンバー
		 9,				//Ｘを押したときの形状ナンバー
		 9,				//Ｂを押したときの形状ナンバー
		 0,				//Ｌを押したときの形状ナンバー
		10,				//Ｒを押したときの形状ナンバー
	},
	//6
	{
		ROTATE(0),		//形状のＸ回転角度
		ROTATE(1),		//形状のＹ回転角度
		ROTATE(3),		//形状のＺ回転角度
		 4,				//Ａを押したときの形状ナンバー
		 5,				//Ｙを押したときの形状ナンバー
		11,				//Ｘを押したときの形状ナンバー
		 1,				//Ｂを押したときの形状ナンバー
		 2,				//Ｌを押したときの形状ナンバー
		 2,				//Ｒを押したときの形状ナンバー
	},
	//7
	{
		ROTATE(0),		//形状のＸ回転角度
		ROTATE(3),		//形状のＹ回転角度
		ROTATE(3),		//形状のＺ回転角度
		 5,				//Ａを押したときの形状ナンバー
		 4,				//Ｙを押したときの形状ナンバー
		 1,				//Ｘを押したときの形状ナンバー
		11,				//Ｂを押したときの形状ナンバー
		 3,				//Ｌを押したときの形状ナンバー
		 3,				//Ｒを押したときの形状ナンバー
	},
	//8
	{
		ROTATE(3),		//形状のＸ回転角度
		ROTATE(0),		//形状のＹ回転角度
		ROTATE(1),		//形状のＺ回転角度
		 3,				//Ａを押したときの形状ナンバー
		 2,				//Ｙを押したときの形状ナンバー
		 4,				//Ｘを押したときの形状ナンバー
		 4,				//Ｂを押したときの形状ナンバー
		11,				//Ｌを押したときの形状ナンバー
		 1,				//Ｒを押したときの形状ナンバー
	},
	//9
	{
		ROTATE(3),		//形状のＸ回転角度
		ROTATE(0),		//形状のＹ回転角度
		ROTATE(3),		//形状のＺ回転角度
		 2,				//Ａを押したときの形状ナンバー
		 3,				//Ｙを押したときの形状ナンバー
		 5,				//Ｘを押したときの形状ナンバー
		 5,				//Ｂを押したときの形状ナンバー
		 1,				//Ｌを押したときの形状ナンバー
		11,				//Ｒを押したときの形状ナンバー
	},
	//10
	{
		ROTATE(2),		//形状のＸ回転角度
		ROTATE(0),		//形状のＹ回転角度
		ROTATE(0),		//形状のＺ回転角度
		11,				//Ａを押したときの形状ナンバー
		11,				//Ｙを押したときの形状ナンバー
		 3,				//Ｘを押したときの形状ナンバー
		 2,				//Ｂを押したときの形状ナンバー
		 5,				//Ｌを押したときの形状ナンバー
		 4,				//Ｒを押したときの形状ナンバー
	},
	//11
	{
		ROTATE(2),		//形状のＸ回転角度
		ROTATE(1),		//形状のＹ回転角度
		ROTATE(0),		//形状のＺ回転角度
		10,				//Ａを押したときの形状ナンバー
		10,				//Ｙを押したときの形状ナンバー
		 7,				//Ｘを押したときの形状ナンバー
		 6,				//Ｂを押したときの形状ナンバー
		 9,				//Ｌを押したときの形状ナンバー
		 8,				//Ｒを押したときの形状ナンバー
	},
};

static	const	BLOCK_SHAPE	IBlockShape[]={
	//0
	{
		ROTATE(0),		//形状のＸ回転角度
		ROTATE(0),		//形状のＹ回転角度
		ROTATE(0),		//形状のＺ回転角度
		 0,				//Ａを押したときの形状ナンバー
		 0,				//Ｙを押したときの形状ナンバー
		 1,				//Ｘを押したときの形状ナンバー
		 2,				//Ｂを押したときの形状ナンバー
		 3,				//Ｌを押したときの形状ナンバー
		 4,				//Ｒを押したときの形状ナンバー
	},
	//1
	{
		ROTATE(3),		//形状のＸ回転角度
		ROTATE(0),		//形状のＹ回転角度
		ROTATE(0),		//形状のＺ回転角度
		 3,				//Ａを押したときの形状ナンバー
		 4,				//Ｙを押したときの形状ナンバー
		 5,				//Ｘを押したときの形状ナンバー
		 0,				//Ｂを押したときの形状ナンバー
		 1,				//Ｌを押したときの形状ナンバー
		 1,				//Ｒを押したときの形状ナンバー
	},
	//2
	{
		ROTATE(1),		//形状のＸ回転角度
		ROTATE(0),		//形状のＹ回転角度
		ROTATE(0),		//形状のＺ回転角度
		 4,				//Ａを押したときの形状ナンバー
		 3,				//Ｙを押したときの形状ナンバー
		 0,				//Ｘを押したときの形状ナンバー
		 5,				//Ｂを押したときの形状ナンバー
		 2,				//Ｌを押したときの形状ナンバー
		 2,				//Ｒを押したときの形状ナンバー
	},
	//3
	{
		ROTATE(0),		//形状のＸ回転角度
		ROTATE(0),		//形状のＹ回転角度
		ROTATE(1),		//形状のＺ回転角度
		 2,				//Ａを押したときの形状ナンバー
		 1,				//Ｙを押したときの形状ナンバー
		 3,				//Ｘを押したときの形状ナンバー
		 3,				//Ｂを押したときの形状ナンバー
		 5,				//Ｌを押したときの形状ナンバー
		 0,				//Ｒを押したときの形状ナンバー
	},
	//4
	{
		ROTATE(0),		//形状のＸ回転角度
		ROTATE(0),		//形状のＹ回転角度
		ROTATE(3),		//形状のＺ回転角度
		 1,				//Ａを押したときの形状ナンバー
		 2,				//Ｙを押したときの形状ナンバー
		 4,				//Ｘを押したときの形状ナンバー
		 4,				//Ｂを押したときの形状ナンバー
		 0,				//Ｌを押したときの形状ナンバー
		 5,				//Ｒを押したときの形状ナンバー
	},
	//5
	{
		ROTATE(2),		//形状のＸ回転角度
		ROTATE(0),		//形状のＹ回転角度
		ROTATE(0),		//形状のＺ回転角度
		 5,				//Ａを押したときの形状ナンバー
		 5,				//Ｙを押したときの形状ナンバー
		 2,				//Ｘを押したときの形状ナンバー
		 1,				//Ｂを押したときの形状ナンバー
		 4,				//Ｌを押したときの形状ナンバー
		 3,				//Ｒを押したときの形状ナンバー
	},
};

static	const	BLOCK_SHAPE	QBlockShape[]={
	//0
	{
		ROTATE(0),		//形状のＸ回転角度
		ROTATE(0),		//形状のＹ回転角度
		ROTATE(0),		//形状のＺ回転角度
		 1,				//Ａを押したときの形状ナンバー
		 2,				//Ｙを押したときの形状ナンバー
		 3,				//Ｘを押したときの形状ナンバー
		 4,				//Ｂを押したときの形状ナンバー
		 5,				//Ｌを押したときの形状ナンバー
		 6,				//Ｒを押したときの形状ナンバー
	},
	//1
	{
		ROTATE(0),		//形状のＸ回転角度
		ROTATE(1),		//形状のＹ回転角度
		ROTATE(0),		//形状のＺ回転角度
		 6,				//Ａを押したときの形状ナンバー
		 0,				//Ｙを押したときの形状ナンバー
		 2,				//Ｘを押したときの形状ナンバー
		 7,				//Ｂを押したときの形状ナンバー
		 4,				//Ｌを押したときの形状ナンバー
		 8,				//Ｒを押したときの形状ナンバー
	},
	//2
	{
		ROTATE(0),		//形状のＸ回転角度
		ROTATE(3),		//形状のＹ回転角度
		ROTATE(0),		//形状のＺ回転角度
		 0,				//Ａを押したときの形状ナンバー
		 6,				//Ｙを押したときの形状ナンバー
		 9,				//Ｘを押したときの形状ナンバー
		 1,				//Ｂを押したときの形状ナンバー
		 3,				//Ｌを押したときの形状ナンバー
		10,				//Ｒを押したときの形状ナンバー
	},
	//3
	{
		ROTATE(3),		//形状のＸ回転角度
		ROTATE(0),		//形状のＹ回転角度
		ROTATE(0),		//形状のＺ回転角度
		 4,				//Ａを押したときの形状ナンバー
		10,				//Ｙを押したときの形状ナンバー
		 5,				//Ｘを押したときの形状ナンバー
		 0,				//Ｂを押したときの形状ナンバー
		 9,				//Ｌを押したときの形状ナンバー
		 2,				//Ｒを押したときの形状ナンバー
	},
	//4
	{
		ROTATE(1),		//形状のＸ回転角度
		ROTATE(0),		//形状のＹ回転角度
		ROTATE(0),		//形状のＺ回転角度
		 8,				//Ａを押したときの形状ナンバー
		 3,				//Ｙを押したときの形状ナンバー
		 0,				//Ｘを押したときの形状ナンバー
		 5,				//Ｂを押したときの形状ナンバー
		 7,				//Ｌを押したときの形状ナンバー
		 1,				//Ｒを押したときの形状ナンバー
	},
	//5
	{
		ROTATE(0),		//形状のＸ回転角度
		ROTATE(0),		//形状のＹ回転角度
		ROTATE(1),		//形状のＺ回転角度
		 7,				//Ａを押したときの形状ナンバー
		 9,				//Ｙを押したときの形状ナンバー
		 4,				//Ｘを押したときの形状ナンバー
		 3,				//Ｂを押したときの形状ナンバー
		11,				//Ｌを押したときの形状ナンバー
		 0,				//Ｒを押したときの形状ナンバー
	},
	//6
	{
		ROTATE(0),		//形状のＸ回転角度
		ROTATE(0),		//形状のＹ回転角度
		ROTATE(3),		//形状のＺ回転角度
		 2,				//Ａを押したときの形状ナンバー
		 1,				//Ｙを押したときの形状ナンバー
		10,				//Ｘを押したときの形状ナンバー
		 8,				//Ｂを押したときの形状ナンバー
		 0,				//Ｌを押したときの形状ナンバー
		11,				//Ｒを押したときの形状ナンバー
	},
	//7
	{
		ROTATE(0),		//形状のＸ回転角度
		ROTATE(1),		//形状のＹ回転角度
		ROTATE(1),		//形状のＺ回転角度
		11,				//Ａを押したときの形状ナンバー
		 5,				//Ｙを押したときの形状ナンバー
		 1,				//Ｘを押したときの形状ナンバー
		 9,				//Ｂを押したときの形状ナンバー
		 8,				//Ｌを押したときの形状ナンバー
		 4,				//Ｒを押したときの形状ナンバー
	},
	//8
	{
		ROTATE(1),		//形状のＸ回転角度
		ROTATE(0),		//形状のＹ回転角度
		ROTATE(3),		//形状のＺ回転角度
		10,				//Ａを押したときの形状ナンバー
		 4,				//Ｙを押したときの形状ナンバー
		 6,				//Ｘを押したときの形状ナンバー
		11,				//Ｂを押したときの形状ナンバー
		 1,				//Ｌを押したときの形状ナンバー
		 7,				//Ｒを押したときの形状ナンバー
	},
	//9
	{
		ROTATE(0),		//形状のＸ回転角度
		ROTATE(3),		//形状のＹ回転角度
		ROTATE(1),		//形状のＺ回転角度
		 5,				//Ａを押したときの形状ナンバー
		11,				//Ｙを押したときの形状ナンバー
		 7,				//Ｘを押したときの形状ナンバー
		 2,				//Ｂを押したときの形状ナンバー
		10,				//Ｌを押したときの形状ナンバー
		 3,				//Ｒを押したときの形状ナンバー
	},
	//10
	{
		ROTATE(3),		//形状のＸ回転角度
		ROTATE(0),		//形状のＹ回転角度
		ROTATE(3),		//形状のＺ回転角度
		 3,				//Ａを押したときの形状ナンバー
		 8,				//Ｙを押したときの形状ナンバー
		11,				//Ｘを押したときの形状ナンバー
		 6,				//Ｂを押したときの形状ナンバー
		 2,				//Ｌを押したときの形状ナンバー
		 9,				//Ｒを押したときの形状ナンバー
	},
	//11
	{
		ROTATE(0),		//形状のＸ回転角度
		ROTATE(0),		//形状のＹ回転角度
		ROTATE(2),		//形状のＺ回転角度
		 9,				//Ａを押したときの形状ナンバー
		 7,				//Ｙを押したときの形状ナンバー
		 8,				//Ｘを押したときの形状ナンバー
		10,				//Ｂを押したときの形状ナンバー
		 6,				//Ｌを押したときの形状ナンバー
		 5,				//Ｒを押したときの形状ナンバー
	},
};

//当たり判定用データ
typedef struct
{
	int	x;
	int	y;
	int	z;
}BLOCK_COLLISION;

static	const	BLOCK_COLLISION	BlockCollision[]={
	//0
	{0,0,0},
};

static	const	BLOCK_COLLISION	LBlockCollision[]={
	//0
	{ 0,-1, 0},
	{ 0, 0, 0},
	{ 0, 1, 0},
	{ 1, 1, 0},
	//1
	{ 0,-1, 0},
	{ 0, 0, 0},
	{ 0, 1, 0},
	{ 0, 1,-1},
	//2
	{ 0,-1, 0},
	{ 0, 0, 0},
	{ 0, 1, 0},
	{ 0, 1, 1},
	//3
	{ 0, 0,-1},
	{ 0, 0, 0},
	{ 0, 0, 1},
	{ 1, 0, 1},
	//4
	{ 0, 0, 1},
	{ 0, 0, 0},
	{ 0, 0,-1},
	{ 1, 0,-1},
	//5
	{-1, 0, 0},
	{ 0, 0, 0},
	{ 1, 0, 0},
	{ 1,-1, 0},
	//6
	{ 1, 0, 0},
	{ 0, 0, 0},
	{-1, 0, 0},
	{-1, 1, 0},
	//7
	{ 0,-1, 0},
	{ 0, 0, 0},
	{ 0, 1, 0},
	{-1, 1, 0},
	//8
	{ 0, 0,-1},
	{ 0, 0, 0},
	{ 0, 0, 1},
	{ 0, 1, 1},
	//9
	{ 0, 0, 1},
	{ 0, 0, 0},
	{ 0, 0,-1},
	{ 0,-1,-1},
	//10
	{-1, 0, 0},
	{ 0, 0, 0},
	{ 1, 0, 0},
	{ 1, 0,-1},
	//11
	{ 1, 0, 0},
	{ 0, 0, 0},
	{-1, 0, 0},
	{-1, 0,-1},
	//12
	{ 0, 0,-1},
	{ 0, 0, 0},
	{ 0, 0, 1},
	{ 0,-1, 1},
	//13
	{ 0, 0, 1},
	{ 0, 0, 0},
	{ 0, 0,-1},
	{ 0, 1,-1},
	//14
	{-1, 0, 0},
	{ 0, 0, 0},
	{ 1, 0, 0},
	{ 1, 0, 1},
	//15
	{ 1, 0, 0},
	{ 0, 0, 0},
	{-1, 0, 0},
	{-1, 0, 1},
	//16
	{ 0, 1, 0},
	{ 0, 0, 0},
	{ 0,-1, 0},
	{ 1,-1, 0},
	//17
	{ 0, 1, 0},
	{ 0, 0, 0},
	{ 0,-1, 0},
	{-1,-1, 0},
	//18
	{ 0, 0,-1},
	{ 0, 0, 0},
	{ 0, 0, 1},
	{-1, 0, 1},
	//19
	{ 0, 0, 1},
	{ 0, 0, 0},
	{ 0, 0,-1},
	{-1, 0,-1},
	//20
	{-1, 0, 0},
	{ 0, 0, 0},
	{ 1, 0, 0},
	{ 1, 1, 0},
	//21
	{ 1, 0, 0},
	{ 0, 0, 0},
	{-1, 0, 0},
	{-1,-1, 0},
	//22
	{ 0, 1, 0},
	{ 0, 0, 0},
	{ 0,-1, 0},
	{ 0,-1, 1},
	//23
	{-1, 0, 0},
	{ 0, 0, 0},
	{ 1, 0, 0},
	{ 1,-1, 0},
	//24
	{ 0, 1, 0},
	{ 0, 0, 0},
	{ 0,-1, 0},
	{ 0,-1,-1},
};

static	const	BLOCK_COLLISION	SBlockCollision[]={
	//0
	{ 0,-1, 0},
	{ 0, 0, 0},
	{ 1, 0, 0},
	{ 1, 1, 0},
	//1
	{ 0,-1, 0},
	{ 0, 0, 0},
	{ 0, 0,-1},
	{ 0, 1,-1},
	//2
	{ 0,-1, 0},
	{ 0, 0, 0},
	{ 0, 0, 1},
	{ 0, 1, 1},
	//3
	{ 0, 0,-1},
	{ 0, 0, 0},
	{ 1, 0, 0},
	{ 1, 0, 1},
	//4
	{ 0, 0, 1},
	{ 0, 0, 0},
	{ 1, 0, 0},
	{ 1, 0,-1},
	//5
	{-1, 0, 0},
	{ 0, 0, 0},
	{ 0,-1, 0},
	{ 1,-1, 0},
	//6
	{ 1, 0, 0},
	{ 0, 0, 0},
	{ 0, 1, 0},
	{-1, 1, 0},
	//7
	{ 0,-1, 0},
	{ 0, 0, 0},
	{-1, 0, 0},
	{-1, 1, 0},
	//8
	{ 0, 0,-1},
	{ 0, 0, 0},
	{ 0, 1, 0},
	{ 0, 1, 1},
	//9
	{ 0, 0, 1},
	{ 0, 0, 0},
	{ 0,-1, 0},
	{ 0,-1,-1},
	//10
	{-1, 0, 0},
	{ 0, 0, 0},
	{ 0, 0,-1},
	{ 1, 0,-1},
	//11
	{ 1, 0, 0},
	{ 0, 0, 0},
	{ 0, 0,-1},
	{-1, 0,-1},
	//12
	{ 0, 0,-1},
	{ 0, 0, 0},
	{ 0,-1, 0},
	{ 0,-1, 1},
	//13
	{ 0, 0, 1},
	{ 0, 0, 0},
	{ 0, 1, 0},
	{ 0, 1,-1},
	//14
	{-1, 0, 0},
	{ 0, 0, 0},
	{ 0, 0, 1},
	{ 1, 0, 1},
	//15
	{ 1, 0, 0},
	{ 0, 0, 0},
	{ 0, 0, 1},
	{-1, 0, 1},
	//16
	{ 0, 1, 0},
	{ 0, 0, 0},
	{ 1, 0, 0},
	{ 1,-1, 0},
	//17
	{ 0, 1, 0},
	{ 0, 0, 0},
	{-1, 0, 0},
	{-1,-1, 0},
	//18
	{ 0, 0,-1},
	{ 0, 0, 0},
	{-1, 0, 0},
	{-1, 0, 1},
	//19
	{ 0, 0, 1},
	{ 0, 0, 0},
	{-1, 0, 0},
	{-1, 0,-1},
	//20
	{-1, 0, 0},
	{ 0, 0, 0},
	{ 0, 1, 0},
	{ 1, 1, 0},
	//21
	{ 1, 0, 0},
	{ 0, 0, 0},
	{ 0,-1, 0},
	{-1,-1, 0},
	//22
	{ 0, 1, 0},
	{ 0, 0, 0},
	{ 0, 0,-1},
	{ 0,-1,-1},
	//23
	{ 0, 1, 0},
	{ 0, 0, 0},
	{ 0, 0, 1},
	{ 0,-1, 1},
};

static	const	BLOCK_COLLISION	TBlockCollision[]={
	//0
	{-1, 0, 0},
	{ 0, 0, 0},
	{ 1, 0, 0},
	{ 0,-1, 0},
	//1
	{ 0, 0,-1},
	{ 0, 0, 0},
	{ 0, 0, 1},
	{ 0,-1, 0},
	//2
	{-1, 0, 0},
	{ 0, 0, 0},
	{ 1, 0, 0},
	{ 0, 0,-1},
	//3
	{-1, 0, 0},
	{ 0, 0, 0},
	{ 1, 0, 0},
	{ 0, 0, 1},
	//4
	{ 0,-1, 0},
	{ 0, 0, 0},
	{ 0, 1, 0},
	{-1, 0, 0},
	//5
	{ 0,-1, 0},
	{ 0, 0, 0},
	{ 0, 1, 0},
	{ 1, 0, 0},
	//6
	{ 0,-1, 0},
	{ 0, 0, 0},
	{ 0, 1, 0},
	{ 0, 0,-1},
	//7
	{ 0,-1, 0},
	{ 0, 0, 0},
	{ 0, 1, 0},
	{ 0, 0, 1},
	//8
	{ 0, 0,-1},
	{ 0, 0, 0},
	{ 0, 0, 1},
	{-1, 0, 0},
	//9
	{ 0, 0,-1},
	{ 0, 0, 0},
	{ 0, 0, 1},
	{ 1, 0, 0},
	//10
	{-1, 0, 0},
	{ 0, 0, 0},
	{ 1, 0, 0},
	{ 0, 1, 0},
	//11
	{ 0, 0,-1},
	{ 0, 0, 0},
	{ 0, 0, 1},
	{ 0, 1, 0},
};

static	const	BLOCK_COLLISION	IBlockCollision[]={
	//0
	{ 0,-1, 0},
	{ 0, 0, 0},
	{ 0, 1, 0},
	{ 0, 2, 0},
	//1
	{ 0, 0,-1},
	{ 0, 0, 0},
	{ 0, 0, 1},
	{ 0, 0, 2},
	//2
	{ 0, 0, 1},
	{ 0, 0, 0},
	{ 0, 0,-1},
	{ 0, 0,-2},
	//3
	{-1, 0, 0},
	{ 0, 0, 0},
	{ 1, 0, 0},
	{ 2, 0, 0},
	//4
	{ 1, 0, 0},
	{ 0, 0, 0},
	{-1, 0, 0},
	{-2, 0, 0},
	//5
	{ 0, 1, 0},
	{ 0, 0, 0},
	{ 0,-1, 0},
	{ 0,-2, 0},
};

static	const	BLOCK_COLLISION	QBlockCollision[]={
	//0
	{-1, 0, 0},
	{ 0, 0, 0},
	{ 0,-1, 0},
	{-1,-1, 0},
	//1
	{ 0,-1, 0},
	{ 0, 0, 0},
	{ 0,-1, 1},
	{ 0, 0, 1},
	//2
	{ 0,-1, 0},
	{ 0, 0, 0},
	{ 0,-1,-1},
	{ 0, 0,-1},
	//3
	{-1, 0, 0},
	{ 0, 0, 0},
	{-1, 0,-1},
	{ 0, 0,-1},
	//4
	{-1, 0, 0},
	{ 0, 0, 0},
	{-1, 0, 1},
	{ 0, 0, 1},
	//5
	{-1, 0, 0},
	{ 0, 0, 0},
	{-1, 1, 0},
	{ 0, 1, 0},
	//6
	{ 1, 0, 0},
	{ 0, 0, 0},
	{ 0,-1, 0},
	{ 1,-1, 0},
	//7
	{ 0, 0, 0},
	{ 0, 1, 0},
	{ 0, 0, 1},
	{ 0, 1, 1},
	//8
	{ 0, 0, 0},
	{ 1, 0, 0},
	{ 0, 0, 1},
	{ 1, 0, 1},
	//9
	{ 0, 0, 0},
	{ 0, 1, 0},
	{ 0, 0,-1},
	{ 0, 1,-1},
	//10
	{ 0, 0, 0},
	{ 1, 0, 0},
	{ 0, 0,-1},
	{ 1, 0,-1},
	//11
	{ 0, 0, 0},
	{ 1, 0, 0},
	{ 0, 1, 0},
	{ 1, 1, 0},
};


typedef struct
{
	int						block_count;			//構成されるブロックの数
	const	fx16			*block_data;			//ブロックのポリゴンデータ
	const	BLOCK_SHAPE		*block_shape;			//ブロックの回転バリエーション
	const	BLOCK_COLLISION	*block_collision;		//当たり判定用データ
}BLOCK_PARAM;

enum{
	BLOCK_BLOCK=0,
	BLOCK_LBLOCK,
	BLOCK_SBLOCK,
	BLOCK_TBLOCK,
	BLOCK_IBLOCK,
	BLOCK_QBLOCK,
	BLOCK_MAX,
};

static	const	BLOCK_PARAM	bp[]={
	{
		1,
		&BlockData[0],
		&BlockShape[0],
		&BlockCollision[0],
	},
	{
		4,
		&LBlockData[0],
		&LBlockShape[0],
		&LBlockCollision[0],
	},
	{
		4,
		&SBlockData[0],
		&SBlockShape[0],
		&SBlockCollision[0],
	},
	{
		4,
		&TBlockData[0],
		&TBlockShape[0],
		&TBlockCollision[0],
	},
	{
		4,
		&IBlockData[0],
		&IBlockShape[0],
		&IBlockCollision[0],
	},
	{
		4,
		&QBlockData[0],
		&QBlockShape[0],
		&QBlockCollision[0],
	},
};

static	void	DrawBlock(VecFx32 pos,int shape,int dir,int alpha,int tex);
static	void	DrawField(void);
static	void	DrawFieldBlock(BLOCK_OUT *bo);
static	BOOL	DrawFieldBlockCheck(BLOCK_OUT *bo,int check_x,int check_y,int check_z);
static	BOOL	CollisionCheck(BLOCK_OUT *bo,int ofs_x,int ofs_y,int ofs_z,int dir);
static	void	BlockLanding(BLOCK_OUT *bo);
static	void	SurfaceCheck(BLOCK_OUT *bo);

//----------------------------------------------------------------------------
/**
 *	@brief	3D初期化
 *	
 *	@param	gp		ゲームパラメータポインタ
 */
//-----------------------------------------------------------------------------
void	YT_InitBlockOut(GAME_PARAM *gp)
{
	BLOCK_OUT	*bo;

	//ジョブワークを確保
	bo=gp->job_work=GFL_HEAP_AllocClearMemory(gp->heapID,sizeof(BLOCK_OUT));

	G3X_Init();

	G3X_InitMtxStack();

	GX_SetBankForTex(GX_VRAM_TEX_0_A);
	GX_SetBankForTexPltt(GX_VRAM_TEXPLTT_0_G); 

	GX_SetGraphicsMode(GX_DISPMODE_GRAPHICS,GX_BGMODE_4,GX_BG0_AS_3D);
	GX_SetVisiblePlane(GX_PLANEMASK_BG0);
	G2_SetBG0Priority(0);

	G3X_SetShading(GX_SHADING_TOON);
	G3X_AntiAlias(TRUE);

	G3_SwapBuffers(GX_SORTMODE_AUTO,GX_BUFFERMODE_W);

	G3X_SetClearColor(GX_RGB(0,0,0),0,0x7fff,63,FALSE);
	G3_ViewPort(0,0,255,191);
	G3_Perspective(FX32_SIN30,FX32_COS30,FX32_ONE*4/3,1*FX32_ONE,FX32_ONE*400,NULL);

	G3_StoreMtx(0);

	GX_SetBankForTex(GX_VRAM_TEX_0_A);
	DC_FlushRange(tex_16plett8x8,sizeof(tex_16plett8x8));
	DC_FlushRange(pal_16plett,sizeof(pal_16plett));
	GX_BeginLoadTex();    
	GX_LoadTex((void *)&tex_16plett8x8[0],0,32);
	GX_EndLoadTex();
	GX_BeginLoadTexPltt();
	GX_LoadTexPltt((void *)&pal_16plett[0],0,32);
	GX_EndLoadTexPltt();

	//タッチパネル初期化
	GFL_UI_TP_Init(gp->heapID);

	//乱数初期化
	{
		RTCDate	date;
		RTCTime	time;
		u32		seed;

		RTC_GetDateTime(&date,&time);

		seed=date.year+date.month*0x100+date.day*0x10000+time.hour*0x100000+(time.minute+time.second)*0x1000000;

		GFL_STD_MtRandInit(seed);
	}

	GX_DispOn();


#ifdef SHAPE_DIR_CHECK
	rot_x=0;
	rot_y=0;
	rot_z=0;
#endif

	YT_JobNoSet(gp,YT_MainBlockOutNo);
}

//----------------------------------------------------------------------------
/**
 *	@brief	3D描画メイン
 *	
 *	@param	gp		ゲームパラメータポインタ
 */
//-----------------------------------------------------------------------------
enum{
	SEQ_BLOCK_INIT=0,
	SEQ_BLOCK_FALL,
	SEQ_BLOCK_LANDING,
	SEQ_SURFACE_CHECK,
};

void	YT_MainBlockOut(GAME_PARAM *gp)
{
	BLOCK_OUT	*bo=(BLOCK_OUT *)gp->job_work;
	BLOCK_SHAPE	*bs=(BLOCK_SHAPE *)bp[bo->shape].block_shape;
	VecFx32		pos;

#ifdef SHAPE_DIR_CHECK
	bo->pos_x=2;
	bo->pos_y=2;
	bo->pos_z=MAP_Z-1;
	bo->shape=BLOCK_LBLOCK;
	if(GFL_UI_KEY_GetTrg()&PAD_BUTTON_X){
		rot_x-=ROTATE_VALUE;
		OS_TPrintf("rotx:%d roty:%d rotz:%d\n",rot_x/ROTATE_VALUE,rot_y/ROTATE_VALUE,rot_z/ROTATE_VALUE);
	}
	if(GFL_UI_KEY_GetTrg()&PAD_BUTTON_B){
		rot_x+=ROTATE_VALUE;
		OS_TPrintf("rotx:%d roty:%d rotz:%d\n",rot_x/ROTATE_VALUE,rot_y/ROTATE_VALUE,rot_z/ROTATE_VALUE);
	}
	if(GFL_UI_KEY_GetTrg()&PAD_BUTTON_Y){
		rot_y-=ROTATE_VALUE;
		OS_TPrintf("rotx:%d roty:%d rotz:%d\n",rot_x/ROTATE_VALUE,rot_y/ROTATE_VALUE,rot_z/ROTATE_VALUE);
	}
	if(GFL_UI_KEY_GetTrg()&PAD_BUTTON_A){
		rot_y+=ROTATE_VALUE;
		OS_TPrintf("rotx:%d roty:%d rotz:%d\n",rot_x/ROTATE_VALUE,rot_y/ROTATE_VALUE,rot_z/ROTATE_VALUE);
	}
	if(GFL_UI_KEY_GetTrg()&PAD_BUTTON_L){
		rot_z+=ROTATE_VALUE;
		OS_TPrintf("rotx:%d roty:%d rotz:%d\n",rot_x/ROTATE_VALUE,rot_y/ROTATE_VALUE,rot_z/ROTATE_VALUE);
	}
	if(GFL_UI_KEY_GetTrg()&PAD_BUTTON_R){
		rot_z-=ROTATE_VALUE;
		OS_TPrintf("rotx:%d roty:%d rotz:%d\n",rot_x/ROTATE_VALUE,rot_y/ROTATE_VALUE,rot_z/ROTATE_VALUE);
	}
#else
	switch(bo->seq_no){
	case SEQ_BLOCK_INIT:
		bo->pos_x=2;
		bo->pos_y=2;
		bo->pos_z=MAP_Z-1;
		bo->dir=0;
		bo->wait=0;
		bo->shape=__GFL_STD_MtRand()%BLOCK_MAX;
		bo->seq_no=SEQ_BLOCK_FALL;
		bo->tp_flag=0;
		break;
	case SEQ_BLOCK_FALL:
		if(GFL_UI_KEY_GetTrg()&PAD_BUTTON_X){
			CollisionCheck(bo,0,0,0,bs[bo->dir].push_x);
		}
		if(GFL_UI_KEY_GetTrg()&PAD_BUTTON_B){
			CollisionCheck(bo,0,0,0,bs[bo->dir].push_b);
		}
		if(GFL_UI_KEY_GetTrg()&PAD_BUTTON_Y){
			CollisionCheck(bo,0,0,0,bs[bo->dir].push_y);
		}
		if(GFL_UI_KEY_GetTrg()&PAD_BUTTON_A){
			CollisionCheck(bo,0,0,0,bs[bo->dir].push_a);
		}
		if(GFL_UI_KEY_GetTrg()&PAD_BUTTON_L){
			CollisionCheck(bo,0,0,0,bs[bo->dir].push_l);
		}
		if(GFL_UI_KEY_GetTrg()&PAD_BUTTON_R){
			CollisionCheck(bo,0,0,0,bs[bo->dir].push_r);
		}
		if((GFL_UI_KEY_GetTrg()&PAD_KEY_UP)&&(bo->pos_y)){
			CollisionCheck(bo,0,-1,0,bo->dir);
		}
		if((GFL_UI_KEY_GetTrg()&PAD_KEY_DOWN)&&(bo->pos_y<MAP_Y-1)){
			CollisionCheck(bo,0,1,0,bo->dir);
		}
		if((GFL_UI_KEY_GetTrg()&PAD_KEY_LEFT)&&(bo->pos_x)){
			CollisionCheck(bo,-1,0,0,bo->dir);
		}
		if((GFL_UI_KEY_GetTrg()&PAD_KEY_RIGHT)&&(bo->pos_x<MAP_X-1)){
			CollisionCheck(bo,1,0,0,bo->dir);
		}

		bo->wait++;
		if((bo->wait>FALL_WAIT)||((GFL_UI_TP_GetCont())&&bo->tp_flag)){
			if(CollisionCheck(bo,0,0,-1,bo->dir)==TRUE){
				bo->seq_no=SEQ_BLOCK_LANDING;
			}
			bo->wait=0;
		}
		if(!GFL_UI_TP_GetCont()){
			bo->tp_flag=1;
		}
		break;
	case SEQ_BLOCK_LANDING:
		BlockLanding(bo);
		bo->seq_no=SEQ_SURFACE_CHECK;
		break;
	case SEQ_SURFACE_CHECK:
		SurfaceCheck(bo);
		bo->seq_no=SEQ_BLOCK_INIT;
		break;
	}
#endif

	pos.x=(bo->pos_x-(MAP_X/2))*FX32_ONE;
	pos.y=((MAP_Y/2)-bo->pos_y)*FX32_ONE;
	pos.z=(-4-(MAP_Z-bo->pos_z-1))*FX32_ONE;

	DrawBlock(pos,bo->shape,bo->dir,0,0);
#ifndef SHAPE_DIR_CHECK
	DrawField();
	DrawFieldBlock(bo);
#endif

	GFL_UI_TP_Main();

	G3_SwapBuffers(GX_SORTMODE_AUTO,GX_BUFFERMODE_W);
}

static	void	DrawBlock(VecFx32 pos,int shape,int dir,int alpha,int tex)
{
	fx16		*bd=(fx16 *)bp[shape].block_data;
	BLOCK_SHAPE	*bs=(BLOCK_SHAPE *)bp[shape].block_shape;
	int			index,line,line_max;
	VecFx32		Eye={0,0,FX32_ONE};
	VecFx32		at=	{0,0,0};
	VecFx32		vUp={0,FX32_ONE,0};
	VecFx16		vtx;

	G3X_Reset();

	G3_LookAt(&Eye,&vUp,&at,NULL);

	G3_LightVector(GX_LIGHTID_0,FX16_SQRT1_3,-FX16_SQRT1_3,-FX16_SQRT1_3);
	G3_LightColor(GX_LIGHTID_0,GX_RGB(31,31,31));

	G3_PushMtx();

	G3_MtxMode(GX_MTXMODE_TEXTURE);
	G3_Identity();
	G3_MtxMode(GX_MTXMODE_POSITION_VECTOR);

	G3_Translate(pos.x,pos.y,pos.z);

#ifdef SHAPE_DIR_CHECK
	G3_RotX(FX_SinIdx(rot_x),FX_CosIdx(rot_x));
	G3_RotY(FX_SinIdx(rot_y),FX_CosIdx(rot_y));
	G3_RotZ(FX_SinIdx(rot_z),FX_CosIdx(rot_z));
#else
	G3_RotX(FX_SinIdx(bs[dir].rot_x),FX_CosIdx(bs[dir].rot_x));
	G3_RotY(FX_SinIdx(bs[dir].rot_y),FX_CosIdx(bs[dir].rot_y));
	G3_RotZ(FX_SinIdx(bs[dir].rot_z),FX_CosIdx(bs[dir].rot_z));
#endif

	G3_MaterialColorDiffAmb(GX_RGB(31,31,31),GX_RGB(16,16,16),FALSE);
	G3_MaterialColorSpecEmi(GX_RGB(16,16,16),GX_RGB(0,0,0),FALSE);
	if(alpha){
		G3_TexImageParam(GX_TEXFMT_PLTT16,GX_TEXGEN_TEXCOORD,GX_TEXSIZE_S8,GX_TEXSIZE_T8,
						 GX_TEXREPEAT_ST,GX_TEXFLIP_NONE,GX_TEXPLTTCOLOR0_USE,0);
		G3_TexPlttBase(0,GX_TEXFMT_PLTT16);
	}
	G3_PolygonAttr(GX_LIGHTMASK_0,GX_POLYGONMODE_MODULATE,GX_CULL_NONE,0,alpha,GX_POLYGON_ATTR_MISC_NONE);

	index=0;

	while(1){
		if(bd[index]==-1){
			break;
		}
		G3_Begin(bd[index++]);
		line_max=bd[index++];

		for(line=0;line<line_max;line++){
			vtx.x=bd[index++];
			vtx.y=bd[index++];
			vtx.z=bd[index++];
			if(alpha){
				G3_TexCoord(0,(tex%4)*FX32_ONE);
			}
			G3_Vtx(vtx.x,vtx.y,vtx.z);
		}

		G3_End();
	}

	G3_PopMtx(1);
}

static	void	DrawField(void)
{
	VecFx32		Eye={0,0,FX32_ONE};
	VecFx32		at=	{0,0,0};
	VecFx32		vUp={0,FX32_ONE,0};
	int			i;

	G3X_Reset();

	G3_LookAt(&Eye,&vUp,&at,NULL);

	G3_LightVector(GX_LIGHTID_0,FX16_SQRT1_3,-FX16_SQRT1_3,-FX16_SQRT1_3);
	G3_LightColor(GX_LIGHTID_0,GX_RGB(31,31,31));

	G3_PushMtx();

	G3_MtxMode(GX_MTXMODE_TEXTURE);
	G3_Identity();
	G3_MtxMode(GX_MTXMODE_POSITION_VECTOR);

	G3_MaterialColorDiffAmb(GX_RGB(31,31,31),GX_RGB(16,16,16),FALSE);
	G3_MaterialColorSpecEmi(GX_RGB(16,16,16),GX_RGB(0,0,0),FALSE);
	G3_TexImageParam(GX_TEXFMT_PLTT16,GX_TEXGEN_TEXCOORD,GX_TEXSIZE_S8,GX_TEXSIZE_T8,
					 GX_TEXREPEAT_NONE,GX_TEXFLIP_NONE,GX_TEXPLTTCOLOR0_USE,0);
	G3_TexPlttBase(0,GX_TEXFMT_PLTT16);
	G3_PolygonAttr(GX_LIGHTMASK_0,GX_POLYGONMODE_MODULATE,GX_CULL_NONE,0,0,GX_POLYGON_ATTR_MISC_NONE);

	G3_Scale(5*FX32_ONE,5*FX32_ONE,FX32_ONE);
	G3_Translate(0, 0,-5*FX16_ONE+FX16_HALF);

	G3_Begin(GX_BEGIN_QUADS);
	G3_TexCoord(0,4*FX32_ONE);
	for(i=0;i<9;i++){
		G3_Vtx(-FX16_HALF, FX16_HALF,0);
		G3_Vtx( FX16_HALF, FX16_HALF,0);
		G3_Vtx( FX16_HALF,-FX16_HALF,0);
		G3_Vtx(-FX16_HALF,-FX16_HALF,0);
		G3_Translate(0,0,-FX16_ONE);
	}
	G3_End();

	G3_Identity();
	G3_Scale(FX32_ONE,FX32_ONE,11*FX32_ONE);
	G3_Translate(0,0,-FX16_ONE+FX16_ONE/16+FX16_ONE/32);

	G3_Begin(GX_BEGIN_QUAD_STRIP);
	G3_Vtx(-2*FX16_ONE-FX16_HALF, 2*FX16_ONE+FX16_HALF, FX16_HALF);
	G3_Vtx(-2*FX16_ONE-FX16_HALF, 2*FX16_ONE+FX16_HALF,-FX16_HALF);
	G3_Vtx(-1*FX16_ONE-FX16_HALF, 2*FX16_ONE+FX16_HALF, FX16_HALF);
	G3_Vtx(-1*FX16_ONE-FX16_HALF, 2*FX16_ONE+FX16_HALF,-FX16_HALF);
	G3_Vtx( 0*FX16_ONE-FX16_HALF, 2*FX16_ONE+FX16_HALF, FX16_HALF);
	G3_Vtx( 0*FX16_ONE-FX16_HALF, 2*FX16_ONE+FX16_HALF,-FX16_HALF);
	G3_Vtx( 0*FX16_ONE+FX16_HALF, 2*FX16_ONE+FX16_HALF, FX16_HALF);
	G3_Vtx( 0*FX16_ONE+FX16_HALF, 2*FX16_ONE+FX16_HALF,-FX16_HALF);
	G3_Vtx( 1*FX16_ONE+FX16_HALF, 2*FX16_ONE+FX16_HALF, FX16_HALF);
	G3_Vtx( 1*FX16_ONE+FX16_HALF, 2*FX16_ONE+FX16_HALF,-FX16_HALF);
	G3_Vtx( 2*FX16_ONE+FX16_HALF, 2*FX16_ONE+FX16_HALF, FX16_HALF);
	G3_Vtx( 2*FX16_ONE+FX16_HALF, 2*FX16_ONE+FX16_HALF,-FX16_HALF);

	G3_Vtx( 2*FX16_ONE+FX16_HALF, 2*FX16_ONE+FX16_HALF, FX16_HALF);
	G3_Vtx( 2*FX16_ONE+FX16_HALF, 2*FX16_ONE+FX16_HALF,-FX16_HALF);
	G3_Vtx( 2*FX16_ONE+FX16_HALF, 1*FX16_ONE+FX16_HALF, FX16_HALF);
	G3_Vtx( 2*FX16_ONE+FX16_HALF, 1*FX16_ONE+FX16_HALF,-FX16_HALF);
	G3_Vtx( 2*FX16_ONE+FX16_HALF, 0*FX16_ONE+FX16_HALF, FX16_HALF);
	G3_Vtx( 2*FX16_ONE+FX16_HALF, 0*FX16_ONE+FX16_HALF,-FX16_HALF);
	G3_Vtx( 2*FX16_ONE+FX16_HALF, 0*FX16_ONE-FX16_HALF, FX16_HALF);
	G3_Vtx( 2*FX16_ONE+FX16_HALF, 0*FX16_ONE-FX16_HALF,-FX16_HALF);
	G3_Vtx( 2*FX16_ONE+FX16_HALF,-1*FX16_ONE-FX16_HALF, FX16_HALF);
	G3_Vtx( 2*FX16_ONE+FX16_HALF,-1*FX16_ONE-FX16_HALF,-FX16_HALF);
	G3_Vtx( 2*FX16_ONE+FX16_HALF,-2*FX16_ONE-FX16_HALF, FX16_HALF);
	G3_Vtx( 2*FX16_ONE+FX16_HALF,-2*FX16_ONE-FX16_HALF,-FX16_HALF);

	G3_Vtx( 2*FX16_ONE+FX16_HALF,-2*FX16_ONE-FX16_HALF, FX16_HALF);
	G3_Vtx( 2*FX16_ONE+FX16_HALF,-2*FX16_ONE-FX16_HALF,-FX16_HALF);
	G3_Vtx( 1*FX16_ONE+FX16_HALF,-2*FX16_ONE-FX16_HALF, FX16_HALF);
	G3_Vtx( 1*FX16_ONE+FX16_HALF,-2*FX16_ONE-FX16_HALF,-FX16_HALF);
	G3_Vtx( 0*FX16_ONE+FX16_HALF,-2*FX16_ONE-FX16_HALF, FX16_HALF);
	G3_Vtx( 0*FX16_ONE+FX16_HALF,-2*FX16_ONE-FX16_HALF,-FX16_HALF);
	G3_Vtx( 0*FX16_ONE-FX16_HALF,-2*FX16_ONE-FX16_HALF, FX16_HALF);
	G3_Vtx( 0*FX16_ONE-FX16_HALF,-2*FX16_ONE-FX16_HALF,-FX16_HALF);
	G3_Vtx(-1*FX16_ONE-FX16_HALF,-2*FX16_ONE-FX16_HALF, FX16_HALF);
	G3_Vtx(-1*FX16_ONE-FX16_HALF,-2*FX16_ONE-FX16_HALF,-FX16_HALF);
	G3_Vtx(-2*FX16_ONE-FX16_HALF,-2*FX16_ONE-FX16_HALF, FX16_HALF);
	G3_Vtx(-2*FX16_ONE-FX16_HALF,-2*FX16_ONE-FX16_HALF,-FX16_HALF);

	G3_Vtx(-2*FX16_ONE-FX16_HALF,-2*FX16_ONE-FX16_HALF, FX16_HALF);
	G3_Vtx(-2*FX16_ONE-FX16_HALF,-2*FX16_ONE-FX16_HALF,-FX16_HALF);
	G3_Vtx(-2*FX16_ONE-FX16_HALF,-1*FX16_ONE-FX16_HALF, FX16_HALF);
	G3_Vtx(-2*FX16_ONE-FX16_HALF,-1*FX16_ONE-FX16_HALF,-FX16_HALF);
	G3_Vtx(-2*FX16_ONE-FX16_HALF, 0*FX16_ONE-FX16_HALF, FX16_HALF);
	G3_Vtx(-2*FX16_ONE-FX16_HALF, 0*FX16_ONE-FX16_HALF,-FX16_HALF);
	G3_Vtx(-2*FX16_ONE-FX16_HALF, 0*FX16_ONE+FX16_HALF, FX16_HALF);
	G3_Vtx(-2*FX16_ONE-FX16_HALF, 0*FX16_ONE+FX16_HALF,-FX16_HALF);
	G3_Vtx(-2*FX16_ONE-FX16_HALF, 1*FX16_ONE+FX16_HALF, FX16_HALF);
	G3_Vtx(-2*FX16_ONE-FX16_HALF, 1*FX16_ONE+FX16_HALF,-FX16_HALF);
	G3_Vtx(-2*FX16_ONE-FX16_HALF, 2*FX16_ONE+FX16_HALF, FX16_HALF);
	G3_Vtx(-2*FX16_ONE-FX16_HALF, 2*FX16_ONE+FX16_HALF,-FX16_HALF);

	G3_End();

	G3_Identity();
	G3_Translate(0,0,-15*FX16_ONE);
	G3_Begin(GX_BEGIN_TRIANGLES);
	G3_Vtx(-1*FX16_ONE-FX16_HALF, 2*FX16_ONE+FX16_HALF, 0);
	G3_Vtx(-1*FX16_ONE-FX16_HALF,-2*FX16_ONE-FX16_HALF, 0);
	G3_Vtx(-1*FX16_ONE-FX16_HALF, 2*FX16_ONE+FX16_HALF, 0);

	G3_Vtx( 0*FX16_ONE-FX16_HALF, 2*FX16_ONE+FX16_HALF, 0);
	G3_Vtx( 0*FX16_ONE-FX16_HALF,-2*FX16_ONE-FX16_HALF, 0);
	G3_Vtx( 0*FX16_ONE-FX16_HALF, 2*FX16_ONE+FX16_HALF, 0);

	G3_Vtx( 0*FX16_ONE+FX16_HALF, 2*FX16_ONE+FX16_HALF, 0);
	G3_Vtx( 0*FX16_ONE+FX16_HALF,-2*FX16_ONE-FX16_HALF, 0);
	G3_Vtx( 0*FX16_ONE+FX16_HALF, 2*FX16_ONE+FX16_HALF, 0);

	G3_Vtx( 1*FX16_ONE+FX16_HALF, 2*FX16_ONE+FX16_HALF, 0);
	G3_Vtx( 1*FX16_ONE+FX16_HALF,-2*FX16_ONE-FX16_HALF, 0);
	G3_Vtx( 1*FX16_ONE+FX16_HALF, 2*FX16_ONE+FX16_HALF, 0);

	G3_Vtx(-2*FX16_ONE-FX16_HALF, 1*FX16_ONE+FX16_HALF, 0);
	G3_Vtx( 2*FX16_ONE+FX16_HALF, 1*FX16_ONE+FX16_HALF, 0);
	G3_Vtx(-2*FX16_ONE-FX16_HALF, 1*FX16_ONE+FX16_HALF, 0);

	G3_Vtx(-2*FX16_ONE-FX16_HALF, 0*FX16_ONE+FX16_HALF, 0);
	G3_Vtx( 2*FX16_ONE+FX16_HALF, 0*FX16_ONE+FX16_HALF, 0);
	G3_Vtx(-2*FX16_ONE-FX16_HALF, 0*FX16_ONE+FX16_HALF, 0);

	G3_Vtx(-2*FX16_ONE-FX16_HALF, 0*FX16_ONE-FX16_HALF, 0);
	G3_Vtx( 2*FX16_ONE+FX16_HALF, 0*FX16_ONE-FX16_HALF, 0);
	G3_Vtx(-2*FX16_ONE-FX16_HALF, 0*FX16_ONE-FX16_HALF, 0);

	G3_Vtx(-2*FX16_ONE-FX16_HALF,-1*FX16_ONE-FX16_HALF, 0);
	G3_Vtx( 2*FX16_ONE+FX16_HALF,-1*FX16_ONE-FX16_HALF, 0);
	G3_Vtx(-2*FX16_ONE-FX16_HALF,-1*FX16_ONE-FX16_HALF, 0);

	G3_End();
	
	G3_PopMtx(1);
}

static	void	DrawFieldBlock(BLOCK_OUT *bo)
{
	int		set_x,set_y,set_z;
	VecFx32	pos;

	for(set_x=0;set_x<MAP_X;set_x++){
		for(set_y=0;set_y<MAP_Y;set_y++){
			for(set_z=0;set_z<MAP_Z;set_z++){
				if(DrawFieldBlockCheck(bo,set_x,set_y,set_z)){
					pos.x=(set_x-(MAP_X/2))*FX32_ONE;
					pos.y=((MAP_Y/2)-set_y)*FX32_ONE;
					pos.z=(-4-(MAP_Z-set_z-1))*FX32_ONE;
					DrawBlock(pos,BLOCK_BLOCK,0,31,set_z);
				}
			}
		}
	}
}

static	BOOL	DrawFieldBlockCheck(BLOCK_OUT *bo,int check_x,int check_y,int check_z)
{
	if(bo->field[check_z][check_x][check_y]==0){
		return FALSE;
	}
	if(bo->field[check_z+1][check_x][check_y]==0){
		return TRUE;
	}
	if(check_x-1>=0){
		if(bo->field[check_z][check_x-1][check_y]==0){
			return TRUE;
		}
	}
	if(check_x+1<MAP_X){
		if(bo->field[check_z][check_x+1][check_y]==0){
			return TRUE;
		}
	}
	if(check_y-1>=0){
		if(bo->field[check_z][check_x][check_y-1]==0){
			return TRUE;
		}
	}
	if(check_y+1<MAP_Y){
		if(bo->field[check_z][check_x][check_y+1]==0){
			return TRUE;
		}
	}
	return FALSE;
}

static	BOOL	CollisionCheck(BLOCK_OUT *bo,int ofs_x,int ofs_y,int ofs_z,int dir)
{
	int	i;
	int	block_count;
	int	check_x,check_y,check_z;
	BLOCK_COLLISION	*bc=(BLOCK_COLLISION *)bp[bo->shape].block_collision;

	block_count=bp[bo->shape].block_count;

	for(i=0;i<block_count;i++){
		check_x=bo->pos_x+ofs_x+bc[dir*block_count+i].x;
		check_y=bo->pos_y+ofs_y+bc[dir*block_count+i].y;
		check_z=bo->pos_z+ofs_z+bc[dir*block_count+i].z;
		if((check_x<0)||(check_x>MAP_X-1)){
			return TRUE;
		}
		if((check_y<0)||(check_y>MAP_Y-1)){
			return TRUE;
		}
		if(check_z<0){
			return TRUE;
		}
		if(bo->field[check_z][check_x][check_y]){
			return TRUE;
		}
	}

	bo->pos_x+=ofs_x;
	bo->pos_y+=ofs_y;
	bo->pos_z+=ofs_z;
	bo->dir=dir;

	return FALSE;
}

static	void	BlockLanding(BLOCK_OUT *bo)
{
	int	i;
	int	block_count;
	int	set_x,set_y,set_z;
	BLOCK_COLLISION	*bc=(BLOCK_COLLISION *)bp[bo->shape].block_collision;

	block_count=bp[bo->shape].block_count;

	for(i=0;i<block_count;i++){
		set_x=bo->pos_x+bc[bo->dir*block_count+i].x;
		set_y=bo->pos_y+bc[bo->dir*block_count+i].y;
		set_z=bo->pos_z+bc[bo->dir*block_count+i].z;
		bo->field[set_z][set_x][set_y]=1;
	}
}

static	void	SurfaceCheck(BLOCK_OUT *bo)
{
	int	check_x,check_y,check_z;
	int	block_count[MAP_Z];
	int	low,high;

	for(check_z=0;check_z<MAP_Z;check_z++){
		block_count[check_z]=0;
		for(check_y=0;check_y<MAP_Y;check_y++){
			for(check_x=0;check_x<MAP_X;check_x++){
				if(bo->field[check_z][check_x][check_y]){
					block_count[check_z]++;
				}
			}
		}
		if(block_count[check_z]==(MAP_X*MAP_Y)){
			for(check_y=0;check_y<MAP_Y;check_y++){
				for(check_x=0;check_x<MAP_X;check_x++){
					bo->field[check_z][check_x][check_y]=0;
				}
			}
			block_count[check_z]=0;
		}
	}

	while(1){
		for(low=0;low<MAP_Z;low++){
			if(block_count[low]==0){
				break;
			}
		}
		for(high=low;high<MAP_Z;high++){
			if(block_count[high]){
				break;
			}
		}
		if(high==MAP_Z){
			break;
		}
		for(check_y=0;check_y<MAP_Y;check_y++){
			for(check_x=0;check_x<MAP_X;check_x++){
				bo->field[low][check_x][check_y]=bo->field[high][check_x][check_y];
				bo->field[high][check_x][check_y]=0;
			}
		}
		block_count[low]=block_count[high];
		block_count[high]=0;
	}
}

