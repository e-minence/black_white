<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>

<head>
<META http-equiv="Content-Type" content="text/html; charset=Shift_JIS">
<META http-equiv="Content-Style-Type" content="text/css">
<title>DWC_ConnectToAnybodyAsync</title>
<LINK rel="stylesheet" href="../css/nitro.css" type="text/css">
</head>

<body>
<h1 id="dwc__main_8h_10c4e2a60e98dfa82a16b5e896d3a2203" align="left">DWC_ConnectToAnybodyAsync</h1>
<h2>構文</h2>

<dl>
  <dd>
  <PRE><CODE>#include &lt;dwc.h&gt;</CODE></PRE>
  <PRE><CODE>BOOL DWC_ConnectToAnybodyAsync(<a href="Macro.html#dwc__match_8h_1c3ba6e33e5dd79e1d13350b71fa22250">DWCTopologyType</a> topology,
                               u8 maxEntry,
                               const char *addFilter,
                               <a href="DWCMatchedSCCallback.html#dwc__match_8h_169fa2126df86bf98f54258f5ccab9beb">DWCMatchedSCCallback</a> matchedCallback,
                               void *matchedParam,
                               <a href="DWCNewClientCallback.html#dwc__match_8h_133da3ed06ce23a3dbab8f2e0b9aedc96">DWCNewClientCallback</a> newClientCallback,
                               void *newClientParam,
                               <a href="DWCEvalPlayerCallback.html#dwc__match_8h_1546369b77983a0a5e7b8609d236ba937">DWCEvalPlayerCallback</a> evalCallback,
                               void *evalParam,
                               <a href="DWCConnectAttemptCallback.html#dwc__match_8h_11f5ec37975abd1264f03e7d9247c34bf">DWCConnectAttemptCallback</a> attemptCallback,
                               u8 *connectionUserData,
                               void *attemptParam);</CODE></PRE></dd> 
</dl>

<h2>引数</h2>

<TABLE border="1" width="100%">
  <TBODY>

    <TR>
      <TD width="13%"><EM><STRONG>topology</STRONG></EM></TD>
      <TD width="87%">接続形態。<a href="Macro.html#dwc__match_8h_1c3ba6e33e5dd79e1d13350b71fa22250">DWCTopologyType</a>の中から一つ指定します。</TD>
    </TR>

    <TR>
      <TD width="13%"><EM><STRONG>maxEntry</STRONG></EM></TD>
      <TD width="87%">要求するネットワーク構成人数（自分も含む）。2〜32の値が設定できる。</TD>
    </TR>

    <TR>
      <TD width="13%"><EM><STRONG>addFilter</STRONG></EM></TD>
      <TD width="87%">ゲームで追加したいマッチメイク条件文字列。条件を追加しない場合はNULLを渡す。条件はスタンダードなSQLの書式で書くことができます。設定できる文字列長は最大127文字で、デバッグビルドでは文字数オーバチェックをしています。文字列はコピーしてライブラリ内で保持します。</TD>
    </TR>

    <TR>
      <TD width="13%"><EM><STRONG>matchedCallback</STRONG></EM></TD>
      <TD width="87%">接続完了コールバック関数へのポインタ。１人接続するごとに呼ばれる。</TD>
    </TR>

    <TR>
      <TD width="13%"><EM><STRONG>matchedParam</STRONG></EM></TD>
      <TD width="87%">接続完了コールバック用パラメータ。</TD>
    </TR>

    <TR>
      <TD width="13%"><EM><STRONG>newClientCallback</STRONG></EM></TD>
      <TD width="87%">新規接続クライアント通知コールバック関数へのポインタ。</TD>
    </TR>

    <TR>
      <TD width="13%"><EM><STRONG>newClientParam</STRONG></EM></TD>
      <TD width="87%">新規接続クライアント通知コールバック用パラメータ。</TD>
    </TR>

    <TR>
      <TD width="13%"><EM><STRONG>evalCallback</STRONG></EM></TD>
      <TD width="87%">プレイヤー評価コールバック関数へのポインタ。</TD>
    </TR>

    <TR>
      <TD width="13%"><EM><STRONG>evalParam</STRONG></EM></TD>
      <TD width="87%">プレイヤー評価コールバック用パラメータ。</TD>
    </TR>

    <TR>
      <TD width="13%"><EM><STRONG>attemptCallback</STRONG></EM></TD>
      <TD width="87%">接続受付判定コールバック関数へのポインタ。</TD>
    </TR>

    <TR>
      <TD width="13%"><EM><STRONG>connectionUserData</STRONG></EM></TD>
      <TD width="87%">自分の接続受付判定用パラメータバッファへのポインタ。u8[<a href="Macro.html#dwc__match_8h_1767334491be60055db279f50c050c695">DWC_CONNECTION_USERDATA_LEN</a>]分のバッファであること。このバッファの内容は、ライブラリにコピーされるので、本関数呼出し後は開放されていても構わない。NULLを指定した場合、自分の接続受付判定用バッファの内容はすべて0に設定される。</TD>
    </TR>

    <TR>
      <TD width="13%"><EM><STRONG>attemptParam</STRONG></EM></TD>
      <TD width="87%">接続受付判定コールバック用パラメータ</TD>
    </TR>

  </TBODY>
</TABLE>

<h2>返り値</h2>

<TABLE border="1" width="100%">
  <TBODY>

    <TR>
      <TD width="13%"><EM><STRONG>TRUE</STRONG></EM></TD>
      <TD width="87%">処理開始。コールバック関数で結果が通知される。</TD>
    </TR>

    <TR>
      <TD width="13%"><EM><STRONG>FALSE</STRONG></EM></TD>
      <TD width="87%">本関数を呼んで良い状態ではない</TD>
    </TR>

  </TBODY>
</TABLE>

<H2>説明</H2>

<p>友達を指定せずに、人数指定でグループを作成します。これを友達無指定ピアマッチメイクと呼びます。</p><p>引数addFilterで、マッチメイクの候補として検索するプレイヤーの条件を設定することができます。このフィルタ文字列内で使用するためのマッチメイク指標キーは、予め<a href="DWC_AddMatchKeyInt.html#dwc__match_8h_1c6b58c2fcd1265657a5689de46e8ea7e">DWC_AddMatchKeyInt</a>関数、<a href="DWC_AddMatchKeyString.html#dwc__match_8h_1a6dc592558f9f69faff4f1911782f3a8">DWC_AddMatchKeyString</a>関数を用いて登録しておく必要があります。</p><p>友達管理やマッチメイク処理は開発向けと製品向けサーバの区別がないことに注意してください。リマスターやローカライズ版の開発時にマッチメイクのテストを行う場合、<a href="DWC_InitForDevelopment.html#dwc__init_8h_1aa0d7afa708c455277c5fb1d6cef9059">DWC_InitForDevelopment</a>関数でDWCを初期化しても、既に一般市場で発売しているタイトルとマッチメイクしてしまうことがあります。</p><p>これを避けるためには、友達無指定ピアマッチメイクのときに、マッチメイクフィルターを使って「製品版」と「デバッグ・開発版」がマッチメイクしないようにする必要があります。（マッチメイクフィルターに関しては<a href="DWC_AddMatchKeyString.html#dwc__match_8h_1a6dc592558f9f69faff4f1911782f3a8">DWC_AddMatchKeyString</a>関数を参照してください）</p><p>また、引数evalCallbackを指定すれば、マッチメイクの候補プレイヤーを見つける度に指定された評価コールバック関数が呼び出されます。評価コールバック関数内では、<a href="DWC_GetMatchIntValue.html#dwc__match_8h_1dbbececf29f224e6e694460d01d6c6cf">DWC_GetMatchIntValue</a>関数、<a href="DWC_GetMatchStringValue.html#dwc__match_8h_1d02811d6603b29dc1b7cd6aa75bec05a">DWC_GetMatchStringValue</a>関数を用いてマッチメイク指標キーを参照することができます。その値を元にプレイヤーを評価し、評価値を戻り値として返してください。評価値が0以下のプレイヤーはマッチメイクの対象から外されます。評価値が高いプレイヤーほど、マッチメイクの相手として選ばれやすくなります。</p><p>本関数呼出し後、<a href="DWC_ProcessFriendsMatch.html#dwc__main_8h_1c7b64bfd61e6c336a1d382fb6d1ea2d8">DWC_ProcessFriendsMatch</a>関数を呼び続ければマッチメイク処理が進行します。最初のサーバホストとのマッチメイクが成功、エラー、キャンセルのいずれかの状態になれば、マッチメイク完了コールバックが呼び出されます。サーバホストへの接続後は、サーバホストへ新たに接続に来たクライアントホストがあれば、新規接続クライアント通知コールバックが呼び出されます。また、その新規接続クライアントホストの接続処理が完了すれば、再びマッチメイク完了コールバックが呼び出されます。友達無指定ピアマッチメイクでは、自分がサーバホスト・クライアントホストのどちらになるかは自動で決定されます。</p><p>ネットワーク接続状況により、関数からしばらく処理が戻らずブロックすることがあります。</p><p>接続形態が違う相手とはマッチメイクされることはありませんが、次の注意点があります。<a href="DWC_ConnectToAnybodyAsync.html#dwc__main_8h_10c4e2a60e98dfa82a16b5e896d3a2203">DWC_ConnectToAnybodyAsync</a>/<a href="DWC_ConnectToFriendsAsync.html#dwc__main_8h_1dcb8be27412df5c9d5e0d9b9d035079b">DWC_ConnectToFriendsAsync</a>では、接続形態が違う相手であっても、これらの関数に<a href="DWCEvalPlayerCallback.html#dwc__match_8h_1546369b77983a0a5e7b8609d236ba937">DWCEvalPlayerCallback</a>引数が設定されている場合評価コールバックが呼び出されます。評価コールバック内で相手の接続形態を知る手段が無いため、評価コールバックでその相手を除外する方法がありません。</p><p>評価コールバックでフィルタされた結果接続することになった相手と接続形態が違う場合、その相手とはマッチメイクが行われません。この挙動は、マッチメイクできる相手が見つかるまで繰り返されます。<a href="DWC_ConnectToAnybodyAsync.html#dwc__main_8h_10c4e2a60e98dfa82a16b5e896d3a2203">DWC_ConnectToAnybodyAsync</a>/<a href="DWC_ConnectToFriendsAsync.html#dwc__main_8h_1dcb8be27412df5c9d5e0d9b9d035079b">DWC_ConnectToFriendsAsync</a>を使用する場合は、接続形態以外の条件でグループ化されるような条件を設け、その中では接続形態が同一になるようにしてください。</p><p>接続形態がフルメッシュ型もしくはハイブリッド型のときは、サーバホストが切断したときにサーバ交代が発生します。スター型では発生しません。ハイブリッド型の場合、新しいサーバホストに接続できるのは新しいサーバホストと直接接続されていたホストのみで、それ以外のホストは切断されます。</p>


<H2>履歴</H2>
<DL>

<DT>5.3</DT>
<DD>認証サーバの切り替えを、DWC_SetAuthServer関数ではなく<a href="DWC_InitForDevelopment.html#dwc__init_8h_1aa0d7afa708c455277c5fb1d6cef9059">DWC_InitForDevelopment</a>/<a href="DWC_InitForProduction.html#dwc__init_8h_1189c4f789efc589616c0bcb57aa63279">DWC_InitForProduction</a>関数で行うよう仕様変更したため、関連する記述を修正</DD>

</DL>
<p style="margin-top:1em; text-align:right;">5.1pr2より前の変更履歴は<a href="../_TWL_CHANGELOG_.html#DWC_ConnectToAnybodyAsync_tag">こちら</a>　　</p>
</body>
</html>
